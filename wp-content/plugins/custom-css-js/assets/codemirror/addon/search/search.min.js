"use strict";var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,j){a instanceof String&&(a=String(a));for(var d=a.length,i=0;i<d;i++){var c=a[i];if(f.call(j,c,i,a)){return{i:i,v:c}}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,i,c){if(d){i=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var f=a[c];f in i||(i[f]={});i=i[f]}a=a[a.length-1];c=i[a];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(i,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(c,d){return $jscomp.findInternal(this,c,d).v}},"es6-impl","es3");(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(D){function s(b,e){"string"==typeof b?b=new RegExp(b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e?"gi":"g"):b.global||(b=new RegExp(b.source,b.ignoreCase?"gi":"g"));return{token:function(h){b.lastIndex=h.pos;var g=b.exec(h.string);if(g&&g.index==h.pos){return h.pos+=g[0].length||1,"searching"}g?h.pos=g.index:h.skipToEnd()}}}function A(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function o(b){return b.state.search||(b.state.search=new A)}function t(b){return"string"==typeof b&&b==b.toLowerCase()}function j(g,h,e){return g.getSearchCursor(h,e,{caseFold:t(h),multiline:!0})}function C(g,l,e,h,k){g.openDialog(l,h,{value:e,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){f(g)},onKeyDown:k})}function a(g,l,e,h,k){g.openDialog?g.openDialog(l,k,{value:h,selectValueOnOpen:!0}):k(prompt(e,h))}function B(g,k,e,h){if(g.openConfirm){g.openConfirm(k,h)}else{if(confirm(e)){h[0]()}}}function H(b){return b.replace(/\\(.)/g,function(g,e){return"n"==e?"\n":"r"==e?"\r":e})}function G(h){var g=h.match(/^\/(.*)\/([a-z]*)$/);if(g){try{h=new RegExp(g[1],-1==g[2].indexOf("i")?"":"i")}catch(e){}}else{h=H(h)}if("string"==typeof h?""==h:h.test("")){h=/x^/}return h}function d(h,g,k){g.queryText=k;g.query=G(k);h.removeOverlay(g.overlay,t(g.query));g.overlay=s(g.query,t(g.query));h.addOverlay(g.overlay);h.showMatchesOnScrollbar&&(g.annotate&&(g.annotate.clear(),g.annotate=null),g.annotate=h.showMatchesOnScrollbar(g.query,t(g.query)))}function i(b,r,p,n){var q=o(b);if(q.query){return c(b,r)}var m=b.getSelection()||q.lastQuery;if(p&&b.openDialog){var k=null,l=function(g,e){D.e_stop(e);g&&(g!=q.queryText&&(d(b,q,g),q.posFrom=q.posTo=b.getCursor()),k&&(k.style.opacity=1),c(b,e.shiftKey,function(h,v){var u;3>v.line&&document.querySelector&&(u=b.display.wrapper.querySelector(".CodeMirror-dialog"))&&u.getBoundingClientRect().bottom-4>b.cursorCoords(v,"window").top&&((k=u).style.opacity=0.4)}))};C(b,'<span class="CodeMirror-search-label">Search:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',m,l,function(v,u){var g=D.keyName(v),h=D.keyMap[b.getOption("keyMap")][g];h||(h=b.getOption("extraKeys")[g]);if("findNext"==h||"findPrev"==h||"findPersistentNext"==h||"findPersistentPrev"==h){D.e_stop(v),d(b,o(b),u),b.execCommand(h)}else{if("find"==h||"findPersistent"==h){D.e_stop(v),l(u,v)}}});n&&m&&(d(b,q,m),c(b,r))}else{a(b,'<span class="CodeMirror-search-label">Search:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',"Search for:",m,function(e){e&&!q.query&&b.operation(function(){d(b,q,e);q.posFrom=q.posTo=b.getCursor();c(b,r)})})}}function c(b,h,g){b.operation(function(){var e=o(b),k=j(b,e.query,h?e.posFrom:e.posTo);if(!k.find(h)&&(k=j(b,e.query,h?D.Pos(b.lastLine()):D.Pos(b.firstLine(),0)),!k.find(h))){return}b.setSelection(k.from(),k.to());b.scrollIntoView({from:k.from(),to:k.to()},20);e.posFrom=k.from();e.posTo=k.to();g&&g(k.from(),k.to())})}function f(b){b.operation(function(){var e=o(b);if(e.lastQuery=e.query){e.query=e.queryText=null,b.removeOverlay(e.overlay),e.annotate&&(e.annotate.clear(),e.annotate=null)}})}function F(h,g,k){h.operation(function(){for(var e=j(h,g);e.findNext();){if("string"!=typeof g){var b=h.getRange(e.from(),e.to()).match(g);e.replace(k.replace(/\$(\d)/g,function(m,l){return b[l]}))}else{e.replace(k)}}})}function E(h,g){if(!h.getOption("readOnly")){var l=h.getSelection()||o(h).lastQuery,k='<span class="CodeMirror-search-label">'+(g?"Replace all:":"Replace:")+"</span>";a(h,k+' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',k,l,function(b){b&&(b=G(b),a(h,'<span class="CodeMirror-search-label">With:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',"Replace with:","",function(p){p=H(p);if(g){F(h,b,p)}else{f(h);var q=j(h,b,h.getCursor("from")),n=function(){var e=q.from(),r;if(!(r=q.findNext())&&(q=j(h,b),!(r=q.findNext())||e&&q.from().line==e.line&&q.from().ch==e.ch)){return}h.setSelection(q.from(),q.to());h.scrollIntoView({from:q.from(),to:q.to()});B(h,'<span class="CodeMirror-search-label">Replace?</span> <button>Yes</button> <button>No</button> <button>All</button> <button>Stop</button>',"Replace?",[function(){m(r)},n,function(){F(h,b,p)}])},m=function(e){q.replace("string"==typeof b?p:p.replace(/\$(\d)/g,function(r,u){return e[u]}));n()};n()}}))})}}D.commands.find=function(b){f(b);i(b)};D.commands.findPersistent=function(b){f(b);i(b,!1,!0)};D.commands.findPersistentNext=function(b){i(b,!1,!0,!0)};D.commands.findPersistentPrev=function(b){i(b,!0,!0,!0)};D.commands.findNext=i;D.commands.findPrev=function(b){i(b,!0)};D.commands.clearSearch=f;D.commands.replace=E;D.commands.replaceAll=function(b){E(b,!0)}});