(function(f,c){var k={};var g=/[^a-z0-9.-]/;var d=false;var i=f(".as3cf-tab");var j;function m(p){return f("#"+p+" .as3cf-main-settings form").find("input:not(.no-compare)").serialize()}function o(r){var q=j.find("#"+r);var p=q.find("input[type=checkbox]");q.toggleClass("on").find("span").toggleClass("checked");var s=q.find("span.on").hasClass("checked");p.attr("checked",s).trigger("change")}function l(s){var p=s.next(".as3cf-validation-error");var r=f("#"+j.attr("id")+' form button[type="submit"]');var q=/[^a-zA-Z0-9\.\-]/;if(q.test(s.val())){p.show();r.attr("disabled",true)}else{p.hide();r.attr("disabled",false)}}as3cf.tabs={defaultTab:"media",toggle:function(q,p){q=as3cf.tabs.sanitizeHash(q);i.hide();j=f("#tab-"+q);j.show();f(".nav-tab").removeClass("nav-tab-active");f('a.nav-tab[data-tab="'+q+'"]').addClass("nav-tab-active");f(".aws-main").attr("data-tab",q);if(j.attr("data-prefix")){c.prefix=j.attr("data-prefix")}if(!p){f(".as3cf-updated").removeClass("show")}if("support"===q){as3cf.tabs.getDiagnosticInfo()}},getDiagnosticInfo:function(){var p=f(".debug-log-textarea");p.html(as3cf.strings.get_diagnostic_info);var q={action:"as3cf-get-diagnostic-info",_nonce:as3cf.nonces.get_diagnostic_info};f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:q,error:function(r,t,s){p.html(s)},success:function(s,t,r){if("undefined"!==typeof s.success){p.html(s.diagnostic_info)}else{p.html(as3cf.strings.get_diagnostic_info_error);p.append(s.error)}}})},sanitizeHash:function(q){var p=f("#tab-"+q);if(0===p.length){q=as3cf.tabs.defaultTab}return q}};as3cf.buckets={validLength:3,bucketSelectLock:false,loadList:function(p){if("undefined"===typeof p){p=false}var s=f(".as3cf-bucket-container."+c.prefix+" .as3cf-bucket-list");var t=f("#"+c.prefix+"-bucket").val();if(false===p&&s.find("li").length>1){f(".as3cf-bucket-list a").removeClass("selected");f('.as3cf-bucket-list a[data-bucket="'+t+'"]').addClass("selected");this.scrollToSelected();return}s.html('<li class="loading">'+s.attr("data-working")+"</li>");var r={action:c.prefix+"-get-buckets",_nonce:window[c.prefix.replace(/-/g,"_")].nonces.get_buckets};var q=this;f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:r,error:function(u,w,v){s.html("");q.showError(as3cf.strings.get_buckets_error,v,"as3cf-bucket-select")},success:function(v,w,u){s.html("");if("undefined"!==typeof v.success){f(".as3cf-bucket-error").hide();f(v.buckets).each(function(x,z){var y=z.Name===t?"selected":"";s.append('<li><a class="'+y+'" href="#" data-bucket="'+z.Name+'"><span class="bucket"><span class="dashicons dashicons-portfolio"></span> '+z.Name+'</span><span class="spinner"></span></span></a></li>')});q.scrollToSelected()}else{q.showError(as3cf.strings.get_buckets_error,v.error,"as3cf-bucket-select")}}})},scrollToSelected:function(){if(!f(".as3cf-bucket-list a.selected").length){return}var p=f("ul.as3cf-bucket-list li").first().position().top+150;f(".as3cf-bucket-list").animate({scrollTop:f("ul.as3cf-bucket-list li a.selected").position().top-p})},resetModal:function(){var p=f(".as3cf-bucket-container."+c.prefix);if(false===j.hasClass("as3cf-has-bucket")||"manual"===f("#"+c.prefix+"-bucket-select").val()){p.find(".as3cf-bucket-manual").show().siblings().hide();p.find(".bucket-actions.manual").show().siblings(".bucket-actions").hide()}else{p.find(".as3cf-bucket-select").show().siblings().hide();p.find(".bucket-actions.select").show().siblings(".bucket-actions").hide();this.loadList(d);d=false}p.find(".as3cf-bucket-error").hide();var q=f("#"+c.prefix+"-bucket").val();p.find(".as3cf-bucket-manual .as3cf-bucket-name").val(q);this.bucketSelectLock=false},saveManual:function(){var p=f(".as3cf-bucket-container."+c.prefix+" .as3cf-manual-save-bucket-form");var r=p.find(".as3cf-bucket-name");var q=p.find("button[type=submit]");var t=r.val();var s=q.first().text();if(t===f("#"+c.prefix+"-active-bucket").text()){f(".as3cf-bucket-error").hide();j.addClass("as3cf-has-bucket");c.close();return}f(".as3cf-bucket-error").hide();q.text(q.attr("data-working"));q.prop("disabled",true);var v={action:c.prefix+"-manual-save-bucket",bucket_name:t,_nonce:window[c.prefix.replace(/-/g,"_")].nonces.manual_bucket};var u=this;f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:v,error:function(w,y,x){q.text(s);u.showError(as3cf.strings.save_bucket_error,x,"as3cf-bucket-manual")},success:function(x,y,w){q.text(s);q.prop("disabled",false);if("undefined"!==typeof x.success){u.set(t,x.region,x.can_write);f("#"+c.prefix+"-bucket-select").val("manual");f(".as3cf-bucket-list a").removeClass("selected").filter('[data-bucket="'+t+'"]').addClass("selected");d=true}else{u.showError(as3cf.strings.save_bucket_error,x.error,"as3cf-bucket-manual")}}})},saveSelected:function(p){var u=f(".as3cf-bucket-list");if(this.bucketSelectLock){return}this.bucketSelectLock=true;if(p.hasClass("selected")){j.addClass("as3cf-has-bucket");c.close();return}var s=f(".as3cf-bucket-list a.selected").attr("data-bucket");f(".as3cf-bucket-list a").removeClass("selected");p.addClass("selected");u.addClass("saving");p.find(".spinner").show().css("visibility","visible");var q=p.attr("data-bucket");var t={action:c.prefix+"-save-bucket",bucket_name:q,_nonce:window[c.prefix.replace(/-/g,"_")].nonces.save_bucket};var r=this;f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:t,error:function(v,x,w){u.removeClass("saving");r.showError(as3cf.strings.save_bucket_error,w,"as3cf-bucket-select");f(".as3cf-bucket-list a").removeClass("selected");f('.as3cf-bucket-list a[data-bucket="'+s+'"]').addClass("selected")},success:function(w,x,v){p.find(".spinner").hide().css("visibility","hidden");u.removeClass("saving");if("undefined"!==typeof w.success){r.set(q,w.region,w.can_write);f("#"+c.prefix+"-bucket-select").val("")}else{r.showError(as3cf.strings.save_bucket_error,w.error,"as3cf-bucket-select");f(".as3cf-bucket-list a").removeClass("selected");f('.as3cf-bucket-list a[data-bucket="'+s+'"]').addClass("selected")}}})},disabledButtons:function(){if(0===f(".as3cf-bucket-container."+c.prefix+" .as3cf-create-bucket-form").length){return}var q=f(".as3cf-bucket-container."+c.prefix+" .as3cf-create-bucket-form");var p=f(".as3cf-bucket-container."+c.prefix+" .as3cf-manual-save-bucket-form");if(q.find(".as3cf-bucket-name").val().length<3){q.find("button[type=submit]").attr("disabled",true)}else{q.find("button[type=submit]").attr("disabled",false)}if(p.find(".as3cf-bucket-name").val().length<3){p.find("button[type=submit]").attr("disabled",true)}else{p.find("button[type=submit]").attr("disabled",false)}},showError:function(t,q,r){var p=f(".as3cf-bucket-container").children(":visible");var s=p.find(".as3cf-bucket-error");r=("undefined"===typeof r)?null:r;if(r&&!p.hasClass(r)){return}s.find("span.title").html(t+" &mdash;");s.find("span.message").html(q);s.show();this.bucketSelectLock=false},set:function(u,s,r){var q=f(".as3cf-bucket-container."+c.prefix+" .as3cf-manual-save-bucket-form");var p=f("#"+c.prefix+"-active-bucket");if("as3cf"===c.prefix&&0===p.text().trim().length){o("as3cf-copy-to-s3-wrap");o("as3cf-serve-from-s3-wrap");var t=j.attr("id");k[t]=m(t)}f(".as3cf-error.fatal").hide();p.text(u);q.find(".as3cf-bucket-name").val(u);f("#"+c.prefix+"-bucket").val(u);f("#"+c.prefix+"-region").val(s);f(".updated").not(".as3cf-notice").show();j.addClass("as3cf-has-bucket");j.find(".as3cf-can-write-error").toggle(!r);j.find(".as3cf-bucket-error").hide();if("as3cf"===c.prefix){h()}n();c.close(b)},create:function(){var p=f(".as3cf-bucket-container."+c.prefix+" .as3cf-create-bucket-form");var r=p.find(".as3cf-bucket-name");var w=p.find(".bucket-create-region");var q=p.find("button[type=submit]");var s=r.val();var u=q.text();f(".as3cf-bucket-error").hide();q.text(q.attr("data-working"));q.prop("disabled",true);var v={action:c.prefix+"-create-bucket",bucket_name:s,_nonce:window[c.prefix.replace(/-/g,"_")].nonces.create_bucket};if(w.val()){v.region=w.val()}var t=this;f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:v,error:function(x,z,y){q.text(u);t.showError(as3cf.strings.create_bucket_error,y,"as3cf-bucket-create")},success:function(y,z,x){q.text(u);q.prop("disabled",false);if("undefined"!==typeof y.success){t.set(s,y.region,y.can_write);f(".as3cf-bucket-select-region").hide();f(".as3cf-bucket-select-region").removeAttr("selected");r.val("");q.attr("disabled",true);d=true}else{t.showError(as3cf.strings.create_bucket_error,y.error,"as3cf-bucket-create")}}})},isValidName:function(p){if(p.length<3||p.length>63){return false}if(true===g.test(p)){return false}return true},updateNameNotice:function(p){var q=null;if(true===g.test(p)){q=as3cf.strings.create_bucket_invalid_chars}else{if(p.length<3){q=as3cf.strings.create_bucket_name_short}else{if(p.length>63){q=as3cf.strings.create_bucket_name_long}}}if(q&&p.length>0){f(".as3cf-invalid-bucket-name").html(q)}else{f(".as3cf-invalid-bucket-name").html("")}}};function n(){var s=f("#"+c.prefix+"-bucket").val();var r=j.find('input[name="object-prefix"]');var q=r.val();if(""!==q){q="&prefix="+encodeURIComponent(q)}var p=as3cf.aws_bucket_link+s+q;f("#"+c.prefix+"-view-bucket").attr("href",p)}function h(){f(".as3cf-url-preview").html("Generating...");var p={_nonce:as3cf.nonces.get_url_preview};f.each(f("#tab-"+as3cf.tabs.defaultTab+" .as3cf-main-settings form").serializeArray(),function(r,s){var t=s.name,q=s.value;t=t.replace("[]","");p[t]=undefined===p[t]?q:f.isArray(p[t])?p[t].concat(q):[p[t],q]});p.action="as3cf-get-url-preview";f.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:p,error:function(q,s,r){alert(as3cf.strings.get_url_preview_error+r)},success:function(r,s,q){if("undefined"!==typeof r.success){f(".as3cf-url-preview").html(r.url)}else{alert(as3cf.strings.get_url_preview_error+r.error)}}})}function b(p){as3cf.buckets.bucketSelectLock=false}function e(){if(f("#as3cf-remove-local-file").is(":checked")&&f("#as3cf-serve-from-s3").is(":not(:checked)")){f("#as3cf-lost-files-notice").show()}else{f("#as3cf-lost-files-notice").hide()}}function a(){if(f("#as3cf-remove-local-file").is(":checked")){f("#as3cf-remove-local-notice").show()}else{f("#as3cf-remove-local-notice").hide()}}f(document).ready(function(){var q=f(".wrap.aws-main .nav-tab-wrapper");f(".aws-compatibility-notice, div.updated, div.error, div.notice").not(".below-h2, .inline").insertAfter(q);if(window.location.hash){var p=window.location.hash.substring(1);as3cf.tabs.toggle(p,true)}else{j=f("#tab-"+as3cf.tabs.defaultTab);f(".aws-main").attr("data-tab",as3cf.tabs.defaultTab)}f(".aws-main").on("click",".nav-tab",function(s){s.preventDefault();if(f(this).hasClass("nav-tab-active")){return}var r=f(this).attr("data-tab");as3cf.tabs.toggle(r);if("media"===r){window.location.hash="";if("function"===typeof window.history.replaceState&&"#"===window.location.href.slice(-1)){history.replaceState({},"",window.location.href.slice(0,-1))}}else{window.location.hash=r}});if(i.length){i.each(function(r,s){k[s.id]=m(s.id)})}f(window).on("beforeunload.as3cf-settings",function(){if(f.isEmptyObject(k)){return}var r=j.attr("id");if(m(r)!==k[r]){return as3cf.strings.save_alert}});f(document).on("submit",".as3cf-main-settings form",function(r){f(window).off("beforeunload.as3cf-settings")});f(".as3cf-switch").on("click",function(r){if(!f(this).hasClass("disabled")){o(f(this).attr("id"))}});i.on("change",".sub-toggle",function(s){var r=f(this).attr("id");f(".as3cf-setting."+r).toggleClass("hide")});f(".as3cf-domain").on("change",'input[type="radio"]',function(v){var r=f(this).closest('input:radio[name="domain"]:checked');var u=r.val();var t=f(this).parents(".as3cf-domain").find(".as3cf-setting.cloudfront");var s=("cloudfront"===u);t.toggleClass("hide",!s)});f(".url-preview").on("change","input",function(r){h()});e();f("#as3cf-serve-from-s3,#as3cf-remove-local-file").on("change",function(r){e()});a();f("#as3cf-remove-local-file").on("change",function(r){a()});f('.as3cf-setting input[type="text"]').keypress(function(r){if(13===r.which){r.preventDefault();return false}});f('input[name="cloudfront"]').on("keyup",function(r){l(f(this))});f('input[name="domain"]').on("change",function(r){var t=f(this);var s=f("#"+j.attr("id")+' form button[type="submit"]');if("cloudfront"!==t.val()){s.attr("disabled",false)}else{l(t.next(".as3cf-setting").find('input[name="cloudfront"]'))}});f('input[name="object-prefix"]').on("change",function(r){n()});f("#tab-media > .as3cf-bucket-error").detach().insertAfter(".as3cf-bucket-container h3");f("body").on("click",".bucket-action-manual",function(r){r.preventDefault();f(".as3cf-bucket-container."+c.prefix+" .as3cf-bucket-manual").show().siblings().hide()});f("body").on("click",".bucket-action-browse",function(r){r.preventDefault();f(".as3cf-bucket-container."+c.prefix+" .as3cf-bucket-select").show().siblings().hide();as3cf.buckets.loadList(d);d=false});f("body").on("click",".bucket-action-create",function(r){r.preventDefault();f(".as3cf-bucket-name").val("");f(".as3cf-invalid-bucket-name").html("");f(".as3cf-bucket-container."+c.prefix+" .as3cf-bucket-create").show().siblings().hide()});f("body").on("click",".bucket-action-cancel",function(r){r.preventDefault();as3cf.buckets.resetModal()});f("body").on("click",".bucket-action-save",function(r){r.preventDefault();as3cf.buckets.saveManual()});f("body").on("click",'.as3cf-create-bucket-form button[type="submit"]',function(r){r.preventDefault();as3cf.buckets.create()});f("body").on("click",".bucket-action-refresh",function(r){r.preventDefault();as3cf.buckets.loadList(true)});f("body").on("click",".as3cf-bucket-list a",function(r){r.preventDefault();as3cf.buckets.saveSelected(f(this))});f(".as3cf-bucket-container").on("click","a.js-link",function(r){r.preventDefault();window.open(f(this).attr("href"));return false});f("body").on("as3cf-modal-open",function(s,r){if(".as3cf-bucket-container."+c.prefix===r){as3cf.buckets.resetModal();var t=f(".as3cf-bucket-manual h3").data("modal-title");f(".as3cf-bucket-manual h3").text(t);as3cf.buckets.disabledButtons()}});as3cf.buckets.disabledButtons();f("body").on("input keyup",".as3cf-create-bucket-form .as3cf-bucket-name",function(t){var s=f(this).val();var r=f(".as3cf-bucket-container."+c.prefix+" .as3cf-create-bucket-form");if(as3cf.buckets.isValidName(s)){r.find("button[type=submit]").removeAttr("disabled")}else{r.find("button[type=submit]").attr("disabled",true)}as3cf.buckets.updateNameNotice(s)});f("body").on("input keyup",".as3cf-manual-save-bucket-form .as3cf-bucket-name",function(s){var r=f(".as3cf-bucket-container."+c.prefix+" .as3cf-manual-save-bucket-form");if(r.find(".as3cf-bucket-name").val().length<as3cf.buckets.validLength){r.find("button[type=submit]").attr("disabled",true)}else{r.find("button[type=submit]").removeAttr("disabled")}})})})(jQuery,as3cfModal);