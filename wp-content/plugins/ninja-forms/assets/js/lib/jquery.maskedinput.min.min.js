!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(g){var d,h=navigator.userAgent,b=/iphone/i.test(h),c=/chrome/i.test(h),f=/android/i.test(h);g.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},g.fn.extend({caret:function(i,a){var j;return 0===this.length||this.is(":hidden")?void 0:"number"==typeof i?(a="number"==typeof a?a:i,this.each(function(){this.setSelectionRange?this.setSelectionRange(i,a):this.createTextRange&&(j=this.createTextRange(),j.collapse(!0),j.moveEnd("character",a),j.moveStart("character",i),j.select())})):(this[0].setSelectionRange?(i=this[0].selectionStart,a=this[0].selectionEnd):document.selection&&document.selection.createRange&&(j=document.selection.createRange(),i=0-j.duplicate().moveStart("character",-100000),a=i+j.text.length),{begin:i,end:a})},unmask:function(){return this.trigger("unmask")},mask:function(e,a){var t,j,v,q,w,p,k,i;if(!e&&this.length>0){t=g(this[0]);var r=t.data(g.mask.dataName);return r?r():void 0}return a=g.extend({autoclear:g.mask.autoclear,placeholder:g.mask.placeholder,completed:null},a),j=g.mask.definitions,v=[],q=k=e.length,w=null,g.each(e.split(""),function(m,l){"?"==l?(k--,q=m):j[l]?(v.push(new RegExp(j[l])),null===w&&(w=v.length-1),q>m&&(p=v.length-1)):v.push(null)}),this.trigger("unmask").each(function(){function H(){if(a.completed){for(var x=w;p>=x;x++){v[x]&&m[x]===G(x)&&console.log("reset")}}else{}}function G(x){return a.placeholder.charAt(x<a.placeholder.length?x:0)}function n(x){for(;++x<k&&!v[x];){}return x}function M(x){for(;--x>=0&&!v[x];){}return x}function J(A,y){var C,x;if(!(0>A)){for(C=A,x=n(y);k>C;C++){if(v[C]){if(!(k>x&&v[C].test(m[x]))){break}m[C]=m[x],m[x]=G(x),x=n(x)}}o(),L.caret(Math.max(w,A))}}function u(C){var A,D,x,y;for(A=C,D=G(C);k>A;A++){if(v[A]){if(x=n(A),y=m[A],m[A]=D,!(k>x&&v[x].test(y))){break}D=y}}}function I(){var y=L.val(),x=L.caret();if(i&&i.length&&i.length>y.length){for(s(!0);x.begin>0&&!v[x.begin-1];){x.begin--}if(0===x.begin){for(;x.begin<w&&!v[x.begin];){x.begin++}}L.caret(x.begin,x.begin)}else{for(s(!0);x.begin<k&&!v[x.begin];){x.begin++}L.caret(x.begin,x.begin)}H()}function K(){s(),L.val()!=N&&L.change()}function B(C){if(!L.prop("readonly")){var y,D,x,A=C.which||C.keyCode;i=L.val(),8===A||46===A||b&&127===A?(y=L.caret(),D=y.begin,x=y.end,x-D===0&&(D=46!==A?M(D):x=n(D-1),x=46===A?n(x):x),z(D,x),J(D,x-1),C.preventDefault()):13===A?K.call(this,C):27===A&&(L.val(N),L.caret(0,s()),C.preventDefault())}}function F(C){if(!L.prop("readonly")){var O,y,A,E=C.which||C.keyCode,x=L.caret();if(!(C.ctrlKey||C.altKey||C.metaKey||32>E)&&E&&13!==E){if(x.end-x.begin!==0&&(z(x.begin,x.end),J(x.begin,x.end-1)),O=n(x.begin-1),k>O&&(y=String.fromCharCode(E),v[O].test(y))){if(u(O),m[O]=y,o(),A=n(O),f){var D=function(){g.proxy(g.fn.caret,L,A)()};setTimeout(D,0)}else{L.caret(A)}x.begin<=p&&H()}C.preventDefault()}}}function z(y,x){var A;for(A=y;x>A&&k>A;A++){v[A]&&(m[A]=G(A))}}function o(){L.val(m.join(""))}function s(D){var A,E,x,y=L.val(),C=-1;for(A=0,x=0;k>A;A++){if(v[A]){for(m[A]=G(A);x++<y.length;){if(E=y.charAt(x-1),v[A].test(E)){m[A]=E,C=A;break}}if(x>y.length){z(A+1,k);break}}else{m[A]===y.charAt(x)&&x++,q>A&&(C=A)}}return D?o():q>C+1?a.autoclear||m.join("")===l?(L.val()&&L.val("").trigger("change"),z(0,k)):o():(o(),L.val(L.val().substring(0,C+1))),q?A:w}var L=g(this),m=g.map(e.split(""),function(y,x){return"?"!=y?j[y]?G(x):y:void 0}),l=m.join(""),N=L.val();L.data(g.mask.dataName,function(){return g.map(m,function(y,x){return v[x]&&y!=G(x)?y:null}).join("")}),L.one("unmask",function(){L.off(".mask").removeData(g.mask.dataName)}).on("focus.mask",function(){if(!L.prop("readonly")){clearTimeout(d);var x;N=L.val(),x=s(),d=setTimeout(function(){L.get(0)===document.activeElement&&(o(),x==e.replace("?","").length?L.caret(0,x):L.caret(x))},10)}}).on("blur.mask",K).on("keydown.mask",B).on("keypress.mask",F).on("input.mask paste.mask",function(){L.prop("readonly")||setTimeout(function(){var x=s(!0);L.caret(x),H(),console.log("blur!")},0)}),c&&f&&L.off("input.mask").on("input.mask",I),s()})}})});