/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */
(function(b,c){if("function"==typeof define&&define.amd){define(["backbone","underscore"],function(e,f){return b.Marionette=b.Mn=c(b,e,f)})}else{if("undefined"!=typeof exports){var a=require("backbone"),d=require("underscore");module.exports=c(b,a,d)}else{b.Marionette=b.Mn=c(b,b.Backbone,b._)}}})(this,function(b,g,a){(function(l,m){var h=l.ChildViewContainer;return l.ChildViewContainer=function(p,q){var o=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),q.each(e,this.add,this)};q.extend(o.prototype,{add:function(s,u){var n=s.cid;return this._views[n]=s,s.model&&(this._indexByModel[s.model.cid]=n),u&&(this._indexByCustom[u]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(n){var s=this._indexByModel[n];return this.findByCid(s)},findByCustom:function(n){var s=this._indexByCustom[n];return this.findByCid(s)},findByIndex:function(e){return q.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(n){var e=n.cid;return n.model&&delete this._indexByModel[n.model.cid],q.any(this._indexByCustom,function(s,u){return s===e?(delete this._indexByCustom[u],!0):void 0},this),delete this._views[e],this._updateLength(),this},call:function(e){this.apply(e,q.tail(arguments))},apply:function(n,e){q.each(this._views,function(s){q.isFunction(s[n])&&s[n].apply(s,e||[])})},_updateLength:function(){this.length=q.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return q.each(r,function(e){o.prototype[e]=function(){var s=q.values(this._views),t=[s].concat(q.toArray(arguments));return q[e].apply(q,t)}}),o}(l,m),l.ChildViewContainer.VERSION="0.1.7",l.ChildViewContainer.noConflict=function(){return l.ChildViewContainer=h,this},l.ChildViewContainer})(g,a),function(l,m){var h=l.Wreqr,o=l.Wreqr={};return l.Wreqr.VERSION="1.3.3",l.Wreqr.noConflict=function(){return l.Wreqr=h,this},o.Handlers=function(p,q){var n=function(e){this.options=e,this._wreqrHandlers={},q.isFunction(this.initialize)&&this.initialize(e)};return n.extend=p.Model.extend,q.extend(n.prototype,p.Events,{setHandlers:function(e){q.each(e,function(s,r){var u=null;q.isObject(s)&&!q.isFunction(s)&&(u=s.context,s=s.callback),this.setHandler(r,s,u)},this)},setHandler:function(s,u,r){var v={callback:u,context:r};this._wreqrHandlers[s]=v,this.trigger("handler:add",s,u,r)},hasHandler:function(e){return !!this._wreqrHandlers[e]},getHandler:function(r){var s=this._wreqrHandlers[r];if(s){return function(){return s.callback.apply(s.context,arguments)}}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(l,m),o.CommandStorage=function(){var e=function(n){this.options=n,this._commands={},m.isFunction(this.initialize)&&this.initialize(n)};return m.extend(e.prototype,l.Events,{getCommands:function(n){var p=this._commands[n];return p||(p={command:n,instances:[]},this._commands[n]=p),p},addCommand:function(p,q){var n=this.getCommands(p);n.instances.push(q)},clearCommands:function(n){var p=this.getCommands(n);p.instances=[]}}),e}(),o.Commands=function(n,p){return n.Handlers.extend({storageType:n.CommandStorage,constructor:function(q){this.options=q||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),n.Handlers.prototype.constructor.apply(this,arguments)},execute:function(q){q=arguments[0];var e=p.rest(arguments);this.hasHandler(q)?this.getHandler(q).apply(this,e):this.storage.addCommand(q,e)},_executeCommands:function(q,e,u){var s=this.storage.getCommands(q);p.each(s.instances,function(r){e.apply(u,r)}),this.storage.clearCommands(q)},_initializeStorage:function(q){var e,r=q.storageType||this.storageType;e=p.isFunction(r)?new r:r,this.storage=e}})}(o,m),o.RequestResponse=function(n,p){return n.Handlers.extend({request:function(e){return this.hasHandler(e)?this.getHandler(e).apply(this,p.rest(arguments)):void 0}})}(o,m),o.EventAggregator=function(p,q){var n=function(){};return n.extend=p.Model.extend,q.extend(n.prototype,p.Events),n}(l,m),o.Channel=function(){var e=function(n){this.vent=new l.Wreqr.EventAggregator,this.reqres=new l.Wreqr.RequestResponse,this.commands=new l.Wreqr.Commands,this.channelName=n};return m.extend(e.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(n,p){return this._connect("vent",n,p),this},connectCommands:function(n,p){return this._connect("commands",n,p),this},connectRequests:function(n,p){return this._connect("reqres",n,p),this},_connect:function(q,p,u){if(p){u=u||this;var s="vent"===q?"on":"setHandler";m.each(p,function(n,r){this[q][s](r,m.bind(n,u))},this)}}}),e}(o),o.radio=function(q,u){var p=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};u.extend(p.prototype,{channel:function(e){if(!e){throw Error("Channel must receive a name")}return this._getChannel(e)},_getChannel:function(r){var n=this._channels[r];return n||(n=new q.Channel(r),this._channels[r]=n),n},_proxyMethods:function(){u.each(["vent","commands","reqres"],function(e){u.each(v[e],function(n){this[e][n]=s(this,e,n)},this)},this)}});var v={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},s=function(r,e,w){return function(t){var n=r._getChannel(t)[e];return n[w].apply(n,u.rest(arguments))}};return new p}(o,m),l.Wreqr}(g,a);var k=b.Marionette,f=b.Mn,d=g.Marionette={};d.VERSION="2.4.2",d.noConflict=function(){return b.Marionette=k,b.Mn=f,this},g.Marionette=d,d.Deferred=g.$.Deferred,d.extend=g.Model.extend,d.isNodeAttached=function(e){return g.$.contains(document.documentElement,e)},d.mergeOptions=function(h,l){h&&a.extend(this,a.pick(h,l))},d.getOption=function(h,l){return h&&l?h.options&&void 0!==h.options[l]?h.options[l]:h[l]:void 0},d.proxyGetOption=function(e){return d.getOption(this,e)},d._getValue=function(h,l,m){return a.isFunction(h)&&(h=m?h.apply(l,m):h.call(l)),h},d.normalizeMethods=function(e){return a.reduce(e,function(h,l,m){return a.isFunction(l)||(l=this[l]),l&&(h[m]=l),h},{},this)},d.normalizeUIString=function(h,l){return h.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return l[e.slice(4)]})},d.normalizeUIKeys=function(h,l){return a.reduce(h,function(m,e,p){var o=d.normalizeUIString(p,l);return m[o]=e,m},{})},d.normalizeUIValues=function(h,l,m){return a.each(h,function(e,n){a.isString(e)?h[n]=d.normalizeUIString(e,l):a.isObject(e)&&a.isArray(m)&&(a.extend(e,d.normalizeUIValues(a.pick(e,m),l)),a.each(m,function(o){var p=e[o];a.isString(p)&&(e[o]=d.normalizeUIString(p,l))}))}),h},d.actAsCollection=function(h,l){var m=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];a.each(m,function(e){h[e]=function(){var n=a.values(a.result(this,l)),o=[n].concat(a.toArray(arguments));return a[e].apply(a,o)}})};var j=d.deprecate=function(h,l){a.isObject(h)&&(h=h.prev+" is going to be removed in the future. Please use "+h.next+" instead."+(h.url?" See: "+h.url:"")),void 0!==l&&l||j._cache[h]||(j._warn("Deprecation warning: "+h),j._cache[h]=!0)};j._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},j._cache={},d._triggerMethod=function(){function h(n,o,m){return m.toUpperCase()}var l=/(^|:)(\w)/gi;return function(v,q,p){var u=3>arguments.length;u&&(p=q,q=p[0]);var m,e="on"+q.replace(l,h),t=v[e];return a.isFunction(t)&&(m=t.apply(v,u?a.rest(p):p)),a.isFunction(v.trigger)&&(u+p.length>1?v.trigger.apply(v,u?p:[q].concat(a.drop(p,0))):v.trigger(q)),m}}(),d.triggerMethod=function(){return d._triggerMethod(this,arguments)},d.triggerMethodOn=function(h){var l=a.isFunction(h.triggerMethod)?h.triggerMethod:d.triggerMethod;return l.apply(h,a.rest(arguments))},d.MonitorDOMRefresh=function(h){function m(){h._isShown=!0,l()}function o(){h._isRendered=!0,l()}function l(){h._isShown&&h._isRendered&&d.isNodeAttached(h.el)&&a.isFunction(h.triggerMethod)&&h.triggerMethod("dom:refresh")}h.on({show:m,render:o})},function(h){function p(w,A,v,t){var z=t.split(/\s+/);a.each(z,function(e){var n=w[e];if(!n){throw new h.Error('Method "'+e+'" was configured as an event handler, but does not exist.')}w.listenTo(A,v,n)})}function u(r,s,o,v){r.listenTo(s,o,v)}function m(o,z,A,w){var v=w.split(/\s+/);a.each(v,function(e){var n=o[e];o.stopListening(z,A,n)})}function l(r,s,o,v){r.stopListening(s,o,v)}function q(w,A,v,t,z){if(A&&v){if(!a.isObject(v)){throw new h.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"})}v=h._getValue(v,w),a.each(v,function(e,n){a.isFunction(e)?t(w,A,n,e):z(w,A,n,e)})}}h.bindEntityEvents=function(n,e,o){q(n,e,o,u,p)},h.unbindEntityEvents=function(o,r,n){q(o,r,n,l,m)},h.proxyBindEntityEvents=function(o,n){return h.bindEntityEvents(this,o,n)},h.proxyUnbindEntityEvents=function(o,n){return h.unbindEntityEvents(this,o,n)}}(d);var c=["description","fileName","lineNumber","name","message","number"];return d.Error=d.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+d.VERSION+"/",constructor:function(h,l){a.isObject(h)?(l=h,h=l.message):l||(l={});var m=Error.call(this,h);a.extend(this,a.pick(m,c),a.pick(l,c)),this.captureStackTrace(),l.url&&(this.url=this.urlRoot+l.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,d.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),d.Error.extend=d.extend,d.Callbacks=function(){this._deferred=d.Deferred(),this._callbacks=[]},a.extend(d.Callbacks.prototype,{add:function(h,l){var m=a.result(this._deferred,"promise");this._callbacks.push({cb:h,ctx:l}),m.then(function(e){l&&(e.context=l),h.call(e.context,e.options)})},run:function(h,l){this._deferred.resolve({options:h,context:l})},reset:function(){var e=this._callbacks;this._deferred=d.Deferred(),this._callbacks=[],a.each(e,function(h){this.add(h.cb,h.ctx)},this)}}),d.Controller=function(e){this.options=e||{},a.isFunction(this.initialize)&&this.initialize(this.options)},d.Controller.extend=d.extend,a.extend(d.Controller.prototype,g.Events,{destroy:function(){return d._triggerMethod(this,"before:destroy",arguments),d._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:d.triggerMethod,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption}),d.Object=function(e){this.options=a.extend({},a.result(this,"options"),e),this.initialize.apply(this,arguments)},d.Object.extend=d.extend,a.extend(d.Object.prototype,g.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:d.triggerMethod,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.Region=d.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof g.$?this.el[0]:this.el,!this.el){throw new d.Error({name:"NoElError",message:'An "el" must be specified for a region.'})}this.$el=this.getEl(this.el),d.Object.call(this,e)},show:function(E,z){if(this._ensureElement()){this._ensureViewIsIntact(E);var q=z||{},m=E!==this.currentView,p=!!q.preventDestroy,v=!!q.forceShow,C=!!this.currentView,A=m&&!p,s=m||v;if(C&&this.triggerMethod("before:swapOut",this.currentView,this,z),this.currentView&&delete this.currentView._parent,A?this.empty():C&&s&&this.currentView.off("destroy",this.empty,this),s){E.once("destroy",this.empty,this),E.render(),E._parent=this,C&&this.triggerMethod("before:swap",E,this,z),this.triggerMethod("before:show",E,this,z),d.triggerMethodOn(E,"before:show",E,this,z),C&&this.triggerMethod("swapOut",this.currentView,this,z);var B=d.isNodeAttached(this.el),D=[],w=a.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},q);return B&&w.triggerBeforeAttach&&(D=this._displayedViews(E),this._triggerAttach(D,"before:")),this.attachHtml(E),this.currentView=E,B&&w.triggerAttach&&(D=this._displayedViews(E),this._triggerAttach(D)),C&&this.triggerMethod("swap",E,this,z),this.triggerMethod("show",E,this,z),d.triggerMethodOn(E,"show",E,this,z),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(h,l){var m=(l||"")+"attach";a.each(h,function(e){d.triggerMethodOn(e,m,e,this)},this)},_displayedViews:function(e){return a.union([e],a.result(e,"_getNestedViews")||[])},_ensureElement:function(){if(a.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl")){return !1}throw new d.Error('An "el" '+this.$el.selector+" must exist in DOM")}return !0},_ensureViewIsIntact:function(e){if(!e){throw new d.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."})}if(e.isDestroyed){throw new d.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})}},getEl:function(e){return g.$(e,d._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(l){var m=this.currentView,h=d._getValue(l,"preventDestroy",this);return m?(m.off("destroy",this.empty,this),this.triggerMethod("before:empty",m),h||this._destroyView(),this.triggerMethod("empty",m),delete this.currentView,h&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&(e.remove(),e.isDestroyed=!0)},attachView:function(e){return this.currentView=e,this},hasView:function(){return !!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(h,l){if(a.isString(h)){return this._buildRegionFromSelector(h,l)}if(h.selector||h.el||h.regionClass){return this._buildRegionFromObject(h,l)}if(a.isFunction(h)){return this._buildRegionFromRegionClass(h)}throw new d.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(h,l){return new l({el:h})},_buildRegionFromObject:function(h,m){var o=h.regionClass||m,l=a.omit(h,"selector","regionClass");return h.selector&&!l.el&&(l.el=h.selector),new o(l)},_buildRegionFromRegionClass:function(e){return new e}}),d.RegionManager=d.Controller.extend({constructor:function(e){this._regions={},this.length=0,d.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(h,l){return h=d._getValue(h,this,arguments),a.reduce(h,function(e,o,m){return a.isString(o)&&(o={selector:o}),o.selector&&(o=a.defaults({},o,l)),e[m]=this.addRegion(m,o),e},{},this)},addRegion:function(l,m){var h;return h=m instanceof d.Region?m:d.Region.buildRegion(m,d.Region),this.triggerMethod("before:add:region",l,h),h._parent=this,this._store(l,h),this.triggerMethod("add:region",l,h),h},get:function(e){return this._regions[e]},getRegions:function(){return a.clone(this._regions)},removeRegion:function(h){var l=this._regions[h];return this._remove(h,l),l},removeRegions:function(){var e=this.getRegions();return a.each(this._regions,function(h,l){this._remove(l,h)},this),e},emptyRegions:function(){var e=this.getRegions();return a.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),d.Controller.prototype.destroy.apply(this,arguments)},_store:function(h,l){this._regions[h]||this.length++,this._regions[h]=l},_remove:function(h,l){this.triggerMethod("before:remove:region",h,l),l.empty(),l.stopListening(),delete l._parent,delete this._regions[h],this.length--,this.triggerMethod("remove:region",h,l)}}),d.actAsCollection(d.RegionManager.prototype,"_regions"),d.TemplateCache=function(e){this.templateId=e},a.extend(d.TemplateCache,{templateCaches:{},get:function(l,m){var h=this.templateCaches[l];return h||(h=new d.TemplateCache(l),this.templateCaches[l]=h),h.load(m)},clear:function(){var h,l=a.toArray(arguments),m=l.length;if(m>0){for(h=0;m>h;h++){delete this.templateCaches[l[h]]}}else{this.templateCaches={}}}}),a.extend(d.TemplateCache.prototype,{load:function(h){if(this.compiledTemplate){return this.compiledTemplate}var l=this.loadTemplate(this.templateId,h);return this.compiledTemplate=this.compileTemplate(l,h),this.compiledTemplate},loadTemplate:function(h){var e=g.$(h).html();if(!e||0===e.length){throw new d.Error({name:"NoTemplateError",message:'Could not find template: "'+h+'"'})}return e},compileTemplate:function(h,l){return a.template(h,l)}}),d.Renderer={render:function(h,l){if(!h){throw new d.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."})}var m=a.isFunction(h)?h:d.TemplateCache.get(h);return m(l)}},d.View=g.View.extend({isDestroyed:!1,constructor:function(e){a.bindAll(this,"render"),e=d._getValue(e,this),this.options=a.extend({},a.result(this,"options"),e),this._behaviors=d.Behaviors(this),g.View.call(this,this.options),d.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,a.rest(arguments))},mixinTemplateHelpers:function(h){h=h||{};var l=this.getOption("templateHelpers");return l=d._getValue(l,this),a.extend(h,l)},normalizeUIKeys:function(h){var l=a.result(this,"_uiBindings");return d.normalizeUIKeys(h,l||a.result(this,"ui"))},normalizeUIValues:function(h,m){var o=a.result(this,"ui"),l=a.result(this,"_uiBindings");return d.normalizeUIValues(h,l||o,m)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(a.result(this,"triggers"));return a.reduce(e,function(l,m,h){return l[h]=this._buildViewTrigger(m),l},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),a.each(this._behaviors,function(h){h.bindEntityEvents(this.model,h.getOption("modelEvents")),h.bindEntityEvents(this.collection,h.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(l){var s=d._getValue(l||this.events,this);s=this.normalizeUIKeys(s),a.isUndefined(l)&&(this.events=s);var p={},q=a.result(this,"behaviorEvents")||{},m=this.configureTriggers(),e=a.result(this,"behaviorTriggers")||{};a.extend(p,q,s,m,e),g.View.prototype.delegateEvents.call(this,p)},undelegateEvents:function(){return g.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),a.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed){throw new d.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})}},destroy:function(){if(this.isDestroyed){return this}var e=a.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),a.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),a.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=a.result(this,"_uiBindings");this.ui={},a.each(e,function(h,l){this.ui[l]=this.$(h)},this)}},unbindUIElements:function(){this._unbindUIElements(),a.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(a.each(this.ui,function(h,l){delete this.ui[l]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(h){var m=a.isObject(h),o=a.defaults({},m?h:{},{preventDefault:!0,stopPropagation:!0}),l=m?o.event:h;return function(n){n&&(n.preventDefault&&o.preventDefault&&n.preventDefault(),n.stopPropagation&&o.stopPropagation&&n.stopPropagation());var p={view:this,model:this.model,collection:this.collection};this.triggerMethod(l,p)}},setElement:function(){var e=g.View.prototype.setElement.apply(this,arguments);return a.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=d._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],a.rest(arguments)),e},_triggerEventOnBehaviors:function(l){for(var o=d._triggerMethod,h=this._behaviors,p=0,m=h&&h.length;m>p;p++){o(h[p],l)}},_triggerEventOnParentLayout:function(m,s){var v=this._parentLayoutView();if(v){var q=d.getOption(v,"childViewEventPrefix"),u=q+":"+m;d._triggerMethod(v,[u,this].concat(s));var p=d.getOption(v,"childEvents"),l=v.normalizeMethods(p);l&&a.isFunction(l[m])&&l[m].apply(v,[this].concat(s))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?a.reduce(e,function(h,l){return l._getNestedViews?h.concat(l._getNestedViews()):h},e):e},_getAncestors:function(){for(var h=[],l=this._parent;l;){h.push(l),l=l._parent}return h},_parentLayoutView:function(){var e=this._getAncestors();return a.find(e,function(h){return h instanceof d.LayoutView})},normalizeMethods:d.normalizeMethods,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.ItemView=d.View.extend({constructor:function(){d.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection){return{}}var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,a.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var l=this.getTemplate();if(l!==!1){if(!l){throw new d.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."})}var m=this.mixinTemplateHelpers(this.serializeData()),h=d.Renderer.render(l,m,this);return this.attachElContent(h),this}},attachElContent:function(e){return this.$el.html(e),this}}),d.CollectionView=d.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(){this.once("render",this._initialEvents),this._initChildViewStorage(),d.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var h,l=this._isShown&&d.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),l&&this._triggerBeforeAttach&&(h=this._getNestedViews(),this._triggerMethodMany(h,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),l&&this._triggerAttach&&(h=this._getNestedViews(),this._triggerMethodMany(h,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(h,m,o){var l=a.drop(arguments,3);a.each(h,function(e){d.triggerMethodOn.apply(e,[e,o,e,m].concat(l))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(h,o,p){var m;if(m=void 0!==p.at?p.at:a.indexOf(this._filteredSortedModels(),h),this._shouldAddChild(h,m)){this.destroyEmptyView();var l=this.getChildView(h);this.addChild(h,l,m)}},_onCollectionRemove:function(h){var l=this.children.findByModel(h);this.removeChildView(l),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){d.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){d.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var h=this.children,m=this._filteredSortedModels(),o=a.find(m,function(n){return !h.findByModel(n)});if(o){this.render()}else{var l=a.map(m,function(q,p){var r=h.findByModel(q);return r._index=p,r.el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(l),this.triggerMethod("reorder")}},resortView:function(){d.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var h=this._filteredSortedModels(),l=a.find(h,function(n,o){var m=this.children.findByModel(n);return !m||m._index!==o},this);l&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var h,l=this._filteredSortedModels();a.each(l,function(n,m){h=this.getChildView(n),this.addChild(n,h,m)},this)},_filteredSortedModels:function(){var h,l=this.getViewComparator();return h=l?a.isString(l)||1===l.length?this.collection.sortBy(l,this):a.clone(this.collection.models).sort(a.bind(l,this)):this.collection.models,this.getOption("filter")&&(h=a.filter(h,function(m,n){return this._shouldAddChild(m,n)},this)),h},showEmptyView:function(){var h=this.getEmptyView();if(h&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var e=new g.Model;this.addEmptyView(e,h),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(l,q){var u,p=this._isShown&&!this.isBuffering&&d.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");a.isFunction(s)&&(s=s.call(this,l,this._emptyViewIndex));var m=this.buildChildView(l,q,s);m._parent=this,this.proxyChildEvents(m),this._isShown&&d.triggerMethodOn(m,"before:show",m),this.children.add(m),p&&this._triggerBeforeAttach&&(u=[m].concat(m._getNestedViews()),m.once("render",function(){this._triggerMethodMany(u,this,"before:attach")},this)),this.renderChildView(m,this._emptyViewIndex),p&&this._triggerAttach&&(u=[m].concat(m._getNestedViews()),this._triggerMethodMany(u,this,"attach")),this._isShown&&d.triggerMethodOn(m,"show",m)},getChildView:function(){var e=this.getOption("childView");if(!e){throw new d.Error({name:"NoChildViewError",message:'A "childView" must be specified'})}return e},addChild:function(l,o,h){var p=this.getOption("childViewOptions");p=d._getValue(p,this,[l,h]);var m=this.buildChildView(l,o,p);return this._updateIndices(m,!0,h),this.triggerMethod("before:add:child",m),this._addChildView(m,h),this.triggerMethod("add:child",m),m._parent=this,m},_updateIndices:function(l,m,h){this.getOption("sort")&&(m&&(l._index=h),this.children.each(function(e){e._index>=l._index&&(e._index+=m?1:-1)}))},_addChildView:function(l,m){var h,o=this._isShown&&!this.isBuffering&&d.isNodeAttached(this.el);this.proxyChildEvents(l),this._isShown&&!this.isBuffering&&d.triggerMethodOn(l,"before:show",l),this.children.add(l),o&&this._triggerBeforeAttach&&(h=[l].concat(l._getNestedViews()),l.once("render",function(){this._triggerMethodMany(h,this,"before:attach")},this)),this.renderChildView(l,m),o&&this._triggerAttach&&(h=[l].concat(l._getNestedViews()),this._triggerMethodMany(h,this,"attach")),this._isShown&&!this.isBuffering&&d.triggerMethodOn(l,"show",l)},renderChildView:function(h,l){return h.render(),this.attachHtml(this,h,l),h},buildChildView:function(h,m,o){var l=a.extend({model:h},o);return new m(l)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return !this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(h,l){h.$el.append(l)},_createBuffer:function(){var e=document.createDocumentFragment();return a.each(this._bufferedChildren,function(h){e.appendChild(h.el)}),e},attachHtml:function(l,m,h){l.isBuffering?l._bufferedChildren.splice(h,0,m):l._insertBefore(m,h)||l._insertAfter(m)},_insertBefore:function(l,m){var h,o=this.getOption("sort")&&this.children.length-1>m;return o&&(h=this.children.find(function(e){return e._index===m+1})),h?(h.$el.before(l.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new g.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),d.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(h){var m=h||{},o=!0,l=this.children.map(a.identity);return a.isUndefined(m.checkEmpty)||(o=m.checkEmpty),this.children.each(this.removeChildView,this),o&&this.checkEmpty(),l},_shouldAddChild:function(h,l){var m=this.getOption("filter");return !a.isFunction(m)||m.call(this,h,l,this.collection)},proxyChildEvents:function(h){var l=this.getOption("childViewEventPrefix");this.listenTo(h,"all",function(){var o=a.toArray(arguments),m=o[0],e=this.normalizeMethods(a.result(this,"childEvents"));o[0]=l+":"+m,o.splice(1,0,h),e!==void 0&&a.isFunction(e[m])&&e[m].apply(this,o.slice(1)),this.triggerMethod.apply(this,o)})},_getImmediateChildren:function(){return a.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),d.CompositeView=d.CollectionView.extend({constructor:function(){d.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(){var e=this.getOption("childView")||this.constructor;return e},serializeData:function(){var e={};return this.model&&(e=a.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&d.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var l={};l=this.serializeData(),l=this.mixinTemplateHelpers(l),this.triggerMethod("before:render:template");var m=this.getTemplate(),h=d.Renderer.render(m,l,this);this.attachElContent(h),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(l,m){var h=this.getChildViewContainer(l);h.append(m)},_insertAfter:function(h){var l=this.getChildViewContainer(this,h);l.append(h.el)},_appendReorderedChildren:function(h){var l=this.getChildViewContainer(this);l.append(h)},getChildViewContainer:function(l){if(l.$childViewContainer){return l.$childViewContainer}var m,h=d.getOption(l,"childViewContainer");if(h){var o=d._getValue(h,l);if(m="@"===o.charAt(0)&&l.ui?l.ui[o.substr(4)]:l.$(o),0>=m.length){throw new d.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+l.childViewContainer})}}else{m=l.$el}return l.$childViewContainer=m,m},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),d.LayoutView=d.ItemView.extend({regionClass:d.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),d.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),d.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),d.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(h,l){return this.getRegion(h).show(l)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(l,m){var h={};return h[l]=m,this._buildRegions(h)[l]},addRegions:function(e){return this.regions=a.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(h){var l={regionClass:this.getOption("regionClass"),parentEl:a.partial(a.result,this,"el")};return this.regionManager.addRegions(h,l)},_initializeRegions:function(h){var l;this._initRegionManager(),l=d._getValue(this.regions,this,[h])||{};var m=this.getOption.call(h,"regions");m=d._getValue(m,this,[h]),a.extend(l,m),l=this.normalizeUIValues(l,["selector","el"]),this.addRegions(l)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new d.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(h,l){this[h]=l,this.triggerMethod("add:region",h,l)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(h,l){delete this[h],this.triggerMethod("remove:region",h,l)})},_getImmediateChildren:function(){return a.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),d.Behavior=d.Object.extend({constructor:function(h,l){this.view=l,this.defaults=a.result(this,"defaults")||{},this.options=a.extend({},this.defaults,h),this.ui=a.extend({},a.result(l,"ui"),a.result(this,"ui")),d.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),d.Behaviors=function(l,q){function h(e,o){return q.isObject(e.behaviors)?(o=h.parseBehaviors(e,o||q.result(e,"behaviors")),h.wrap(e,o,q.keys(u)),o):{}}function v(n,o){this._view=n,this._behaviors=o,this._triggers={}}function p(e){return e._uiBindings||e.ui}var m=/^(\S+)\s*(.*)$/,u={behaviorTriggers:function(o,r){var n=new v(this,r);return n.buildBehaviorTriggers()},behaviorEvents:function(e,s){var r={};return q.each(s,function(t,A){var w={},o=q.clone(q.result(t,"events"))||{};o=l.normalizeUIKeys(o,p(t));var z=0;q.each(o,function(D,E){var F=E.match(m),B=F[1]+"."+[this.cid,A,z++," "].join(""),n=F[2],G=B+n,C=q.isFunction(D)?D:t[D];w[G]=q.bind(C,t)},this),r=q.extend(r,w)},this),r}};return q.extend(h,{behaviorsLookup:function(){throw new l.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(o,r){return o.behaviorClass?o.behaviorClass:l._getValue(h.behaviorsLookup,this,[o,r])[r]},parseBehaviors:function(e,o){return q.chain(o).map(function(B,z){var w=h.getBehaviorClass(B,z),A=new w(B,e),t=h.parseBehaviors(e,q.result(A,"behaviors"));return[A].concat(t)}).flatten().value()},wrap:function(o,e,r){q.each(r,function(s){o[s]=q.partial(u[s],o[s],e)})}}),q.extend(v.prototype,{buildBehaviorTriggers:function(){return q.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(e,r){var o=q.clone(q.result(e,"triggers"))||{};o=l.normalizeUIKeys(o,p(e)),q.each(o,q.bind(this._setHandlerForBehavior,this,e,r))},_setHandlerForBehavior:function(s,z,o,A){var w=A.replace(/^\S+/,function(e){return e+".behaviortriggers"+z});this._triggers[w]=this._view._buildViewTrigger(o)}}),h}(d,a),d.AppRouter=g.Router.extend({constructor:function(h){this.options=h||{},g.Router.apply(this,arguments);var e=this.getOption("appRoutes"),l=this._getController();this.processAppRoutes(l,e),this.on("route",this._processOnRoute,this)},appRoute:function(l,m){var h=this._getController();this._addAppRoute(h,l,m)},_processOnRoute:function(h,l){if(a.isFunction(this.onRoute)){var m=a.invert(this.getOption("appRoutes"))[h];this.onRoute(h,m,l)}},processAppRoutes:function(h,l){if(l){var m=a.keys(l).reverse();a.each(m,function(e){this._addAppRoute(h,e,l[e])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(h,m,o){var l=h[o];if(!l){throw new d.Error('Method "'+o+'" was not found on the controller')}this.route(m,o,a.bind(l,h))},mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,triggerMethod:d.triggerMethod,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.Application=d.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new d.Callbacks,this.submodules={},a.extend(this,e),this._initChannel(),d.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(h,m){var o=d.Module.getClass(m),l=a.toArray(arguments);return l.unshift(this),o.create.apply(o,l)},getRegionManager:function(){return new d.RegionManager},_initializeRegions:function(h){var l=a.isFunction(this.regions)?this.regions(h):this.regions||{};this._initRegionManager();var m=d.getOption(h,"regions");return a.isFunction(m)&&(m=m.call(this,h)),a.extend(l,m),this.addRegions(l),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){d._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(h,l){this[h]=l,d._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){d._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],d._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=a.result(this,"channelName")||"global",this.channel=a.result(this,"channel")||g.Wreqr.radio.channel(this.channelName),this.vent=a.result(this,"vent")||this.channel.vent,this.commands=a.result(this,"commands")||this.channel.commands,this.reqres=a.result(this,"reqres")||this.channel.reqres}}),d.Module=function(h,l,m){this.moduleName=h,this.options=a.extend({},this.options,m),this.initialize=m.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=l,a.isFunction(this.initialize)&&this.initialize(h,l,this.options)},d.Module.extend=d.extend,a.extend(d.Module.prototype,g.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(a.each(this.submodules,function(h){h.startWithParent&&h.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),a.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(h,l){this._runModuleDefinition(h,l)},_runModuleDefinition:function(e,l){if(e){var h=a.flatten([this,this.app,g,d,g.$,a,l]);e.apply(this,h)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new d.Callbacks,this._finalizerCallbacks=new d.Callbacks},triggerMethod:d.triggerMethod}),a.extend(d.Module,{create:function(l,u,w){var q=l,p=a.drop(arguments,3);u=u.split(".");var v=u.length,m=[];return m[v-1]=w,a.each(u,function(n,h){var r=q;q=this._getModule(r,n,l,w),this._addModuleDefinition(r,q,m[h],p)},this),q},_getModule:function(l,u,w,q){var p=a.extend({},q),v=this.getClass(q),m=l[u];return m||(m=new v(u,w,p),l[u]=m,l.submodules[u]=m),m},getClass:function(h){var l=d.Module;return h?h.prototype instanceof l?h:h.moduleClass||l:l},_addModuleDefinition:function(l,p,h,q){var o=this._getDefine(h),m=this._getStartWithParent(h,p);o&&p.addDefinition(o,q),this._addStartWithParent(l,p,m)},_getStartWithParent:function(h,l){var m;return a.isFunction(h)&&h.prototype instanceof d.Module?(m=l.constructor.prototype.startWithParent,a.isUndefined(m)?!0:m):a.isObject(h)?(m=h.startWithParent,a.isUndefined(m)?!0:m):!0},_getDefine:function(e){return !a.isFunction(e)||e.prototype instanceof d.Module?a.isObject(e)?e.define:null:e},_addStartWithParent:function(l,m,h){m.startWithParent=m.startWithParent&&h,m.startWithParent&&!m.startWithParentIsConfigured&&(m.startWithParentIsConfigured=!0,l.addInitializer(function(e){m.startWithParent&&m.start(e)}))}}),d});!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],b):a.Backbone.Radio=b(a._,a.Backbone)}(this,function(w,j){function C(h,l,a,f){var c=h[l];return a&&a!==c.callback&&a!==c.callback._callback||f&&f!==c.context?void 0:(delete h[l],!0)}function b(F,p,l,h){F||(F={});for(var e=p?[p]:w.keys(F),f=!1,t=0,E=e.length;E>t;t++){p=e[t],F[p]&&C(F,p,l,h)&&(f=!0)}return f}function D(a){return z[a]||(z[a]=w.partial(B.log,a))}function m(a){return w.isFunction(a)?a:function(){return a}}var A=j.Radio,B=j.Radio={};B.VERSION="1.0.1",B.noConflict=function(){return j.Radio=A,this},B.DEBUG=!1,B._debugText=function(c,f,a){return c+(a?" on the "+a+" channel":"")+': "'+f+'"'},B.debugLog=function(c,f,a){B.DEBUG&&console&&console.warn&&console.warn(B._debugText(c,f,a))};var g=/\s+/;B._eventsApi=function(f,I,e,J){if(!e){return !1}var p={};if("object"==typeof e){for(var G in e){var H=f[I].apply(f,[G,e[G]].concat(J));g.test(G)?w.extend(p,H):p[G]=H}return p}if(g.test(e)){for(var F=e.split(g),o=0,E=F.length;E>o;o++){p[F[o]]=f[I].apply(f,[F[o]].concat(J))}return p}return !1},B._callHandler=function(l,o,c){var h=c[0],f=c[1],a=c[2];switch(c.length){case 0:return l.call(o);case 1:return l.call(o,h);case 2:return l.call(o,h,f);case 3:return l.call(o,h,f,a);default:return l.apply(o,c)}};var z={};w.extend(B,{log:function(e,a){var c=w.rest(arguments,2);console.log("["+e+'] "'+a+'"',c)},tuneIn:function(a){var c=B.channel(a);return c._tunedIn=!0,c.on("all",D(a)),this},tuneOut:function(a){var c=B.channel(a);return c._tunedIn=!1,c.off("all",D(a)),delete z[a],this}}),B.Requests={request:function(o){var f=w.rest(arguments),l=B._eventsApi(this,"request",o,f);if(l){return l}var h=this.channelName,e=this._requests;if(h&&this._tunedIn&&B.log.apply(this,[h,o].concat(f)),e&&(e[o]||e["default"])){var c=e[o]||e["default"];return f=e[o]?f:arguments,B._callHandler(c.callback,c.context,f)}B.debugLog("An unhandled request was fired",o,h)},reply:function(c,f,a){return B._eventsApi(this,"reply",c,[f,a])?this:(this._requests||(this._requests={}),this._requests[c]&&B.debugLog("A request was overwritten",c,this.channelName),this._requests[c]={callback:m(f),context:a||this},this)},replyOnce:function(l,e,h){if(B._eventsApi(this,"replyOnce",l,[e,h])){return this}var f=this,c=w.once(function(){return f.stopReplying(l),m(e).apply(this,arguments)});return this.reply(l,c,h)},stopReplying:function(c,f,a){return B._eventsApi(this,"stopReplying",c)?this:(c||f||a?b(this._requests,c,f,a)||B.debugLog("Attempted to remove the unregistered request",c,this.channelName):delete this._requests,this)}},B._channels={},B.channel=function(a){if(!a){throw new Error("You must provide a name for the channel.")}return B._channels[a]?B._channels[a]:B._channels[a]=new B.Channel(a)},B.Channel=function(a){this.channelName=a},w.extend(B.Channel.prototype,j.Events,B.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var k,q,v=[j.Events,B.Commands,B.Requests];w.each(v,function(a){w.each(a,function(e,c){B[c]=function(f){return q=w.rest(arguments),k=this.channel(f),k[c].apply(k,q)}})}),B.reset=function(c){var a=c?[this._channels[c]]:this._channels;w.invoke(a,"reset")};var d=B;return d});!function(d){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=d()}else{if("function"==typeof define&&define.amd){define([],d)}else{var c;c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,c.mexp=d()}}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i){return i(g,!0)}if(f){return f(g,!0)}var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++){e(d[g])}return e}({1:[function(a,b,c){var d=a("./postfix_evaluator.js");d.prototype.formulaEval=function(){for(var a,b,c,d=[],e=this.value,f=0;f<e.length;f++){1===e[f].type||3===e[f].type?d.push({value:3===e[f].type?e[f].show:e[f].value,type:1}):13===e[f].type?d.push({value:e[f].show,type:1}):0===e[f].type?d[d.length-1]={value:e[f].show+("-"!=e[f].show?"(":"")+d[d.length-1].value+("-"!=e[f].show?")":""),type:0}:7===e[f].type?d[d.length-1]={value:(1!=d[d.length-1].type?"(":"")+d[d.length-1].value+(1!=d[d.length-1].type?")":"")+e[f].show,type:7}:10===e[f].type?(a=d.pop(),b=d.pop(),"P"===e[f].show||"C"===e[f].show?d.push({value:"<sup>"+b.value+"</sup>"+e[f].show+"<sub>"+a.value+"</sub>",type:10}):d.push({value:(1!=b.type?"(":"")+b.value+(1!=b.type?")":"")+"<sup>"+a.value+"</sup>",type:1})):2===e[f].type||9===e[f].type?(a=d.pop(),b=d.pop(),d.push({value:(1!=b.type?"(":"")+b.value+(1!=b.type?")":"")+e[f].show+(1!=a.type?"(":"")+a.value+(1!=a.type?")":""),type:e[f].type})):12===e[f].type&&(a=d.pop(),b=d.pop(),c=d.pop(),d.push({value:e[f].show+"("+c.value+","+b.value+","+a.value+")",type:12}))}return d[0].value},b.exports=d},{"./postfix_evaluator.js":5}],2:[function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){a[c]+=b}return a}function e(a,b,c,d){for(var e=0;e<d;e++){if(a[c+e]!==b[e]){return !1}}return !0}var f=a("./math_function.js"),g=["sin","cos","tan","pi","(",")","P","C","asin","acos","atan","7","8","9","int","cosh","acosh","ln","^","root","4","5","6","/","!","tanh","atanh","Mod","1","2","3","*","sinh","asinh","e","log","0",".","+","-",",","Sigma","n","Pi","pow"],h=["sin","cos","tan","&pi;","(",")","P","C","asin","acos","atan","7","8","9","Int","cosh","acosh"," ln","^","root","4","5","6","&divide;","!","tanh","atanh"," Mod ","1","2","3","&times;","sinh","asinh","e"," log","0",".","+","-",",","&Sigma;","n","&Pi;","pow"],j=[f.math.sin,f.math.cos,f.math.tan,"PI","(",")",f.math.P,f.math.C,f.math.asin,f.math.acos,f.math.atan,"7","8","9",Math.floor,f.math.cosh,f.math.acosh,Math.log,Math.pow,Math.sqrt,"4","5","6",f.math.div,f.math.fact,f.math.tanh,f.math.atanh,f.math.mod,"1","2","3",f.math.mul,f.math.sinh,f.math.asinh,"E",f.math.log,"0",".",f.math.add,f.math.sub,",",f.math.sigma,"n",f.math.Pi,Math.pow],k={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0},l=[0,0,0,3,4,5,10,10,0,0,0,1,1,1,0,0,0,0,10,0,1,1,1,2,7,0,0,2,1,1,1,2,0,0,3,0,1,6,9,9,11,12,13,12,8],m={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0},n={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0},o={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0},p={},q={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0},r={1:!0},s=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];f.addToken=function(a){for(i=0;i<a.length;i++){x=a[i].token.length;var b=-1;if(x<s.length){for(y=0;y<s[x].length;y++){if(a[i].token===s[x][y]){b=g.indexOf(s[x][y]);break}}}b===-1?(g.push(a[i].token),l.push(a[i].type),s.length<=a[i].token.length&&(s[a[i].token.length]=[]),s[a[i].token.length].push(a[i].token),j.push(a[i].value),h.push(a[i].show)):(g[b]=a[i].token,l[b]=a[i].type,j[b]=a[i].value,h[b]=a[i].show)}},f.lex=function(a,b){var c,i,t,u,v=[{type:4,value:"(",show:"(",pre:0}],w=[],x=a,y=0,z=m,A=0,B=p,C="";"undefined"!=typeof b&&f.addToken(b);var D={};for(i=0;i<x.length;i++){if(" "!=x[i]){c="";a:for(t=x.length-i>s.length-2?s.length-1:x.length-i;t>0;t--){for(u=0;u<s[t].length;u++){if(e(x,s[t][u],i,t)){c=s[t][u];break a}}}if(i+=c.length-1,""===c){throw new f.exception("Can't understand after "+x.slice(i))}var E=g.indexOf(c),F=c,G=l[E],H=j[E],I=k[G],J=h[E],K=v[v.length-1];for(L=w.length;L--;){if(0===w[L]&&[0,2,3,5,9,11,12,13].indexOf(G)!==-1){if(z[G]!==!0){throw new f.exception(c+" is not allowed after "+C)}v.push({value:")",type:5,pre:0,show:")"}),z=n,B=q,d(w,-1).pop()}}if(z[G]!==!0){throw new f.exception(c+" is not allowed after "+C)}if(B[G]===!0&&(G=2,H=f.math.mul,J="&times;",I=3,i-=c.length),D={value:H,type:G,pre:I,show:J},0===G){z=m,B=p,d(w,2).push(2),v.push(D),v.push({value:"(",type:4,pre:0,show:"("})}else{if(1===G){1===K.type?(K.value+=H,d(w,1)):v.push(D),z=n,B=o}else{if(2===G){z=m,B=p,d(w,2),v.push(D)}else{if(3===G){v.push(D),z=n,B=q}else{if(4===G){y+=w.length,w=[],A++,z=m,B=p,v.push(D)}else{if(5===G){if(!A){throw new f.exception("Closing parenthesis are more than opening one, wait What!!!")}for(;y--;){v.push({value:")",type:5,pre:0,show:")"})}y=0,A--,z=n,B=q,v.push(D)}else{if(6===G){if(K.hasDec){throw new f.exception("Two decimals are not allowed in one number")}1!==K.type&&(K={value:0,type:1,pre:0},v.push(K),d(w,-1)),z=r,d(w,1),B=p,K.value+=H,K.hasDec=!0}else{7===G&&(z=n,B=q,d(w,1),v.push(D))}}}}}}}8===G?(z=m,B=p,d(w,4).push(4),v.push(D),v.push({value:"(",type:4,pre:0,show:"("})):9===G?(9===K.type?K.value===f.math.add?(K.value=H,K.show=J,d(w,1)):K.value===f.math.sub&&"-"===J&&(K.value=f.math.add,K.show="+",d(w,1)):5!==K.type&&7!==K.type&&1!==K.type&&3!==K.type&&13!==K.type?"-"===F&&(z=m,B=p,d(w,2).push(2),v.push({value:f.math.changeSign,type:0,pre:21,show:"-"}),v.push({value:"(",type:4,pre:0,show:"("})):(v.push(D),d(w,2)),z=m,B=p):10===G?(z=m,B=p,d(w,2),v.push(D)):11===G?(z=m,B=p,v.push(D)):12===G?(z=m,B=p,d(w,6).push(6),v.push(D),v.push({value:"(",type:4,pre:0})):13===G&&(z=n,B=q,v.push(D)),d(w,-1),C=c}}for(var L=w.length;L--;){0===w[L]&&(v.push({value:")",show:")",type:5,pre:3}),d(w,-1).pop())}if(z[5]!==!0){throw new f.exception("complete the expression")}for(;A--;){v.push({value:")",show:")",type:5,pre:3})}return v.push({type:5,value:")",show:")",pre:0}),new f(v)},b.exports=f},{"./math_function.js":3}],3:[function(a,b,c){var d=function(a){this.value=a};d.math={isDegree:!0,acos:function(a){return d.math.isDegree?180/Math.PI*Math.acos(a):Math.acos(a)},add:function(a,b){return a+b},asin:function(a){return d.math.isDegree?180/Math.PI*Math.asin(a):Math.asin(a)},atan:function(a){return d.math.isDegree?180/Math.PI*Math.atan(a):Math.atan(a)},acosh:function(a){return Math.log(a+Math.sqrt(a*a-1))},asinh:function(a){return Math.log(a+Math.sqrt(a*a+1))},atanh:function(a){return Math.log((1+a)/(1-a))},C:function(a,b){var c=1,e=a-b,f=b;f<e&&(f=e,e=b);for(var g=f+1;g<=a;g++){c*=g}return c/d.math.fact(e)},changeSign:function(a){return -a},cos:function(a){return d.math.isDegree&&(a=d.math.toRadian(a)),Math.cos(a)},cosh:function(a){return(Math.pow(Math.E,a)+Math.pow(Math.E,-1*a))/2},div:function(a,b){return a/b},fact:function(a){if(a%1!==0){return"NAN"}for(var b=1,c=2;c<=a;c++){b*=c}return b},inverse:function(a){return 1/a},log:function(a){return Math.log(a)/Math.log(10)},mod:function(a,b){return a%b},mul:function(a,b){return a*b},P:function(a,b){for(var c=1,d=Math.floor(a)-Math.floor(b)+1;d<=Math.floor(a);d++){c*=d}return c},Pi:function(a,b,c){for(var d=1,e=a;e<=b;e++){d*=Number(c.postfixEval({n:e}))}return d},pow10x:function(a){for(var b=1;a--;){b*=10}return b},sigma:function(a,b,c){for(var d=0,e=a;e<=b;e++){d+=Number(c.postfixEval({n:e}))}return d},sin:function(a){return d.math.isDegree&&(a=d.math.toRadian(a)),Math.sin(a)},sinh:function(a){return(Math.pow(Math.E,a)-Math.pow(Math.E,-1*a))/2},sub:function(a,b){return a-b},tan:function(a){return d.math.isDegree&&(a=d.math.toRadian(a)),Math.tan(a)},tanh:function(a){return d.sinha(a)/d.cosha(a)},toRadian:function(a){return a*Math.PI/180}},d.exception=function(a){this.message=a},b.exports=d},{}],4:[function(a,b,c){var d=a("./lexer.js");d.prototype.toPostfix=function(){for(var a,b,c,e,f,g=[],h=[{value:"(",type:4,pre:0}],i=this.value,j=1;j<i.length;j++){if(1===i[j].type||3===i[j].type||13===i[j].type){1===i[j].type&&(i[j].value=Number(i[j].value)),g.push(i[j])}else{if(4===i[j].type){h.push(i[j])}else{if(5===i[j].type){for(;4!==(b=h.pop()).type;){g.push(b)}}else{if(11===i[j].type){for(;4!==(b=h.pop()).type;){g.push(b)}h.push(b)}else{a=i[j],e=a.pre,f=h[h.length-1],c=f.pre;var k="Math.pow"==f.value&&"Math.pow"==a.value;if(e>c){h.push(a)}else{for(;c>=e&&!k||k&&e<c;){b=h.pop(),f=h[h.length-1],g.push(b),c=f.pre,k="Math.pow"==a.value&&"Math.pow"==f.value}h.push(a)}}}}}}return new d(g)},b.exports=d},{"./lexer.js":2}],5:[function(a,b,c){var d=a("./postfix.js");d.prototype.postfixEval=function(a){a=a||{},a.PI=Math.PI,a.E=Math.E;for(var b,c,e,f=[],g=this.value,h="undefined"!=typeof a.n,i=0;i<g.length;i++){1===g[i].type?f.push({value:g[i].value,type:1}):3===g[i].type?f.push({value:a[g[i].value],type:1}):0===g[i].type?"undefined"==typeof f[f.length-1].type?f[f.length-1].value.push(g[i]):f[f.length-1].value=g[i].value(f[f.length-1].value):7===g[i].type?"undefined"==typeof f[f.length-1].type?f[f.length-1].value.push(g[i]):f[f.length-1].value=g[i].value(f[f.length-1].value):8===g[i].type?(b=f.pop(),c=f.pop(),f.push({type:1,value:g[i].value(c.value,b.value)})):10===g[i].type?(b=f.pop(),c=f.pop(),"undefined"==typeof c.type?(c.value=c.concat(b),c.value.push(g[i]),f.push(c)):"undefined"==typeof b.type?(b.unshift(c),b.push(g[i]),f.push(b)):f.push({type:1,value:g[i].value(c.value,b.value)})):2===g[i].type||9===g[i].type?(b=f.pop(),c=f.pop(),"undefined"==typeof c.type?(console.log(c),c=c.concat(b),c.push(g[i]),f.push(c)):"undefined"==typeof b.type?(b.unshift(c),b.push(g[i]),f.push(b)):f.push({type:1,value:g[i].value(c.value,b.value)})):12===g[i].type?(b=f.pop(),"undefined"!=typeof b.type&&(b=[b]),c=f.pop(),e=f.pop(),f.push({type:1,value:g[i].value(e.value,c.value,new d(b))})):13===g[i].type&&(h?f.push({value:a[g[i].value],type:3}):f.push([g[i]]))}if(f.length>1){throw new d.exception("Uncaught Syntax error")}return f[0].value>1000000000000000?"Infinity":Number(f[0].value.toFixed(15)).toPrecision()},d.eval=function(a,b,c){return"undefined"==typeof b?this.lex(a).toPostfix().postfixEval():"undefined"==typeof c?"undefined"!=typeof b.length?this.lex(a,b).toPostfix().postfixEval():this.lex(a).toPostfix().postfixEval(b):this.lex(a,b).toPostfix().postfixEval(c)},b.exports=d},{"./postfix.js":4}]},{},[1])(1)});var nfRadio=Backbone.Radio;nfRadio.channel("form").on("render:view",function(){jQuery(".g-recaptcha").each(function(){var b=jQuery(this).data("callback");var a=jQuery(this).data("fieldid");if(typeof window[b]!=="function"){window[b]=function(c){nfRadio.channel("recaptcha").request("update:response",c,a)}}})});var nfRecaptcha=Marionette.Object.extend({initialize:function(){if(0!=jQuery(".g-recaptcha").length){this.renderCaptcha()}this.listenTo(nfRadio.channel("form"),"render:view",this.renderCaptcha)},renderCaptcha:function(){jQuery(".g-recaptcha").each(function(){var a={fieldid:jQuery(this).data("fieldid"),size:jQuery(this).data("size"),theme:jQuery(this).data("theme"),sitekey:jQuery(this).data("sitekey"),callback:jQuery(this).data("callback")};var c=grecaptcha.render(jQuery(this)[0],a);if(a.size==="invisible"){try{grecaptcha.execute(c)}catch(b){console.log("Notice: Error trying to execute grecaptcha.")}}})}});var nfRenderRecaptcha=function(){new nfRecaptcha()};