(function(c){var d=Backbone.View.extend({el:c("#key-fields"),events:{"click input#update_api_key":"saveKey"},initialize:function(){_.bindAll(this,"saveKey")},block:function(){c(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})},unblock:function(){c(this.el).unblock()},initTipTip:function(a){c(document.body).on("click",a,function(b){b.preventDefault();if(!document.queryCommandSupported("copy")){c(a).parent().find("input").focus().select();c("#copy-error").text(woocommerce_admin_api_keys.clipboard_failed)}else{c("#copy-error").text("");wcClearClipboard();wcSetClipboard(c.trim(c(this).prev("input").val()),c(a))}}).on("aftercopy",a,function(){c("#copy-error").text("");c(a).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()}).on("aftercopyerror",a,function(){c(a).parent().find("input").focus().select();c("#copy-error").text(woocommerce_admin_api_keys.clipboard_failed)})},createQRCode:function(a,b){c("#keys-qrcode").qrcode({text:a+"|"+b,width:120,height:120})},saveKey:function(a){a.preventDefault();var b=this;b.block();Backbone.ajax({method:"POST",dataType:"json",url:woocommerce_admin_api_keys.ajax_url,data:{action:"woocommerce_update_api_key",security:woocommerce_admin_api_keys.update_api_nonce,key_id:c("#key_id",b.el).val(),description:c("#key_description",b.el).val(),user:c("#key_user",b.el).val(),permissions:c("#key_permissions",b.el).val()},success:function(j){c(".wc-api-message",b.el).remove();if(j.success){var h=j.data;c("h3",b.el).first().append('<div class="wc-api-message updated"><p>'+h.message+"</p></div>");if(0<h.consumer_key.length&&0<h.consumer_secret.length){c("#api-keys-options",b.el).remove();c("p.submit",b.el).empty().append(h.revoke_url);var i=wp.template("api-keys-template");c("p.submit",b.el).before(i({consumer_key:h.consumer_key,consumer_secret:h.consumer_secret}));b.createQRCode(h.consumer_key,h.consumer_secret);b.initTipTip(".copy-key");b.initTipTip(".copy-secret")}else{c("#key_description",b.el).val(h.description);c("#key_user",b.el).val(h.user_id);c("#key_permissions",b.el).val(h.permissions)}}else{c("h3",b.el).first().append('<div class="wc-api-message error"><p>'+j.data.message+"</p></div>")}b.unblock()}})}});new d()})(jQuery);