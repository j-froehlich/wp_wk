jQuery(function(d){if(typeof wc_checkout_params==="undefined"){return false}d.blockUI.defaults.overlayCSS.cursor="default";var c={updateTimer:false,dirtyInput:false,xhr:false,$order_review:d("#order_review"),$checkout_form:d("form.checkout"),init:function(){d(document.body).bind("update_checkout",this.update_checkout);d(document.body).bind("init_checkout",this.init_checkout);this.$checkout_form.on("click",'input[name="payment_method"]',this.payment_method_selected);if(d(document.body).hasClass("woocommerce-order-pay")){this.$order_review.on("click",'input[name="payment_method"]',this.payment_method_selected)}this.$checkout_form.attr("novalidate","novalidate");this.$checkout_form.on("submit",this.submit);this.$checkout_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field);this.$checkout_form.on("update",this.trigger_update_checkout);this.$checkout_form.on("change",'select.shipping_method, input[name^="shipping_method"], #ship-to-different-address input, .update_totals_on_change select, .update_totals_on_change input[type="radio"], .update_totals_on_change input[type="checkbox"]',this.trigger_update_checkout);this.$checkout_form.on("change",".address-field select",this.input_changed);this.$checkout_form.on("change",".address-field input.input-text, .update_totals_on_change input.input-text",this.maybe_input_changed);this.$checkout_form.on("keydown",".address-field input.input-text, .update_totals_on_change input.input-text",this.queue_update_checkout);this.$checkout_form.on("change","#ship-to-different-address input",this.ship_to_different_address);this.$checkout_form.find("#ship-to-different-address input").change();this.init_payment_methods();if(wc_checkout_params.is_checkout==="1"){d(document.body).trigger("init_checkout")}if(wc_checkout_params.option_guest_checkout==="yes"){d("input#createaccount").change(this.toggle_create_account).change()}},init_payment_methods:function(g){var f=d(".woocommerce-checkout").find('input[name="payment_method"]');if(1===f.length){f.eq(0).hide()}if(g){d("#"+g).prop("checked",true)}if(0===f.filter(":checked").length){f.eq(0).prop("checked",true)}f.filter(":checked").eq(0).trigger("click")},get_payment_method:function(){return c.$checkout_form.find('input[name="payment_method"]:checked').val()},payment_method_selected:function(){if(d(".payment_methods input.input-radio").length>1){var f=d("div.payment_box."+d(this).attr("ID"));if(d(this).is(":checked")&&!f.is(":visible")){d("div.payment_box").filter(":visible").slideUp(250);if(d(this).is(":checked")){d("div.payment_box."+d(this).attr("ID")).slideDown(250)}}}else{d("div.payment_box").show()}if(d(this).data("order_button_text")){d("#place_order").val(d(this).data("order_button_text"))}else{d("#place_order").val(d("#place_order").data("value"))}},toggle_create_account:function(){d("div.create-account").hide();if(d(this).is(":checked")){d("#account_password").val("").change();d("div.create-account").slideDown()}},init_checkout:function(){d("#billing_country, #shipping_country, .country_to_state").change();d(document.body).trigger("update_checkout")},maybe_input_changed:function(f){if(c.dirtyInput){c.input_changed(f)}},input_changed:function(f){c.dirtyInput=f.target;c.maybe_update_checkout()},queue_update_checkout:function(g){var f=g.keyCode||g.which||0;if(f===9){return true}c.dirtyInput=this;c.reset_update_checkout_timer();c.updateTimer=setTimeout(c.maybe_update_checkout,"1000")},trigger_update_checkout:function(){c.reset_update_checkout_timer();c.dirtyInput=false;d(document.body).trigger("update_checkout")},maybe_update_checkout:function(){var f=true;if(d(c.dirtyInput).length){var g=d(c.dirtyInput).closest("div").find(".address-field.validate-required");if(g.length){g.each(function(){if(d(this).find("input.input-text").val()===""){f=false}})}}if(f){c.trigger_update_checkout()}},ship_to_different_address:function(){d("div.shipping_address").hide();if(d(this).is(":checked")){d("div.shipping_address").slideDown()}},reset_update_checkout_timer:function(){clearTimeout(c.updateTimer)},is_valid_json:function(g){try{var f=d.parseJSON(g);return(f&&"object"===typeof f)}catch(h){return false}},validate_field:function(k){var j=d(this),i=j.closest(".form-row"),l=true,h=i.is(".validate-required"),f=i.is(".validate-email"),m=k.type;if("input"===m){i.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-validated")}if("validate"===m||"change"===m){if(h){if("checkbox"===j.attr("type")&&!j.is(":checked")){i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field");l=false}else{if(j.val()===""){i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field");l=false}}}if(f){if(j.val()){var g=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);if(!g.test(j.val())){i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-email");l=false}}}if(l){i.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email").addClass("woocommerce-validated")}}},update_checkout:function(g,f){c.reset_update_checkout_timer();c.updateTimer=setTimeout(c.update_checkout_action,"5",f)},update_checkout_action:function(r){if(c.xhr){c.xhr.abort()}if(d("form.checkout").length===0){return}r=typeof r!=="undefined"?r:{update_shipping_method:true};var h=d("#billing_country").val(),f=d("#billing_state").val(),o=d("input#billing_postcode").val(),l=d("#billing_city").val(),u=d("input#billing_address_1").val(),i=d("input#billing_address_2").val(),t=h,p=f,s=o,k=l,n=u,g=i,q=d(c.$checkout_form).find(".address-field.validate-required:visible"),j=true;if(q.length){q.each(function(){if(d(this).find(":input").val()===""){j=false}})}if(d("#ship-to-different-address").find("input").is(":checked")){t=d("#shipping_country").val();p=d("#shipping_state").val();s=d("input#shipping_postcode").val();k=d("#shipping_city").val();n=d("input#shipping_address_1").val();g=d("input#shipping_address_2").val()}var m={security:wc_checkout_params.update_order_review_nonce,payment_method:c.get_payment_method(),country:h,state:f,postcode:o,city:l,address:u,address_2:i,s_country:t,s_state:p,s_postcode:s,s_city:k,s_address:n,s_address_2:g,has_full_address:j,post_data:d("form.checkout").serialize()};if(false!==r.update_shipping_method){var v={};d('select.shipping_method, input[name^="shipping_method"][type="radio"]:checked, input[name^="shipping_method"][type="hidden"]').each(function(){v[d(this).data("index")]=d(this).val()});m.shipping_method=v}d(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});c.xhr=d.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","update_order_review"),data:m,success:function(y){var A=d('.woocommerce-checkout input[name="payment_method"]:checked').attr("id");if(true===y.reload){window.location.reload();return}d(".woocommerce-NoticeGroup-updateOrderReview").remove();var x=d("#terms").prop("checked");var z={};d(".payment_box input").each(function(){var B=d(this).attr("id");if(B){if(d.inArray(d(this).attr("type"),["checkbox","radio"])!==-1){z[B]=d(this).prop("checked")}else{z[B]=d(this).val()}}});if(y&&y.fragments){d.each(y.fragments,function(B,C){d(B).replaceWith(C);d(B).unblock()})}if(x){d("#terms").prop("checked",true)}if(!d.isEmptyObject(z)){d(".payment_box input").each(function(){var B=d(this).attr("id");if(B){if(d.inArray(d(this).attr("type"),["checkbox","radio"])!==-1){d(this).prop("checked",z[B]).change()}else{if(0===d(this).val().length){d(this).val(z[B]).change()}}}})}if("failure"===y.result){var w=d("form.checkout");d(".woocommerce-error, .woocommerce-message").remove();if(y.messages){w.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview">'+y.messages+"</div>")}else{w.prepend(y)}w.find(".input-text, select, input:checkbox").trigger("validate").blur();d("html, body").animate({scrollTop:(d("form.checkout").offset().top-100)},1000)}c.init_payment_methods(A);d(document.body).trigger("updated_checkout",[y])}})},submit:function(){c.reset_update_checkout_timer();var f=d(this);if(f.is(".processing")){return false}if(f.triggerHandler("checkout_place_order")!==false&&f.triggerHandler("checkout_place_order_"+c.get_payment_method())!==false){f.addClass("processing");var g=f.data();if(1!==g["blockUI.isBlocked"]){f.block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})}d.ajaxSetup({dataFilter:function(j,i){if("json"!==i){return j}if(c.is_valid_json(j)){return j}else{var h=j.match(/{"result.*}/);if(null===h){console.log("Unable to fix malformed JSON")}else{if(c.is_valid_json(h[0])){console.log("Fixed malformed JSON. Original:");console.log(j);j=h[0]}else{console.log("Unable to fix malformed JSON")}}}return j}});d.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:f.serialize(),dataType:"json",success:function(h){try{if("success"===h.result){if(-1===h.redirect.indexOf("https://")||-1===h.redirect.indexOf("http://")){window.location=h.redirect}else{window.location=decodeURI(h.redirect)}}else{if("failure"===h.result){throw"Result failure"}else{throw"Invalid response"}}}catch(i){if(true===h.reload){window.location.reload();return}if(true===h.refresh){d(document.body).trigger("update_checkout")}if(h.messages){c.submit_error(h.messages)}else{c.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}}},error:function(h,j,i){c.submit_error('<div class="woocommerce-error">'+i+"</div>")}})}return false},submit_error:function(f){d(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove();c.$checkout_form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+f+"</div>");c.$checkout_form.removeClass("processing").unblock();c.$checkout_form.find(".input-text, select, input:checkbox").trigger("validate").blur();d("html, body").animate({scrollTop:(d("form.checkout").offset().top-100)},1000);d(document.body).trigger("checkout_error")}};var e={init:function(){d(document.body).on("click","a.showcoupon",this.show_coupon_form);d(document.body).on("click",".woocommerce-remove-coupon",this.remove_coupon);d("form.checkout_coupon").hide().submit(this.submit)},show_coupon_form:function(){d(".checkout_coupon").slideToggle(400,function(){d(".checkout_coupon").find(":input:eq(0)").focus()});return false},submit:function(){var f=d(this);if(f.is(".processing")){return false}f.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var g={security:wc_checkout_params.apply_coupon_nonce,coupon_code:f.find('input[name="coupon_code"]').val()};d.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:g,success:function(h){d(".woocommerce-error, .woocommerce-message").remove();f.removeClass("processing").unblock();if(h){f.before(h);f.slideUp();d(document.body).trigger("update_checkout",{update_shipping_method:false})}},dataType:"html"});return false},remove_coupon:function(i){i.preventDefault();var f=d(this).parents(".woocommerce-checkout-review-order"),g=d(this).data("coupon");f.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var h={security:wc_checkout_params.remove_coupon_nonce,coupon:g};d.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_coupon"),data:h,success:function(j){d(".woocommerce-error, .woocommerce-message").remove();f.removeClass("processing").unblock();if(j){d("form.woocommerce-checkout").before(j);d(document.body).trigger("update_checkout",{update_shipping_method:false});d("form.checkout_coupon").find('input[name="coupon_code"]').val("")}},error:function(j){if(wc_checkout_params.debug_mode){console.log(j.responseText)}},dataType:"html"})}};var b={init:function(){d(document.body).on("click","a.showlogin",this.show_login_form)},show_login_form:function(){d("form.login, form.woocommerce-form--login").slideToggle();return false}};var a={init:function(){d(document.body).on("click","a.woocommerce-terms-and-conditions-link",this.toggle_terms)},toggle_terms:function(){if(d(".woocommerce-terms-and-conditions").length){d(".woocommerce-terms-and-conditions").slideToggle();return false}}};c.init();e.init();b.init();a.init()});