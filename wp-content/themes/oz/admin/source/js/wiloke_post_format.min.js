!function(a){"use strict";a.fn.wilokePostFormatMediaPopup=function(b){var c=a(this),d={parent:"",title:"My Photos",button:"Select",multiple:!0,isPreview:!0,buttonClass:null,return:"id",init:function(){},select:function(){}},e=a.extend(d,c.data(),b),f="",g={$el:c,options:e,$button:a(".wiloke-button",c),$input:a(".wiloke-media-value",c),template:'<li class="wiloke-image"><img src="" alt=""/><div class="wiloke-control-wrap"><i class="wiloke-edit dashicons dashicons-edit"></i><i class="wiloke-close dashicons dashicons-no-alt"></i></div></li>',$showImage:"",media:null,init:function(){var a=this;a.options.isPreview&&a.createHTML(),a.setMedia(),a.events()},createHTML:function(){var c,b=this;c=""==b.options.parent?b.$el:a(b.options.parent).length?a(b.options.parent):b.$el,a("ul.list-wiloke-image-media",c).length||c.prepend('<ul class="list-wiloke-image-media"></ul>'),b.options.isPreview||a(".list-wiloke-image-media",c).addClass("hidden"),b.$showImage=a(".list-wiloke-image-media",c)},events:function(){var b=this;b.setValueToInput(),b.options.multiple&&b.options.isPreview&&b.$showImage.sortable({revert:200,containment:"parent",update:function(){b.$input.trigger("change")}}),null!==b.options.buttonClass?c.on("click",b.options.buttonClass,function(d){d.preventDefault(),b.$input=a(".wiloke-media-value",c),b.setValueToInput(),f=b.$showImage,b.media.open()}):b.$button.on("click",function(a){a.preventDefault(),f=b.$showImage,b.media.open()}),b.options.isPreview&&(b.$showImage.on("click",".wiloke-edit",function(c){c.preventDefault(),f=a(this).closest(".wiloke-image"),b.media.open()}),b.$showImage.on("click",".wiloke-close",function(c){c.stopPropagation(),c.preventDefault(),a(this).closest("li").remove(),b.$input.trigger("change")})),b.media.on("select",function(){var c=b.media.state().get("selection");b.options.isPreview?(c.each(function(c,d){c=c.toJSON();var e=c.sizes&&c.sizes.thumbnail&&c.sizes.thumbnail.url?c.sizes.thumbnail.url:c.url,g=a(b.template).attr("data-id",c.id).attr("data-url",c.url);a("img",g).attr("src",e),b.options.multiple?f.hasClass("list-wiloke-image-media")?f.append(g):0==d?("url"==b.options.return?f.attr("data-url",c.url):f.attr("data-id",c.id),a("img",f).attr("src",e)):f.after(g):b.$showImage.empty().append(g)}),b.$input.trigger("change")):c.each(function(a,c){a=a.toJSON(),b.$input.val(a.url)})})},setMedia:function(){var a=this;a.media=wp.media({title:e.title,button:{text:e.button},multiple:e.multiple})},setValueToInput:function(){var b=this;b.options.isPreview&&b.$input.change(function(){var c=[];b.$showImage.children(".wiloke-image").each(function(){a(this).data(b.options.return)&&c.push(a(this).data(b.options.return))}),c=c.join(","),b.$input.val(c)})}};return g.init()},a.fn.wilokePostFormatAudioPopup=function(b){var c=a(this),d={title:"My Audio",button:"Select",afterInit:function(a){}},e=a.extend(d,c.data(),b),f={$el:c,options:e,audio:null,$button:a(".wiloke-button",c),$input:a(".wiloke-audio-value",c),init:function(){var a=this;a.createAudio(),a.events(),a.options.afterInit(a)},createAudio:function(){var a=this;a.audio=wp.media({title:a.options.title,button:{text:a.options.button},library:{type:"audio"},multiple:!1})},events:function(){var a=this;a.$button.click(function(){a.audio.open()}),a.audio.on("select",function(){var b=a.audio.state().get("selection");b.each(function(b,c){a.$input.val(b.toJSON().url).trigger("change")})})}};return f.init()},a.fn.wilokeCheckValidationVideo=function(b){var c=a(this),d={},e=a.extend(d,c.data(),b),f={$el:c,options:e,$notice:null,$showImage:null,init:function(){var a=this;a.createHTML(),a.events()},createHTML:function(){var a=this;a.$el.next(".wiloke-show-notice").length||a.$el.after('<ul class="wiloke-show-notice"><li class="wiloke-notice-button wiloke-url-pass"><i class="fa fa-check"></i></li><li class="wiloke-notice-button wiloke-url-not-pass"><i class="fa fa-close"></i></li></ul>'),a.$notice=a.$el.next(".wiloke-show-notice"),a.$notice.next(".wiloke-show-image").length||a.$notice.after('<div class="wiloke-show-image"><img src="" alt=""/></div>'),a.$imageShow=a.$notice.next(".wiloke-show-image")},events:function(){var b=this;b.$el.change(function(){var c=a(this).val(),d="",e="";if(c.indexOf("youtube")!=-1){var c=c.match('(?:youtube(?:-nocookie)?.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&]v=)|youtu.be/)([^"&?/ ]{11})');c&&c[1]&&(d=c[1],e="youtube")}else c.indexOf("vimeo")!=-1?(c=c.match("(https?://)?(www.)?(player.)?vimeo.com/([a-z]*/)*([0-9]{6,11})[?]?.*"),c&&c[5]&&(d=c[5],e="vimeo")):e="";if(a(".wiloke-notice-button",b.$notice).removeClass("active"),b.$imageShow.removeClass("wiloke-ajax-loading").hide(),""!=e){a(".wiloke-url-pass",b.$notice).addClass("active");var f="";"youtube"==e?(f="http://img.youtube.com/vi/"+d+"/0.jpg",a("img",b.$imageShow).attr("src",f),b.$imageShow.show()):"vimeo"==e&&(b.$imageShow.addClass("wiloke-ajax-loading"),a.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+d+".json",jsonp:"callback",dataType:"jsonp",success:function(c){if(b.$imageShow.hasClass("wiloke-ajax-loading")){var d=c[0].thumbnail_large;b.$imageShow.removeClass("wiloke-ajax-loading"),a("img",b.$imageShow).attr("src",d)}b.$imageShow.show()}}))}else""!=a(this).val()&&a(".wiloke-url-not-pass",b.$notice).addClass("active")})}};return f.init()},a.fn.wilokePostFormat=function(b){var c={init:function(){},active:function(){}},d=a.extend(c,b),e=a(this),f={$el:e,$controls:a("#wiloke-controls-post-format",e),$handles:a("#wiloke-handle-post-format",e),media:null,options:d,init:function(){var b=this;b.$el.show(200),b.setMedia(),b.events(),a("#formatdiv").hide(),a("li.active",b.$controls).trigger("click")},events:function(){var b=this;a("li",b.$controls).click(function(c){c.preventDefault();var d=a("a",this).attr("href"),e=a(d),f=a(this).data("format");e.length&&e.trigger("click"),a("li",b.$controls).removeClass("active"),a(this).addClass("active"),b.$handles.children().hide();var g=a("#wiloke-post-format-"+f);g.show();var h="";switch(f){case"video":h=a("#wiloke-video-field-url",g);break;case"audio":h=a("#wiloke-audio-field-url",g);break;case"quote":h=a("#wiloke-quote-field-content",g)}if(h.length){h.focus();var i=h.val();h.val("").val(i)}});var c=a("#wiloke-post-format-gallery"),d=a(".wiloke-type-gallery",c);d.change(function(){var b=a(this).val(),c=a(this).prev();c.val(b)}).trigger("change"),d.prev().change(function(){d.val(a(this).val())});var e=a("#wiloke-video-field-url");e.wilokeCheckValidationVideo(),""!=e.val()&&e.trigger("change")},setMedia:function(){var b=this;a(".wiloke-button-media",b.$handles).each(function(){a(this).wilokePostFormatMediaPopup()}),a(".wiloke-button-audio",b.$handles).each(function(){a(this).wilokePostFormatAudioPopup({afterInit:function(c){c.$input.change(function(){a("#wiloke-audio-field-url",b.$handles).val(a(this).val()).trigger("change")})}})})}};return f.init()},a(document).ready(function(){a("#wiloke-post-format-wrapper").wilokePostFormat({})})}(jQuery);