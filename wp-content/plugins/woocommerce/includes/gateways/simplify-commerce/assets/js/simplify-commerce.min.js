(function(b){function c(){var m=b("form.checkout, form#order_review, form#add_payment_method");if((b("#payment_method_simplify_commerce").is(":checked")&&"new"===b('input[name="wc-simplify_commerce-payment-token"]:checked').val())||("1"===b("#woocommerce_add_payment_method").val())){if(0===b("input.simplify-token").length){m.block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var i=b("#simplify_commerce-card-number").val(),g=b("#simplify_commerce-card-cvc").val(),h=b.payment.cardExpiryVal(b("#simplify_commerce-card-expiry").val()),f=m.find("#billing_address_1").val()||"",d=m.find("#billing_address_2").val()||"",j=m.find("#billing_country").val()||"",l=m.find("#billing_state").val()||"",k=m.find("#billing_city").val()||"",e=m.find("#billing_postcode").val()||"";e=e.replace(/-/g,"");i=i.replace(/\s/g,"");SimplifyCommerce.generateToken({key:Simplify_commerce_params.key,card:{number:i,cvc:g,expMonth:h.month,expYear:(h.year-2000),addressLine1:f,addressLine2:d,addressCountry:j,addressState:l,addressZip:e,addressCity:k}},a);return false}}return true}function a(j){var e=b("form.checkout, form#order_review, form#add_payment_method"),h=b("#wc-simplify_commerce-cc-form");if(j.error){b(".woocommerce-error, .simplify-token",h).remove();e.unblock();if("validation"===j.error.code){var d=j.error.fieldErrors,f=d.length,k="";for(var g=0;g<f;g++){k+="<li>"+Simplify_commerce_params[d[g].field]+" "+Simplify_commerce_params.is_invalid+" - "+d[g].message+".</li>"}h.prepend('<ul class="woocommerce-error">'+k+"</ul>")}}else{h.append('<input type="hidden" class="simplify-token" name="simplify_token" value="'+j.id+'"/>');e.submit()}}b(function(){b(document.body).on("checkout_error",function(){b(".simplify-token").remove()});b("form.checkout").on("checkout_place_order_simplify_commerce",function(){return c()});b("form#order_review").on("submit",function(){return c()});b("form#add_payment_method").on("submit",function(){return c()});b("form.checkout, form#order_review, form#add_payment_method").on("change","#wc-simplify_commerce-cc-form input",function(){b(".simplify-token").remove()})})}(jQuery));