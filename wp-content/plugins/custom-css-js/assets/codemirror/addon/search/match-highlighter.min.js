"use strict";(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],a):a(CodeMirror)})(function(t){function b(g){this.options={};for(var f in s){this.options[f]=(g&&g.hasOwnProperty(f)?g:s)[f]}this.matchesonscroll=this.overlay=this.timeout=null;this.active=!1}function o(g){var f=g.state.matchHighlighter;(f.active||g.hasFocus())&&j(g,f)}function i(g){var f=g.state.matchHighlighter;f.active||(f.active=!0,j(g,f))}function j(g,f){clearTimeout(f.timeout);f.timeout=setTimeout(function(){e(g)},f.options.delay)}function d(g,f,k,l){var h=g.state.matchHighlighter;g.addOverlay(h.overlay=a(f,k,l));h.options.annotateScrollbar&&g.showMatchesOnScrollbar&&(h.matchesonscroll=g.showMatchesOnScrollbar(k?new RegExp("\\b"+f+"\\b"):f,!1,{className:"CodeMirror-selection-highlight-scrollbar"}))}function c(g){var f=g.state.matchHighlighter;f.overlay&&(g.removeOverlay(f.overlay),f.overlay=null,f.matchesonscroll&&(f.matchesonscroll.clear(),f.matchesonscroll=null))}function e(f){f.operation(function(){var g=f.state.matchHighlighter;c(f);if(!f.somethingSelected()&&g.options.showToken){for(var l=!0===g.options.showToken?/[\w$]/:g.options.showToken,m=f.getCursor(),k=f.getLine(m.line),h=m=m.ch;m&&l.test(k.charAt(m-1));){--m}for(;h<k.length&&l.test(k.charAt(h));){++h}m<h&&d(f,k.slice(m,h),l,g.options.style)}else{if(l=f.getCursor("from"),k=f.getCursor("to"),l.line==k.line){if(m=g.options.wordsOnly){f:if(null!==f.getRange(l,k).match(/^\w+$/)){if(0<l.ch&&(m={line:l.line,ch:l.ch-1},m=f.getRange(m,l),null===m.match(/\W/))){m=!1;break f}if(k.ch<f.getLine(l.line).length&&(m={line:k.line,ch:k.ch+1},m=f.getRange(k,m),null===m.match(/\W/))){m=!1;break f}m=!0}else{m=!1}m=!m}m||(l=f.getRange(l,k),g.options.trim&&(l=l.replace(/^\s+|\s+$/g,"")),l.length>=g.options.minChars&&d(f,l,!1,g.options.style))}}})}function a(g,f,h){return{token:function(l){var k;if(k=l.match(g)){(k=!f)||(k=(!l.start||!f.test(l.string.charAt(l.start-1)))&&(l.pos==l.string.length||!f.test(l.string.charAt(l.pos))))}if(k){return h}l.next();l.skipTo(g.charAt(0))||l.skipToEnd()}}}var s={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};t.defineOption("highlightSelectionMatches",!1,function(g,f,h){h&&h!=t.Init&&(c(g),clearTimeout(g.state.matchHighlighter.timeout),g.state.matchHighlighter=null,g.off("cursorActivity",o),g.off("focus",i));if(f){f=g.state.matchHighlighter=new b(f);if(g.hasFocus()){f.active=!0,e(g)}else{g.on("focus",i)}g.on("cursorActivity",o)}})});