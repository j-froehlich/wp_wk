jQuery(function(i){if(typeof wc_checkout_params==="undefined"){return false}i.blockUI.defaults.overlayCSS.cursor="default";var j={updateTimer:false,dirtyInput:false,xhr:false,$order_review:i("#order_review"),$checkout_form:i("form.checkout"),init:function(){i(document.body).bind("update_checkout",this.update_checkout);i(document.body).bind("init_checkout",this.init_checkout);this.$checkout_form.on("click",'input[name="payment_method"]',this.payment_method_selected);if(i(document.body).hasClass("woocommerce-order-pay")){this.$order_review.on("click",'input[name="payment_method"]',this.payment_method_selected)}this.$checkout_form.attr("novalidate","novalidate");this.$checkout_form.on("submit",this.submit);this.$checkout_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field);this.$checkout_form.on("update",this.trigger_update_checkout);this.$checkout_form.on("change",'select.shipping_method, input[name^="shipping_method"], #ship-to-different-address input, .update_totals_on_change select, .update_totals_on_change input[type="radio"], .update_totals_on_change input[type="checkbox"]',this.trigger_update_checkout);this.$checkout_form.on("change",".address-field select",this.input_changed);this.$checkout_form.on("change",".address-field input.input-text, .update_totals_on_change input.input-text",this.maybe_input_changed);this.$checkout_form.on("keydown",".address-field input.input-text, .update_totals_on_change input.input-text",this.queue_update_checkout);this.$checkout_form.on("change","#ship-to-different-address input",this.ship_to_different_address);this.$checkout_form.find("#ship-to-different-address input").change();this.init_payment_methods();if(wc_checkout_params.is_checkout==="1"){i(document.body).trigger("init_checkout")}if(wc_checkout_params.option_guest_checkout==="yes"){i("input#createaccount").change(this.toggle_create_account).change()}},init_payment_methods:function(a){var b=i(".woocommerce-checkout").find('input[name="payment_method"]');if(1===b.length){b.eq(0).hide()}if(a){i("#"+a).prop("checked",true)}if(0===b.filter(":checked").length){b.eq(0).prop("checked",true)}b.filter(":checked").eq(0).trigger("click")},get_payment_method:function(){return j.$checkout_form.find('input[name="payment_method"]:checked').val()},payment_method_selected:function(){if(i(".payment_methods input.input-radio").length>1){var a=i("div.payment_box."+i(this).attr("ID"));if(i(this).is(":checked")&&!a.is(":visible")){i("div.payment_box").filter(":visible").slideUp(250);if(i(this).is(":checked")){i("div.payment_box."+i(this).attr("ID")).slideDown(250)}}}else{i("div.payment_box").show()}if(i(this).data("order_button_text")){i("#place_order").val(i(this).data("order_button_text"))}else{i("#place_order").val(i("#place_order").data("value"))}},toggle_create_account:function(){i("div.create-account").hide();if(i(this).is(":checked")){i("#account_password").val("").change();i("div.create-account").slideDown()}},init_checkout:function(){i("#billing_country, #shipping_country, .country_to_state").change();i(document.body).trigger("update_checkout")},maybe_input_changed:function(a){if(j.dirtyInput){j.input_changed(a)}},input_changed:function(a){j.dirtyInput=a.target;j.maybe_update_checkout()},queue_update_checkout:function(a){var b=a.keyCode||a.which||0;if(b===9){return true}j.dirtyInput=this;j.reset_update_checkout_timer();j.updateTimer=setTimeout(j.maybe_update_checkout,"1000")},trigger_update_checkout:function(){j.reset_update_checkout_timer();j.dirtyInput=false;i(document.body).trigger("update_checkout")},maybe_update_checkout:function(){var b=true;if(i(j.dirtyInput).length){var a=i(j.dirtyInput).closest("div").find(".address-field.validate-required");if(a.length){a.each(function(){if(i(this).find("input.input-text").val()===""){b=false}})}}if(b){j.trigger_update_checkout()}},ship_to_different_address:function(){i("div.shipping_address").hide();if(i(this).is(":checked")){i("div.shipping_address").slideDown()}},reset_update_checkout_timer:function(){clearTimeout(j.updateTimer)},is_valid_json:function(b){try{var c=i.parseJSON(b);return(c&&"object"===typeof c)}catch(a){return false}},validate_field:function(c){var d=i(this),e=d.closest(".form-row"),b=true,n=e.is(".validate-required"),p=e.is(".validate-email"),a=c.type;if("input"===a){e.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-validated")}if("validate"===a||"change"===a){if(n){if("checkbox"===d.attr("type")&&!d.is(":checked")){e.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field");b=false}else{if(d.val()===""){e.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field");b=false}}}if(p){if(d.val()){var o=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);if(!o.test(d.val())){e.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-email");b=false}}}if(b){e.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email").addClass("woocommerce-validated")}}},update_checkout:function(a,b){j.reset_update_checkout_timer();j.updateTimer=setTimeout(j.update_checkout_action,"5",b)},update_checkout_action:function(a){if(j.xhr){j.xhr.abort()}if(i("form.checkout").length===0){return}a=typeof a!=="undefined"?a:{update_shipping_method:true};var B=i("#billing_country").val(),D=i("#billing_state").val(),d=i("input#billing_postcode").val(),x=i("#billing_city").val(),F=i("input#billing_address_1").val(),A=i("input#billing_address_2").val(),G=B,c=D,H=d,y=x,e=F,C=A,b=i(j.$checkout_form).find(".address-field.validate-required:visible"),z=true;if(b.length){b.each(function(){if(i(this).find(":input").val()===""){z=false}})}if(i("#ship-to-different-address").find("input").is(":checked")){G=i("#shipping_country").val();c=i("#shipping_state").val();H=i("input#shipping_postcode").val();y=i("#shipping_city").val();e=i("input#shipping_address_1").val();C=i("input#shipping_address_2").val()}var w={security:wc_checkout_params.update_order_review_nonce,payment_method:j.get_payment_method(),country:B,state:D,postcode:d,city:x,address:F,address_2:A,s_country:G,s_state:c,s_postcode:H,s_city:y,s_address:e,s_address_2:C,has_full_address:z,post_data:i("form.checkout").serialize()};if(false!==a.update_shipping_method){var E={};i('select.shipping_method, input[name^="shipping_method"][type="radio"]:checked, input[name^="shipping_method"][type="hidden"]').each(function(){E[i(this).data("index")]=i(this).val()});w.shipping_method=E}i(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});j.xhr=i.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","update_order_review"),data:w,success:function(o){var l=i('.woocommerce-checkout input[name="payment_method"]:checked').attr("id");if(true===o.reload){window.location.reload();return}i(".woocommerce-NoticeGroup-updateOrderReview").remove();var k=i("#terms").prop("checked");var n={};i(".payment_box input").each(function(){var p=i(this).attr("id");if(p){if(i.inArray(i(this).attr("type"),["checkbox","radio"])!==-1){n[p]=i(this).prop("checked")}else{n[p]=i(this).val()}}});if(o&&o.fragments){i.each(o.fragments,function(q,p){i(q).replaceWith(p);i(q).unblock()})}if(k){i("#terms").prop("checked",true)}if(!i.isEmptyObject(n)){i(".payment_box input").each(function(){var p=i(this).attr("id");if(p){if(i.inArray(i(this).attr("type"),["checkbox","radio"])!==-1){i(this).prop("checked",n[p]).change()}else{if(0===i(this).val().length){i(this).val(n[p]).change()}}}})}if("failure"===o.result){var m=i("form.checkout");i(".woocommerce-error, .woocommerce-message").remove();if(o.messages){m.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview">'+o.messages+"</div>")}else{m.prepend(o)}m.find(".input-text, select, input:checkbox").trigger("validate").blur();i("html, body").animate({scrollTop:(i("form.checkout").offset().top-100)},1000)}j.init_payment_methods(l);i(document.body).trigger("updated_checkout",[o])}})},submit:function(){j.reset_update_checkout_timer();var b=i(this);if(b.is(".processing")){return false}if(b.triggerHandler("checkout_place_order")!==false&&b.triggerHandler("checkout_place_order_"+j.get_payment_method())!==false){b.addClass("processing");var a=b.data();if(1!==a["blockUI.isBlocked"]){b.block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})}i.ajaxSetup({dataFilter:function(c,d){if("json"!==d){return c}if(j.is_valid_json(c)){return c}else{var e=c.match(/{"result.*}/);if(null===e){console.log("Unable to fix malformed JSON")}else{if(j.is_valid_json(e[0])){console.log("Fixed malformed JSON. Original:");console.log(c);c=e[0]}else{console.log("Unable to fix malformed JSON")}}}return c}});i.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:b.serialize(),dataType:"json",success:function(d){try{if("success"===d.result){if(-1===d.redirect.indexOf("https://")||-1===d.redirect.indexOf("http://")){window.location=d.redirect}else{window.location=decodeURI(d.redirect)}}else{if("failure"===d.result){throw"Result failure"}else{throw"Invalid response"}}}catch(c){if(true===d.reload){window.location.reload();return}if(true===d.refresh){i(document.body).trigger("update_checkout")}if(d.messages){j.submit_error(d.messages)}else{j.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}}},error:function(e,c,d){j.submit_error('<div class="woocommerce-error">'+d+"</div>")}})}return false},submit_error:function(a){i(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove();j.$checkout_form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+a+"</div>");j.$checkout_form.removeClass("processing").unblock();j.$checkout_form.find(".input-text, select, input:checkbox").trigger("validate").blur();i("html, body").animate({scrollTop:(i("form.checkout").offset().top-100)},1000);i(document.body).trigger("checkout_error")}};var h={init:function(){i(document.body).on("click","a.showcoupon",this.show_coupon_form);i(document.body).on("click",".woocommerce-remove-coupon",this.remove_coupon);i("form.checkout_coupon").hide().submit(this.submit)},show_coupon_form:function(){i(".checkout_coupon").slideToggle(400,function(){i(".checkout_coupon").find(":input:eq(0)").focus()});return false},submit:function(){var b=i(this);if(b.is(".processing")){return false}b.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var a={security:wc_checkout_params.apply_coupon_nonce,coupon_code:b.find('input[name="coupon_code"]').val()};i.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:a,success:function(c){i(".woocommerce-error, .woocommerce-message").remove();b.removeClass("processing").unblock();if(c){b.before(c);b.slideUp();i(document.body).trigger("update_checkout",{update_shipping_method:false})}},dataType:"html"});return false},remove_coupon:function(a){a.preventDefault();var d=i(this).parents(".woocommerce-checkout-review-order"),c=i(this).data("coupon");d.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var b={security:wc_checkout_params.remove_coupon_nonce,coupon:c};i.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_coupon"),data:b,success:function(e){i(".woocommerce-error, .woocommerce-message").remove();d.removeClass("processing").unblock();if(e){i("form.woocommerce-checkout").before(e);i(document.body).trigger("update_checkout",{update_shipping_method:false});i("form.checkout_coupon").find('input[name="coupon_code"]').val("")}},error:function(e){if(wc_checkout_params.debug_mode){console.log(e.responseText)}},dataType:"html"})}};var f={init:function(){i(document.body).on("click","a.showlogin",this.show_login_form)},show_login_form:function(){i("form.login, form.woocommerce-form--login").slideToggle();return false}};var g={init:function(){i(document.body).on("click","a.woocommerce-terms-and-conditions-link",this.toggle_terms)},toggle_terms:function(){if(i(".woocommerce-terms-and-conditions").length){i(".woocommerce-terms-and-conditions").slideToggle();return false}}};j.init();h.init();f.init();g.init()});