/*!
 * bootstrap-tokenfield 0.12.0
 * https://github.com/sliptree/bootstrap-tokenfield
 * Copyright 2013-2014 Sliptree and other contributors; Licensed MIT
 */
;!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=global.window&&global.window.$?b(global.window.$):function(a){if(!a.$&&!a.fn){throw new Error("Tokenfield requires a window object with jQuery or a jQuery instance")}return b(a.$||a)}:b(jQuery)}(function(f,e){var h=function(L,K){var J=this;this.$element=f(L),this.textDirection=this.$element.css("direction"),this.options=f.extend(!0,{},f.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),K),this._delimiters="string"==typeof this.options.delimiter?[this.options.delimiter]:this.options.delimiter,this._triggerKeys=f.map(this._delimiters,function(c){return c.charCodeAt(0)}),this._firstDelimiter=this._delimiters[0];var I=f.inArray(" ",this._delimiters),H=f.inArray("-",this._delimiters);I>=0&&(this._delimiters[I]="\\s"),H>=0&&(delete this._delimiters[H],this._delimiters.unshift("-"));var G=["\\","$","[","{","^",".","|","?","*","+","(",")"];f.each(this._delimiters,function(i,k){var j=f.inArray(k,G);j>=0&&(J._delimiters[i]="\\"+k)});var F,E=e&&"function"==typeof e.getMatchedCSSRules?e.getMatchedCSSRules(L):null,D=L.style.width,C=this.$element.width();E&&f.each(E,function(d,c){c.style.width&&(F=c.style.width)});var B="rtl"===f("body").css("direction")?"right":"left",A={position:this.$element.css("position")};A[B]=this.$element.css(B),this.$element.data("original-styles",A).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(B,"-10000px").prop("tabindex",-1),this.$wrapper=f('<div class="tokenfield form-control" />'),this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg"),this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm"),"rtl"===this.textDirection&&this.$wrapper.addClass("rtl");var z=this.$element.prop("id")||(new Date).getTime()+""+Math.floor(100*(1+Math.random()));this.$input=f('<input type="text" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",z+"-tokenfield").prop("tabindex",this.$element.data("original-tabindex"));var y=f('label[for="'+this.$element.prop("id")+'"]');if(y.length&&y.prop("for",this.$input.prop("id")),this.$copyHelper=f('<input type="text" />').css("position","absolute").css(B,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper),D?this.$wrapper.css("width",D):F?this.$wrapper.css("width",F):this.$element.parents(".form-inline").length&&this.$wrapper.width(C),(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length)&&this.disable(),this.$element.prop("readonly")&&this.readonly(),this.$mirror=f('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),this.$input.css("min-width",this.options.minWidth+"px"),f.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(d,c){J.$mirror[0].style[c]=J.$input.css(c)}),this.$mirror.appendTo("body"),this.$wrapper.insertBefore(this.$element),this.$element.prependTo(this.$wrapper),this.update(),this.setTokens(this.options.tokens,!1,!1),this.listen(),!f.isEmptyObject(this.options.autocomplete)){var x="rtl"===this.textDirection?"right":"left",w=f.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:x+" top",at:x+" bottom",of:this.$wrapper}},this.options.autocomplete);this.$input.autocomplete(w)}if(!f.isEmptyObject(this.options.typeahead)){var v=this.options.typeahead,b={minLength:this.options.showAutocompleteOnFocus?0:null},a=f.isArray(v)?v:[v,v];a[0]=f.extend({},b,a[0]),this.$input.typeahead.apply(this.$input,a),this.typeahead=!0}this.$element.trigger("tokenfield:initialize")};h.prototype={constructor:h,createToken:function(a,n){var m=this;if("string"==typeof a&&(a={value:a,label:a}),"undefined"==typeof n&&(n=!0),a.value=f.trim(a.value),a.label=a.label&&a.label.length?f.trim(a.label):a.value,!(!a.value.length||!a.label.length||a.label.length<=this.options.minLength||this.options.limit&&this.getTokens().length>=this.options.limit)){var l=f.Event("tokenfield:createtoken",{attrs:a});if(this.$element.trigger(l),l.attrs&&!l.isDefaultPrevented()){var k=f('<div class="token" />').attr("data-value",a.value).append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>');this.$input.hasClass("tt-input")?this.$input.parent().before(k):this.$input.before(k),this.$input.css("width",this.options.minWidth+"px");var j=k.find(".token-label"),i=k.find(".close");return this.maxTokenWidth||(this.maxTokenWidth=this.$wrapper.width()-i.outerWidth()-parseInt(i.css("margin-left"),10)-parseInt(i.css("margin-right"),10)-parseInt(k.css("border-left-width"),10)-parseInt(k.css("border-right-width"),10)-parseInt(k.css("padding-left"),10)-parseInt(k.css("padding-right"),10),parseInt(j.css("border-left-width"),10)-parseInt(j.css("border-right-width"),10)-parseInt(j.css("padding-left"),10)-parseInt(j.css("padding-right"),10),parseInt(j.css("margin-left"),10)-parseInt(j.css("margin-right"),10)),j.text(a.label).css("max-width",this.maxTokenWidth),k.on("mousedown",function(){return m._disabled||m._readonly?!1:(m.preventDeactivation=!0,void 0)}).on("click",function(b){return m._disabled||m._readonly?!1:(m.preventDeactivation=!1,b.ctrlKey||b.metaKey?(b.preventDefault(),m.toggle(k)):(m.activate(k,b.shiftKey,b.shiftKey),void 0))}).on("dblclick",function(){return m._disabled||m._readonly||!m.options.allowEditing?!1:(m.edit(k),void 0)}),i.on("click",f.proxy(this.remove,this)),this.$element.trigger(f.Event("tokenfield:createdtoken",{attrs:a,relatedTarget:k.get(0)})),n&&this.$element.val(this.getTokensList()).trigger(f.Event("change",{initiator:"tokenfield"})),this.update(),this.$element.get(0)}}},setTokens:function(a,k,j){if(a){k||this.$wrapper.find(".token").remove(),"undefined"==typeof j&&(j=!0),"string"==typeof a&&(a=this._delimiters.length?a.split(new RegExp("["+this._delimiters.join("")+"]")):[a]);var i=this;return f.each(a,function(d,c){i.createToken(c,j)}),this.$element.get(0)}},getTokenData:function(a){var d=a.map(function(){var c=f(this);return{value:c.attr("data-value"),label:c.find(".token-label").text()}}).get();return 1==d.length&&(d=d[0]),d},getTokens:function(a){var k=this,j=[],i=a?".active":"";return this.$wrapper.find(".token"+i).each(function(){j.push(k.getTokenData(f(this)))}),j},getTokensList:function(a,k,j){a=a||this._firstDelimiter,k="undefined"!=typeof k&&null!==k?k:this.options.beautify;var i=a+(k&&" "!==a?" ":"");return f.map(this.getTokens(j),function(b){return b.value}).join(i)},getInput:function(){return this.$input.val()},listen:function(){var a=this;this.$element.on("change",f.proxy(this.change,this)),this.$wrapper.on("mousedown",f.proxy(this.focusInput,this)),this.$input.on("focus",f.proxy(this.focus,this)).on("blur",f.proxy(this.blur,this)).on("paste",f.proxy(this.paste,this)).on("keydown",f.proxy(this.keydown,this)).on("keypress",f.proxy(this.keypress,this)).on("keyup",f.proxy(this.keyup,this)),this.$copyHelper.on("focus",f.proxy(this.focus,this)).on("blur",f.proxy(this.blur,this)).on("keydown",f.proxy(this.keydown,this)).on("keyup",f.proxy(this.keyup,this)),this.$input.on("keypress",f.proxy(this.update,this)).on("keyup",f.proxy(this.update,this)),this.$input.on("autocompletecreate",function(){var c=f(this).data("ui-autocomplete").menu.element,i=a.$wrapper.outerWidth()-parseInt(c.css("border-left-width"),10)-parseInt(c.css("border-right-width"),10);c.css("min-width",i+"px")}).on("autocompleteselect",function(d,c){return a.createToken(c.item)&&(a.$input.val(""),a.$input.data("edit")&&a.unedit(!0)),!1}).on("typeahead:selected typeahead:autocompleted",function(d,c){a.createToken(c)&&(a.$input.typeahead("val",""),a.$input.data("edit")&&a.unedit(!0))}),f(e).on("resize",f.proxy(this.update,this))},keydown:function(a){function k(b){if(i.$input.is(document.activeElement)){if(i.$input.val().length>0){return}b+="All";var d=i.$input.hasClass("tt-input")?i.$input.parent()[b](".token:first"):i.$input[b](".token:first");if(!d.length){return}i.preventInputFocus=!0,i.preventDeactivation=!0,i.activate(d),a.preventDefault()}else{i[b](a.shiftKey),a.preventDefault()}}function j(n){if(a.shiftKey){if(i.$input.is(document.activeElement)){if(i.$input.val().length>0){return}var m=i.$input.hasClass("tt-input")?i.$input.parent()[n+"All"](".token:first"):i.$input[n+"All"](".token:first");if(!m.length){return}i.activate(m)}var l="prev"===n?"next":"prev",b="prev"===n?"first":"last";i.firstActiveToken[l+"All"](".token").each(function(){i.deactivate(f(this))}),i.activate(i.$wrapper.find(".token:"+b),!0,!0),a.preventDefault()}}if(this.focused){var i=this;switch(a.keyCode){case 8:if(!this.$input.is(document.activeElement)){break}this.lastInputValue=this.$input.val();break;case 37:k("rtl"===this.textDirection?"next":"prev");break;case 38:j("prev");break;case 39:k("rtl"===this.textDirection?"prev":"next");break;case 40:j("next");break;case 65:if(this.$input.val().length>0||!a.ctrlKey&&!a.metaKey){break}this.activateAll(),a.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus)").length){break}if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length){break}if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val().length){break}if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit")){return this.createTokensFromInput(a,this.$input.data("edit"))}if(13===a.keyCode){if(!this.$copyHelper.is(document.activeElement)||1!==this.$wrapper.find(".token.active").length){break}if(!i.options.allowEditing){break}this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=a.keyCode}},keypress:function(a){return this.lastKeyPressCode=a.keyCode,this.lastKeyPressCharCode=a.charCode,-1!==f.inArray(a.charCode,this._triggerKeys)&&this.$input.is(document.activeElement)?(this.$input.val()&&this.createTokensFromInput(a),!1):void 0},keyup:function(d){if(this.preventInputFocus=!1,this.focused){switch(d.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&8===this.lastKeyDown){break}this.preventDeactivation=!0;var c=this.$input.hasClass("tt-input")?this.$input.parent().prevAll(".token:first"):this.$input.prevAll(".token:first");if(!c.length){break}this.activate(c)}else{this.remove(d)}break;case 46:this.remove(d,"next")}this.lastKeyUp=d.keyCode}},focus:function(){this.focused=!0,this.$wrapper.addClass("focus"),this.$input.is(document.activeElement)&&(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null,this.options.showAutocompleteOnFocus&&this.search())},blur:function(b){this.focused=!1,this.$wrapper.removeClass("focus"),this.preventDeactivation||this.$element.is(document.activeElement)||(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null),!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)&&this.createTokensFromInput(b),this.preventDeactivation=!1,this.preventCreateTokens=!1},paste:function(d){var c=this;setTimeout(function(){c.createTokensFromInput(d)},1)},change:function(b){"tokenfield"!==b.initiator&&this.setTokens(this.$element.val())},createTokensFromInput:function(i,d){if(!(this.$input.val().length<this.options.minLength)){var j=this.getTokensList();return this.setTokens(this.$input.val(),!0),j==this.getTokensList()&&this.$input.val().length?!1:(this.$input.hasClass("tt-input")?this.$input.typeahead("val",""):this.$input.val(""),this.$input.data("edit")&&this.unedit(d),!1)}},next:function(j){if(j){var i=this.$wrapper.find(".active:first"),m=i&&this.$firstActiveToken?i.index()<this.$firstActiveToken.index():!1;if(m){return this.deactivate(i)}}var l=this.$wrapper.find(".active:last"),k=l.nextAll(".token:first");return k.length?(this.activate(k,j),void 0):(this.$input.focus(),void 0)},prev:function(j){if(j){var i=this.$wrapper.find(".active:last"),m=i&&this.$firstActiveToken?i.index()>this.$firstActiveToken.index():!1;if(m){return this.deactivate(i)}}var l=this.$wrapper.find(".active:first"),k=l.prevAll(".token:first");return k.length||(k=this.$wrapper.find(".token:first")),k.length||j?(this.activate(k,j),void 0):(this.$input.focus(),void 0)},activate:function(a,n,m,l){if(a){if("undefined"==typeof l){var l=!0}if(m){var n=!0}if(this.$copyHelper.focus(),n||(this.$wrapper.find(".active").removeClass("active"),l?this.$firstActiveToken=a:delete this.$firstActiveToken),m&&this.$firstActiveToken){var k=this.$firstActiveToken.index()-2,j=a.index()-2,i=this;this.$wrapper.find(".token").slice(Math.min(k,j)+1,Math.max(k,j)).each(function(){i.activate(f(this),!0)})}a.addClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select()}},activateAll:function(){var a=this;this.$wrapper.find(".token").each(function(b){a.activate(f(this),0!==b,!1,!1)})},deactivate:function(b){b&&(b.removeClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},toggle:function(b){b&&(b.toggleClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},edit:function(a){if(a){var m={value:a.data("value"),label:a.find(".token-label").text()},l={attrs:m,relatedTarget:a.get(0)},k=f.Event("tokenfield:edittoken",l);if(this.$element.trigger(k),!k.isDefaultPrevented()){a.find(".token-label").text(m.value);var j=a.outerWidth(),i=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;a.replaceWith(i),this.preventCreateTokens=!0,this.$input.val(m.value).select().data("edit",!0).width(j),this.update(),this.$element.trigger(f.Event("tokenfield:editedtoken",l))}}},unedit:function(i){var d=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;if(d.appendTo(this.$wrapper),this.$input.data("edit",!1),this.$mirror.text(""),this.update(),i){var j=this;setTimeout(function(){j.$input.focus()},1)}},remove:function(a,p){if(!(this.$input.is(document.activeElement)||this._disabled||this._readonly)){var o="click"===a.type?f(a.target).closest(".token"):this.$wrapper.find(".token.active");if("click"!==a.type){if(!p){var p="prev"}if(this[p](),"prev"===p){var n=0===o.first().prevAll(".token:first").length}}var m={attrs:this.getTokenData(o),relatedTarget:o.get(0)},l=f.Event("tokenfield:removetoken",m);if(this.$element.trigger(l),!l.isDefaultPrevented()){var k=f.Event("tokenfield:removedtoken",m),j=f.Event("change",{initiator:"tokenfield"});o.remove(),this.$element.val(this.getTokensList()).trigger(k).trigger(j),(!this.$wrapper.find(".token").length||"click"===a.type||n)&&this.$input.focus(),this.$input.css("width",this.options.minWidth+"px"),this.update(),a.preventDefault(),a.stopPropagation()}}},update:function(){var j=this.$input.val(),i=parseInt(this.$input.css("padding-left"),10),m=parseInt(this.$input.css("padding-right"),10),l=i+m;if(this.$input.data("edit")){if(j||(j=this.$input.prop("placeholder")),j===this.$mirror.text()){return}this.$mirror.text(j);var k=this.$mirror.width()+10;if(k>this.$wrapper.width()){return this.$input.width(this.$wrapper.width())}this.$input.width(k)}else{if(this.$input.css("width",this.options.minWidth+"px"),"rtl"===this.textDirection){return this.$input.width(this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-l-1)}this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-l)}},focusInput:function(a){if(!(f(a.target).closest(".token").length||f(a.target).closest(".token-input").length||f(a.target).closest(".tt-dropdown-menu").length)){var d=this;setTimeout(function(){d.$input.focus()},0)}},search:function(){this.$input.data("ui-autocomplete")&&this.$input.autocomplete("search")},disable:function(){this.setProperty("disabled",!0)},enable:function(){this.setProperty("disabled",!1)},readonly:function(){this.setProperty("readonly",!0)},writeable:function(){this.setProperty("readonly",!1)},setProperty:function(d,c){this["_"+d]=c,this.$input.prop(d,c),this.$element.prop(d,c),this.$wrapper[c?"addClass":"removeClass"](d)},destroy:function(){this.$element.val(this.getTokensList()),this.$element.css(this.$element.data("original-styles")),this.$element.prop("tabindex",this.$element.data("original-tabindex"));var a=f('label[for="'+this.$input.prop("id")+'"]');a.length&&a.prop("for",this.$element.prop("id")),this.$element.insertBefore(this.$wrapper),this.$element.removeData("original-styles").removeData("original-tabindex").removeData("bs.tokenfield"),this.$wrapper.remove();var d=this.$element;return delete this,d}};var g=f.fn.tokenfield;return f.fn.tokenfield=function(a,k){var j,i=[];Array.prototype.push.apply(i,arguments);var c=this.each(function(){var l=f(this),d=l.data("bs.tokenfield"),b="object"==typeof a&&a;"string"==typeof a&&d&&d[a]?(i.shift(),j=d[a].apply(d,i)):d||"string"==typeof a||k||l.data("bs.tokenfield",d=new h(this,b))});return"undefined"!=typeof j?j:c},f.fn.tokenfield.defaults={minWidth:60,minLength:0,allowEditing:!0,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1,delimiter:",",beautify:!0},f.fn.tokenfield.Constructor=h,f.fn.tokenfield.noConflict=function(){return f.fn.tokenfield=g,this},h});