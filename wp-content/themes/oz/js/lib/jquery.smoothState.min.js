!function(i){"use strict";"object"==typeof module&&"object"==typeof module.exports?i(require("jquery"),window,document):i(jQuery,window,document)}(function(i,t,e,a){"use strict";if(!t.history.pushState)return i.fn.smoothState=function(){return this},void(i.fn.smoothState.options={});if(!i.fn.smoothState){var o=i("html, body"),n=t.console,r={debug:!1,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:!1,repeatDelay:500,blacklist:".no-smoothState",prefetch:!1,prefetchOn:"mouseover touchstart",prefetchBlacklist:".no-prefetch",locationHeader:"X-SmoothState-Location",cacheLength:0,loadingClass:"is-loading",scroll:!0,alterRequest:function(i){return i},alterChangeState:function(i){return i},onBefore:function(){},onStart:{duration:0,render:function(){}},onProgress:{duration:0,render:function(){}},onReady:{duration:0,render:function(i,t){i.html(t)}},onAfter:function(){}},l={isExternal:function(i){var e=i.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof e[1]&&e[1].length>0&&e[1].toLowerCase()!==t.location.protocol?!0:"string"==typeof e[2]&&e[2].length>0&&e[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host?!0:!1},stripHash:function(i){return i.replace(/#.*/,"")},isHash:function(i,e){e=e||t.location.href;var a=i.indexOf("#")>-1?!0:!1,o=l.stripHash(i)===l.stripHash(e)?!0:!1;return a&&o},translate:function(t){var e={dataType:"html",type:"GET"};return t="string"==typeof t?i.extend({},e,{url:t}):i.extend({},e,t)},shouldLoadAnchor:function(i,t,e){var o=i.prop("href");return!(l.isExternal(o)||l.isHash(o)||i.is(t)||i.prop("target")||typeof e!==a&&""!==e&&-1===i.prop("href").search(e))},clearIfOverCapacity:function(i,t){return Object.keys||(Object.keys=function(i){var t,e=[];for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&e.push(t);return e}),Object.keys(i).length>t&&(i={}),i},storePageIn:function(t,e,a,o,n,r){var l=i("<html></html>").append(i(a));return"undefined"==typeof n&&(n={}),"undefined"==typeof r&&(r=e),t[e]={status:"loaded",title:l.find("title").first().text(),html:l.find("#"+o),doc:a,state:n,destUrl:r},t},triggerAllAnimationEndEvent:function(t,e){e=" "+e||"";var a=0,o="animationstart webkitAnimationStart oanimationstart MSAnimationStart",n="animationend webkitAnimationEnd oanimationend MSAnimationEnd",r="allanimationend",s=function(e){i(e.delegateTarget).is(t)&&(e.stopPropagation(),a++)},c=function(e){i(e.delegateTarget).is(t)&&(e.stopPropagation(),a--,0===a&&t.trigger(r))};t.on(o,s),t.on(n,c),t.on("allanimationend"+e,function(){a=0,l.redraw(t)})},redraw:function(i){i.height()}},s=function(e){if(null!==e.state){var a=t.location.href,o=i("#"+e.state.id),n=o.data("smoothState"),r=n.href!==a&&!l.isHash(a,n.href),s=e.state!==n.cache[n.href].state;(r||s)&&(s&&n.clear(n.href),n.load(a,!1))}},c=function(r,s){var c=i(r),d=c.prop("id"),w=null,u=!1,f={},h={},p=t.location.href,m=function(i){i=i||!1,i&&f.hasOwnProperty(i)?delete f[i]:f={},c.data("smoothState").cache=f},g=function(t,e){e=e||i.noop;var a=l.translate(t);if(f=l.clearIfOverCapacity(f,s.cacheLength),!f.hasOwnProperty(a.url)||"undefined"!=typeof a.data){f[a.url]={status:"fetching"};var o=i.ajax(a);o.done(function(i){l.storePageIn(f,a.url,i,d),c.data("smoothState").cache=f}),o.fail(function(){f[a.url].status="error"}),s.locationHeader&&o.always(function(i,t,e){var o=i.statusCode?i:e,n=o.getResponseHeader(s.locationHeader);n&&(f[a.url].destUrl=n)}),e&&o.always(e)}},v=function(){if(w){var t=i(w,c);if(t.length){var e=t.offset().top;o.scrollTop(e)}w=null}},_=function(a){var r="#"+d,l=f[a]?i(f[a].html.html()):null;l.length?(e.title=f[a].title,c.data("smoothState").href=a,s.loadingClass&&o.removeClass(s.loadingClass),s.onReady.render(c,l),c.one("ss.onReadyEnd",function(){u=!1,s.onAfter(c,l),s.scroll&&v(),W(c)}),t.setTimeout(function(){c.trigger("ss.onReadyEnd")},s.onReady.duration)):!l&&s.debug&&n?n.warn("No element with an id of "+r+" in response from "+a+" in "+f):t.location=a},b=function(i,e,a){var r=l.translate(i);"undefined"==typeof e&&(e=!0),"undefined"==typeof a&&(a=!0);var w=!1,u=!1,p={loaded:function(){var i=w?"ss.onProgressEnd":"ss.onStartEnd";if(u&&w?u&&_(r.url):c.one(i,function(){_(r.url),a||m(r.url)}),e){var o=f[r.url].destUrl;h=s.alterChangeState({id:d},f[r.url].title,o),f[r.url].state=h,t.history.pushState(h,f[r.url].title,o)}u&&!a&&m(r.url)},fetching:function(){w||(w=!0,c.one("ss.onStartEnd",function(){s.loadingClass&&o.addClass(s.loadingClass),s.onProgress.render(c),t.setTimeout(function(){c.trigger("ss.onProgressEnd"),u=!0},s.onProgress.duration)})),t.setTimeout(function(){f.hasOwnProperty(r.url)&&p[f[r.url].status]()},10)},error:function(){s.debug&&n?n.log("There was an error loading: "+r.url):t.location=r.url}};f.hasOwnProperty(r.url)||g(r),s.onStart.render(c),t.setTimeout(function(){s.scroll&&o.scrollTop(0),c.trigger("ss.onStartEnd")},s.onStart.duration),p[f[r.url].status]()},k=function(t){var e,a=i(t.currentTarget);l.shouldLoadAnchor(a,s.blacklist,s.hrefRegex)&&!u&&(t.stopPropagation(),e=l.translate(a.prop("href")),e=s.alterRequest(e),g(e))},C=function(t){var e=i(t.currentTarget);if(!t.metaKey&&!t.ctrlKey&&l.shouldLoadAnchor(e,s.blacklist,s.hrefRegex)&&(t.stopPropagation(),t.preventDefault(),!z())){T();var a=l.translate(e.prop("href"));u=!0,w=e.prop("hash"),a=s.alterRequest(a),s.onBefore(e,c),b(a)}},x=function(t){var e=i(t.currentTarget);if(!e.is(s.blacklist)&&(t.preventDefault(),t.stopPropagation(),!z())){T();var o={url:e.prop("action"),data:e.serialize(),type:e.prop("method")};u=!0,o=s.alterRequest(o),"get"===o.type.toLowerCase()&&(o.url=o.url+"?"+o.data),s.onBefore(e,c),b(o,a,s.allowFormCaching)}},y=0,z=function(){var i=null===s.repeatDelay,t=parseInt(Date.now())>y;return!(i||t)},T=function(){y=parseInt(Date.now())+parseInt(s.repeatDelay)},W=function(i){s.anchors&&s.prefetch&&i.find(s.anchors).not(s.prefetchBlacklist).on(s.prefetchOn,null,k)},H=function(i){s.anchors&&(i.on("click",s.anchors,C),W(i)),s.forms&&i.on("submit",s.forms,x)},A=function(){var i=c.prop("class");c.removeClass(i),l.redraw(c),c.addClass(i)};return s=i.extend({},i.fn.smoothState.options,s),null===t.history.state?(h=s.alterChangeState({id:d},e.title,p),t.history.replaceState(h,e.title,p)):h={},l.storePageIn(f,p,e.documentElement.outerHTML,d,h),l.triggerAllAnimationEndEvent(c,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),H(c),{href:p,cache:f,clear:m,load:b,fetch:g,restartCSSAnimations:A}},d=function(t){return this.each(function(){var e=this.tagName.toLowerCase();this.id&&"body"!==e&&"html"!==e&&!i.data(this,"smoothState")?i.data(this,"smoothState",new c(this,t)):!this.id&&n?n.warn("Every smoothState container needs an id but the following one does not have one:",this):"body"!==e&&"html"!==e||!n||n.warn("The smoothstate container cannot be the "+this.tagName+" tag")})};t.onpopstate=s,i.smoothStateUtility=l,i.fn.smoothState=d,i.fn.smoothState.options=r}});
