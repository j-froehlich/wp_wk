(function(y,B){var t={};var x=/[^a-z0-9.-]/;var A=false;var v=y(".as3cf-tab");var u;function r(a){return y("#"+a+" .as3cf-main-settings form").find("input:not(.no-compare)").serialize()}function p(b){var c=u.find("#"+b);var d=c.find("input[type=checkbox]");c.toggleClass("on").find("span").toggleClass("checked");var a=c.find("span.on").hasClass("checked");d.attr("checked",a).trigger("change")}function s(a){var d=a.next(".as3cf-validation-error");var b=y("#"+u.attr("id")+' form button[type="submit"]');var c=/[^a-zA-Z0-9\.\-]/;if(c.test(a.val())){d.show();b.attr("disabled",true)}else{d.hide();b.attr("disabled",false)}}as3cf.tabs={defaultTab:"media",toggle:function(a,b){a=as3cf.tabs.sanitizeHash(a);v.hide();u=y("#tab-"+a);u.show();y(".nav-tab").removeClass("nav-tab-active");y('a.nav-tab[data-tab="'+a+'"]').addClass("nav-tab-active");y(".aws-main").attr("data-tab",a);if(u.attr("data-prefix")){B.prefix=u.attr("data-prefix")}if(!b){y(".as3cf-updated").removeClass("show")}if("support"===a){as3cf.tabs.getDiagnosticInfo()}},getDiagnosticInfo:function(){var b=y(".debug-log-textarea");b.html(as3cf.strings.get_diagnostic_info);var a={action:"as3cf-get-diagnostic-info",_nonce:as3cf.nonces.get_diagnostic_info};y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:a,error:function(e,c,d){b.html(d)},success:function(d,c,e){if("undefined"!==typeof d.success){b.html(d.diagnostic_info)}else{b.html(as3cf.strings.get_diagnostic_info_error);b.append(d.error)}}})},sanitizeHash:function(a){var b=y("#tab-"+a);if(0===b.length){a=as3cf.tabs.defaultTab}return a}};as3cf.buckets={validLength:3,bucketSelectLock:false,loadList:function(e){if("undefined"===typeof e){e=false}var b=y(".as3cf-bucket-container."+B.prefix+" .as3cf-bucket-list");var a=y("#"+B.prefix+"-bucket").val();if(false===e&&b.find("li").length>1){y(".as3cf-bucket-list a").removeClass("selected");y('.as3cf-bucket-list a[data-bucket="'+a+'"]').addClass("selected");this.scrollToSelected();return}b.html('<li class="loading">'+b.attr("data-working")+"</li>");var c={action:B.prefix+"-get-buckets",_nonce:window[B.prefix.replace(/-/g,"_")].nonces.get_buckets};var d=this;y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:c,error:function(h,f,g){b.html("");d.showError(as3cf.strings.get_buckets_error,g,"as3cf-bucket-select")},success:function(g,f,h){b.html("");if("undefined"!==typeof g.success){y(".as3cf-bucket-error").hide();y(g.buckets).each(function(i,j){var k=j.Name===a?"selected":"";b.append('<li><a class="'+k+'" href="#" data-bucket="'+j.Name+'"><span class="bucket"><span class="dashicons dashicons-portfolio"></span> '+j.Name+'</span><span class="spinner"></span></span></a></li>')});d.scrollToSelected()}else{d.showError(as3cf.strings.get_buckets_error,g.error,"as3cf-bucket-select")}}})},scrollToSelected:function(){if(!y(".as3cf-bucket-list a.selected").length){return}var a=y("ul.as3cf-bucket-list li").first().position().top+150;y(".as3cf-bucket-list").animate({scrollTop:y("ul.as3cf-bucket-list li a.selected").position().top-a})},resetModal:function(){var b=y(".as3cf-bucket-container."+B.prefix);if(false===u.hasClass("as3cf-has-bucket")||"manual"===y("#"+B.prefix+"-bucket-select").val()){b.find(".as3cf-bucket-manual").show().siblings().hide();b.find(".bucket-actions.manual").show().siblings(".bucket-actions").hide()}else{b.find(".as3cf-bucket-select").show().siblings().hide();b.find(".bucket-actions.select").show().siblings(".bucket-actions").hide();this.loadList(A);A=false}b.find(".as3cf-bucket-error").hide();var a=y("#"+B.prefix+"-bucket").val();b.find(".as3cf-bucket-manual .as3cf-bucket-name").val(a);this.bucketSelectLock=false},saveManual:function(){var g=y(".as3cf-bucket-container."+B.prefix+" .as3cf-manual-save-bucket-form");var e=g.find(".as3cf-bucket-name");var f=g.find("button[type=submit]");var c=e.val();var d=f.first().text();if(c===y("#"+B.prefix+"-active-bucket").text()){y(".as3cf-bucket-error").hide();u.addClass("as3cf-has-bucket");B.close();return}y(".as3cf-bucket-error").hide();f.text(f.attr("data-working"));f.prop("disabled",true);var a={action:B.prefix+"-manual-save-bucket",bucket_name:c,_nonce:window[B.prefix.replace(/-/g,"_")].nonces.manual_bucket};var b=this;y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:a,error:function(i,j,h){f.text(d);b.showError(as3cf.strings.save_bucket_error,h,"as3cf-bucket-manual")},success:function(h,j,i){f.text(d);f.prop("disabled",false);if("undefined"!==typeof h.success){b.set(c,h.region,h.can_write);y("#"+B.prefix+"-bucket-select").val("manual");y(".as3cf-bucket-list a").removeClass("selected").filter('[data-bucket="'+c+'"]').addClass("selected");A=true}else{b.showError(as3cf.strings.save_bucket_error,h.error,"as3cf-bucket-manual")}}})},saveSelected:function(f){var a=y(".as3cf-bucket-list");if(this.bucketSelectLock){return}this.bucketSelectLock=true;if(f.hasClass("selected")){u.addClass("as3cf-has-bucket");B.close();return}var c=y(".as3cf-bucket-list a.selected").attr("data-bucket");y(".as3cf-bucket-list a").removeClass("selected");f.addClass("selected");a.addClass("saving");f.find(".spinner").show().css("visibility","visible");var e=f.attr("data-bucket");var b={action:B.prefix+"-save-bucket",bucket_name:e,_nonce:window[B.prefix.replace(/-/g,"_")].nonces.save_bucket};var d=this;y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:b,error:function(i,g,h){a.removeClass("saving");d.showError(as3cf.strings.save_bucket_error,h,"as3cf-bucket-select");y(".as3cf-bucket-list a").removeClass("selected");y('.as3cf-bucket-list a[data-bucket="'+c+'"]').addClass("selected")},success:function(h,g,i){f.find(".spinner").hide().css("visibility","hidden");a.removeClass("saving");if("undefined"!==typeof h.success){d.set(e,h.region,h.can_write);y("#"+B.prefix+"-bucket-select").val("")}else{d.showError(as3cf.strings.save_bucket_error,h.error,"as3cf-bucket-select");y(".as3cf-bucket-list a").removeClass("selected");y('.as3cf-bucket-list a[data-bucket="'+c+'"]').addClass("selected")}}})},disabledButtons:function(){if(0===y(".as3cf-bucket-container."+B.prefix+" .as3cf-create-bucket-form").length){return}var a=y(".as3cf-bucket-container."+B.prefix+" .as3cf-create-bucket-form");var b=y(".as3cf-bucket-container."+B.prefix+" .as3cf-manual-save-bucket-form");if(a.find(".as3cf-bucket-name").val().length<3){a.find("button[type=submit]").attr("disabled",true)}else{a.find("button[type=submit]").attr("disabled",false)}if(b.find(".as3cf-bucket-name").val().length<3){b.find("button[type=submit]").attr("disabled",true)}else{b.find("button[type=submit]").attr("disabled",false)}},showError:function(a,d,c){var e=y(".as3cf-bucket-container").children(":visible");var b=e.find(".as3cf-bucket-error");c=("undefined"===typeof c)?null:c;if(c&&!e.hasClass(c)){return}b.find("span.title").html(a+" &mdash;");b.find("span.message").html(d);b.show();this.bucketSelectLock=false},set:function(a,c,d){var e=y(".as3cf-bucket-container."+B.prefix+" .as3cf-manual-save-bucket-form");var f=y("#"+B.prefix+"-active-bucket");if("as3cf"===B.prefix&&0===f.text().trim().length){p("as3cf-copy-to-s3-wrap");p("as3cf-serve-from-s3-wrap");var b=u.attr("id");t[b]=r(b)}y(".as3cf-error.fatal").hide();f.text(a);e.find(".as3cf-bucket-name").val(a);y("#"+B.prefix+"-bucket").val(a);y("#"+B.prefix+"-region").val(c);y(".updated").not(".as3cf-notice").show();u.addClass("as3cf-has-bucket");u.find(".as3cf-can-write-error").toggle(!d);u.find(".as3cf-bucket-error").hide();if("as3cf"===B.prefix){w()}q();B.close(C)},create:function(){var h=y(".as3cf-bucket-container."+B.prefix+" .as3cf-create-bucket-form");var f=h.find(".as3cf-bucket-name");var a=h.find(".bucket-create-region");var g=h.find("button[type=submit]");var e=f.val();var c=g.text();y(".as3cf-bucket-error").hide();g.text(g.attr("data-working"));g.prop("disabled",true);var b={action:B.prefix+"-create-bucket",bucket_name:e,_nonce:window[B.prefix.replace(/-/g,"_")].nonces.create_bucket};if(a.val()){b.region=a.val()}var d=this;y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:b,error:function(i,j,k){g.text(c);d.showError(as3cf.strings.create_bucket_error,k,"as3cf-bucket-create")},success:function(k,j,i){g.text(c);g.prop("disabled",false);if("undefined"!==typeof k.success){d.set(e,k.region,k.can_write);y(".as3cf-bucket-select-region").hide();y(".as3cf-bucket-select-region").removeAttr("selected");f.val("");g.attr("disabled",true);A=true}else{d.showError(as3cf.strings.create_bucket_error,k.error,"as3cf-bucket-create")}}})},isValidName:function(a){if(a.length<3||a.length>63){return false}if(true===x.test(a)){return false}return true},updateNameNotice:function(b){var a=null;if(true===x.test(b)){a=as3cf.strings.create_bucket_invalid_chars}else{if(b.length<3){a=as3cf.strings.create_bucket_name_short}else{if(b.length>63){a=as3cf.strings.create_bucket_name_long}}}if(a&&b.length>0){y(".as3cf-invalid-bucket-name").html(a)}else{y(".as3cf-invalid-bucket-name").html("")}}};function q(){var a=y("#"+B.prefix+"-bucket").val();var b=u.find('input[name="object-prefix"]');var c=b.val();if(""!==c){c="&prefix="+encodeURIComponent(c)}var d=as3cf.aws_bucket_link+a+c;y("#"+B.prefix+"-view-bucket").attr("href",d)}function w(){y(".as3cf-url-preview").html("Generating...");var a={_nonce:as3cf.nonces.get_url_preview};y.each(y("#tab-"+as3cf.tabs.defaultTab+" .as3cf-main-settings form").serializeArray(),function(d,c){var b=c.name,e=c.value;b=b.replace("[]","");a[b]=undefined===a[b]?e:y.isArray(a[b])?a[b].concat(e):[a[b],e]});a.action="as3cf-get-url-preview";y.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:a,error:function(d,b,c){alert(as3cf.strings.get_url_preview_error+c)},success:function(c,b,d){if("undefined"!==typeof c.success){y(".as3cf-url-preview").html(c.url)}else{alert(as3cf.strings.get_url_preview_error+c.error)}}})}function C(a){as3cf.buckets.bucketSelectLock=false}function z(){if(y("#as3cf-remove-local-file").is(":checked")&&y("#as3cf-serve-from-s3").is(":not(:checked)")){y("#as3cf-lost-files-notice").show()}else{y("#as3cf-lost-files-notice").hide()}}function D(){if(y("#as3cf-remove-local-file").is(":checked")){y("#as3cf-remove-local-notice").show()}else{y("#as3cf-remove-local-notice").hide()}}y(document).ready(function(){var a=y(".wrap.aws-main .nav-tab-wrapper");y(".aws-compatibility-notice, div.updated, div.error, div.notice").not(".below-h2, .inline").insertAfter(a);if(window.location.hash){var b=window.location.hash.substring(1);as3cf.tabs.toggle(b,true)}else{u=y("#tab-"+as3cf.tabs.defaultTab);y(".aws-main").attr("data-tab",as3cf.tabs.defaultTab)}y(".aws-main").on("click",".nav-tab",function(c){c.preventDefault();if(y(this).hasClass("nav-tab-active")){return}var d=y(this).attr("data-tab");as3cf.tabs.toggle(d);if("media"===d){window.location.hash="";if("function"===typeof window.history.replaceState&&"#"===window.location.href.slice(-1)){history.replaceState({},"",window.location.href.slice(0,-1))}}else{window.location.hash=d}});if(v.length){v.each(function(d,c){t[c.id]=r(c.id)})}y(window).on("beforeunload.as3cf-settings",function(){if(y.isEmptyObject(t)){return}var c=u.attr("id");if(r(c)!==t[c]){return as3cf.strings.save_alert}});y(document).on("submit",".as3cf-main-settings form",function(c){y(window).off("beforeunload.as3cf-settings")});y(".as3cf-switch").on("click",function(c){if(!y(this).hasClass("disabled")){p(y(this).attr("id"))}});v.on("change",".sub-toggle",function(c){var d=y(this).attr("id");y(".as3cf-setting."+d).toggleClass("hide")});y(".as3cf-domain").on("change",'input[type="radio"]',function(c){var g=y(this).closest('input:radio[name="domain"]:checked');var d=g.val();var e=y(this).parents(".as3cf-domain").find(".as3cf-setting.cloudfront");var f=("cloudfront"===d);e.toggleClass("hide",!f)});y(".url-preview").on("change","input",function(c){w()});z();y("#as3cf-serve-from-s3,#as3cf-remove-local-file").on("change",function(c){z()});D();y("#as3cf-remove-local-file").on("change",function(c){D()});y('.as3cf-setting input[type="text"]').keypress(function(c){if(13===c.which){c.preventDefault();return false}});y('input[name="cloudfront"]').on("keyup",function(c){s(y(this))});y('input[name="domain"]').on("change",function(e){var c=y(this);var d=y("#"+u.attr("id")+' form button[type="submit"]');if("cloudfront"!==c.val()){d.attr("disabled",false)}else{s(c.next(".as3cf-setting").find('input[name="cloudfront"]'))}});y('input[name="object-prefix"]').on("change",function(c){q()});y("#tab-media > .as3cf-bucket-error").detach().insertAfter(".as3cf-bucket-container h3");y("body").on("click",".bucket-action-manual",function(c){c.preventDefault();y(".as3cf-bucket-container."+B.prefix+" .as3cf-bucket-manual").show().siblings().hide()});y("body").on("click",".bucket-action-browse",function(c){c.preventDefault();y(".as3cf-bucket-container."+B.prefix+" .as3cf-bucket-select").show().siblings().hide();as3cf.buckets.loadList(A);A=false});y("body").on("click",".bucket-action-create",function(c){c.preventDefault();y(".as3cf-bucket-name").val("");y(".as3cf-invalid-bucket-name").html("");y(".as3cf-bucket-container."+B.prefix+" .as3cf-bucket-create").show().siblings().hide()});y("body").on("click",".bucket-action-cancel",function(c){c.preventDefault();as3cf.buckets.resetModal()});y("body").on("click",".bucket-action-save",function(c){c.preventDefault();as3cf.buckets.saveManual()});y("body").on("click",'.as3cf-create-bucket-form button[type="submit"]',function(c){c.preventDefault();as3cf.buckets.create()});y("body").on("click",".bucket-action-refresh",function(c){c.preventDefault();as3cf.buckets.loadList(true)});y("body").on("click",".as3cf-bucket-list a",function(c){c.preventDefault();as3cf.buckets.saveSelected(y(this))});y(".as3cf-bucket-container").on("click","a.js-link",function(c){c.preventDefault();window.open(y(this).attr("href"));return false});y("body").on("as3cf-modal-open",function(d,e){if(".as3cf-bucket-container."+B.prefix===e){as3cf.buckets.resetModal();var c=y(".as3cf-bucket-manual h3").data("modal-title");y(".as3cf-bucket-manual h3").text(c);as3cf.buckets.disabledButtons()}});as3cf.buckets.disabledButtons();y("body").on("input keyup",".as3cf-create-bucket-form .as3cf-bucket-name",function(c){var d=y(this).val();var e=y(".as3cf-bucket-container."+B.prefix+" .as3cf-create-bucket-form");if(as3cf.buckets.isValidName(d)){e.find("button[type=submit]").removeAttr("disabled")}else{e.find("button[type=submit]").attr("disabled",true)}as3cf.buckets.updateNameNotice(d)});y("body").on("input keyup",".as3cf-manual-save-bucket-form .as3cf-bucket-name",function(c){var d=y(".as3cf-bucket-container."+B.prefix+" .as3cf-manual-save-bucket-form");if(d.find(".as3cf-bucket-name").val().length<as3cf.buckets.validLength){d.find("button[type=submit]").attr("disabled",true)}else{d.find("button[type=submit]").removeAttr("disabled")}})})})(jQuery,as3cfModal);