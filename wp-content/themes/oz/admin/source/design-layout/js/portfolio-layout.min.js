!function(a){"use strict";a.fn.WilokeReCalWidth=function(){var b=a(this);b.on("reCalWidth",function(){a(this).css("width","");var b=a(this).width();a(this).css("width",b+"px")}).trigger("reCalWidth"),a(window).on("resize",function(){b.trigger("reCalWidth")})};var f,b={Views:{},Collection:{},Models:{},listOfModels:{}},e=["cube","wide","high","large","extra-large"],g={},i={},j={};b.Views.renderSettings=Backbone.View.extend({el:".vc_ui-panel-window-inner",events:{"change .wo_portfolio_layout":"renderSettings","click .js_device_setting":"renderSettings","click .grid-item":"resizeLayout",'click .vc_ui-button-action.vc_general[data-vc-ui-element="button-save"]':"saveValue","click .vc_ui-panel-footer-container .vc_ui-button":"offClick","click .vc_ui-panel-header-controls .vc_ui-close-button":"offClick","click .wiloke-add-items":"addItem","click .wiloke-remove-items":"removeItems","change .wo_number_of_items":"listenChangeNumberOfPosts","change .items_per_row":"listenChangeItemsPerRow","click .js_param.btn_clone":"cloneLatestDeviceSettings","click .wiloke-target":"cloning","change .wo_portfolio_layout_settings":"updateSettings","click .wiloke-clone":"showCloneTarget","click .vc_ui-tabs-line-trigger":"backupValue"},offClick:function(){this.undelegateEvents()},updateSettings:function(b){b.preventDefault();var c=this.$el.find(".wo_portfolio_layout.active").parent().index(),d=a(b.currentTarget).val(),e=this.collection.at(c-1),f=e.get("value");try{"creative"==a(document).data("wiloke-portfolio-prev-activated")&&void 0!==f&&a(document).data("wiloke-portfolio-allow-backup")&&(f="object"==typeof f?JSON.stringify(f):f,a("#wiloke-print-wiloke-design-layout").find(".wo_portfolio_layout_settings.creative").attr("value",base64_encode(f))),a(b.currentTarget).attr({"data-settings":d}),e.set("value",a.parseJSON(d)),"no"==a(document).data("wiloke-portfolio-is-customize")?a(b.currentTarget).closest(".wiloke-portfolio-layout-wrapper").find(".js_wiloke_pa_elumate_zone").addClass("disable"):a(b.currentTarget).closest(".wiloke-portfolio-layout-wrapper").find(".js_wiloke_pa_elumate_zone").removeClass("disable"),a(b.currentTarget).prev().trigger("change")}catch(a){console.log("Line 128 "+a)}},cloning:function(b){b.preventDefault(),this.$el.find(".settings-packery-layout").addClass("progressing");var c=a(b.currentTarget).data("target"),d=this.$el.find(".wo_portfolio_layout.active").parent().index(),e=this.$el.find(".js_device_setting.active").data("device"),f=this.collection.at(d-1),g=f.get("value");g=a.parseJSON(g),g[c]=g[e],g=JSON.stringify(g),this.$el.find(".wo_portfolio_layout.active").next().attr("value",g),this.$el.find(".wo_portfolio_layout.active").next().attr("data-settings",g),f.set("value",g),this.$el.find(".settings-packery-layout").removeClass("progressing"),a(b.currentTarget).css({color:"green"})},showCloneTarget:function(b){b.preventDefault(),a(b.currentTarget).next().toggleClass("hidden")},cloneLatestDeviceSettings:function(){event.preventDefault(),this.$el.find(".wo_portfolio_layout.active").attr("value",j),a(".js_device_setting.active").trigger("click")},listenChangeItemsPerRow:function(b){var c=a(b.currentTarget).val(),d=this.$el.find(".wil_masonry");d.attr({"data-col-lg":c,"data-col":c}),d.packery("layout")},listenChangeNumberOfPosts:function(b){var c=this.$el.find(".wil_masonry"),d=c.find(".grid-item").length,e=this.$el.find(".wil_masonry"),f=a(b.currentTarget).val(),g=d-Number(f);if(g=Math.abs(g),0==f||""==f)alert("You need at least an item");else{if(d<Number(f)){for(var h="",i=1;i<=g;i++)h+=a("#wilokepa-emulate-addnew").html();h=a(h),e.append(h).packery("appended",h),e.find(".draggable").draggable(),e.find(".grid-item").removeClass("draggable"),e.packery("bindUIDraggableEvents",h)}else for(f-1;f<d;f++)c.packery("remove",c.find(".grid-item").eq(f)).packery("shiftLayout");this.resetLayout()}},addItem:function(b){var c=a(b.currentTarget);if(!c.data("clicked")){void 0===g[a(b.currentTarget)]&&(g[a(b.currentTarget)]=1),c.data("clicked",!0);var d=c.prev(),e=this.$el.find(".wil_masonry"),f=c.closest(".wo_wpb_setting_layout").find(".grid-item").length,h=a("#wilokepa-emulate-addnew").html();h=a(h),e.append(h).packery("appended",h),e.find(".draggable").draggable(),e.find(".grid-item").removeClass("draggable"),e.packery("bindUIDraggableEvents",h),d.val(Number(f)+1),this.resetLayout(c)}},removeItems:function(b){var c=a(b.currentTarget);if(!c.data("clicked")){void 0===g[a(b.currentTarget)]&&(g[a(b.currentTarget)]=1);var d=c.next(),e=c.closest(".wo_wpb_setting_layout").find(".grid-item").length,f=this.$el.find(".grid-item:last");c.data("clicked",!0),e>1?(d.val(Number(e)-1),this.$el.find(".wil_masonry").packery("remove",f).packery("shiftLayout"),this.resetLayout(c)):alert("You need at least an item")}},initialize:function(){this.renderSettings()},renderSettings:function(c){this.setActivate(c);var d=this.$el.find(".wo_portfolio_layout.active").parent().index(),e=this.$el.find(".js_device_setting.active").data("device"),f=this.collection.at(d-1),g={},h=b.listOfModels.portfolioDeviceSettings.get("value"),i=f.get("settings"),j=a('#wiloke-js-init-wpa input[name="wiloke_portfolio_layout[creative][settings]"]').attr("value");j=a.parseJSON(j);var k=b.Models.portfolioGeneral.get("value");this.$el.find(".wo_wpd_settings_zone .wo_wpb_left").html(""),void 0!==j.items_size&&(j.items_size=this.parseSize(j.items_size)),a(".wiloke-clone-wrapper").length||(this.$el.find(".wo_wpd_settings_zone .wo_wpb_left").append(this.renderCloneBtn()),this.$el.find(".wo_wpd_settings_zone .wo_wpb_left").find('[data-target="'+e+'"]').addClass("current")),_.each(i,function(a){a.value=void 0!==h[e][a.param_name]?h[e][a.param_name]:"";var c=new b.Models.portfolioSettings(a),d=new b.Views.renderItemSettings({model:c});this.$el.find(".wo_wpd_settings_zone .wo_wpb_left").append(d.render().el)},this),g.layout=this.$el.find(".wo_portfolio_layout.active").attr("value"),g.device=e,g.items_size=j.items_size,g.general_settings=k,g.devices_settings=h,g.current_col=h[e].items_per_row;var l=new b.Models.portfolioEmulate(g),m=new b.Views.renderEmulate({model:l});this.$el.find(".js_wiloke_pa_elumate_zone").html(m.render().el),void 0!==c&&a(".wo_wpd_settings_zone .btn_clone").prop("disabled",!1),this.packery()},setActivate:function(b){if(void 0!==b&&a(b.currentTarget).hasClass("js_device_setting")){this.saveValue();var c=a(b.currentTarget).parent();c.children().removeClass("previous-active"),c.find(".active").addClass("previous-active"),c.children().removeClass("active"),a(b.currentTarget).addClass("active")}},renderCloneBtn:function(){return a("#wilokepa-clonebtn").html()},resizeLayout:function(b){var c=this.$el.find(".wil_masonry");if("yes"!=c.data("isdragdrop"))return!1;if(a(b.currentTarget).hasClass("on-click"))return!1;var d=a(b.currentTarget).attr("data-size"),f=e.indexOf(d);f==e.length-1?f=0:f+=1,a(b.currentTarget).removeClass(d),a(b.currentTarget).addClass(e[f]),a(b.currentTarget).attr("data-size",e[f]),a(b.currentTarget).css({width:"",height:""}),c.data("isotope-initialized")?c.packery("layout"):this.packery(),this.resetLayout()},resetLayout:function(b){var c=this.$el.find(".wo_wpb_setting_layout .wil_masonry"),d="";if(!c.data("is-working")){if(c.data("is-working",!0),!c.data("isotope-initialized"))return void c.data("is-working",!1);var e=c.packery("getItemElements");c.data("is-working",!1),a(e).each(function(b,c){d+=a(c).attr("data-size")+","}),d=d.replace(/,$/,""),this.$el.find('.wo_wpb_left [name="items_size"]').val(d),void 0!==b&&b.data("clicked",!1)}},packery:function(){var b=this,c=this.$el.find(".wo_wpb_setting_layout .wil_masonry"),d=void 0!==a(document).data("wiloke-portfolio-current-activated")?a(document).data("wiloke-portfolio-current-activated"):c.closest(".wpb_edit_form_elements").find("#wiloke-print-wiloke-design-layout .item.wo_wpb_checked .wo_portfolio_layout_value").val();c.attr("data-layout",d),c.length>0&&setTimeout(function(){c.data("isotope-initialized")&&(c.packery("destroy"),c.data("isotope-initialized",!1));var d=c.packery({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0});if("yes"==d.data("isdragdrop")){var e=d.find(".grid-item").draggable({stop:function(c,d){a(c.target).removeClass("non-click");b.resetLayout()},start:function(b,c){a(b.target).addClass("non-click")},drag:function(a,b){}});d.packery("bindUIDraggableEvents",e),d.on("layoutComplete",function(){var b=d.packery("getItemElements");d.addClass("has-order"),a(b).each(function(b,c){a(c).attr("data-order",b+1)})}),d.on("dragItemPositioned",function(){var b=d.packery("getItemElements");d.addClass("has-order"),a(b).each(function(b,c){a(c).attr("data-order",b+1)})}),b.$draggableControl=e}i=d,c.data("isotope-initialized",!0)},200)},parseSize:function(a){if("object"==typeof a)return a;var b=[];if(null!==a.match(/\*/g)){a=a.split(",");for(var c in a)if(null!==a[c].match(/\*/g))for(var d=a[c].split("*"),e=Number(d[1]),f=d[0],g=0;g<e;g++)b.push(f);else b.push(a[c]);a=b.join(",")}return a.split(",")},saveValue:function(c,d){var e=this.$el.find(".wo_portfolio_layout.active").attr("value"),g=this.$el.find(".js_device_setting.active").data("device"),h=this.$el.find("#wiloke-js-init-wpa").find(".wo_portfolio_layout_settings").attr("value");if(h){try{h=a.parseJSON(h);var j=this.$el.find(".wo_wpd_settings_zone");j.wrap("<form></form>");var k=j.parent().serializeArray();j.unwrap("<form></form>");var l={},m="";_.each(k,function(a){l[a.name]=a.value});var n=b.listOfModels.portfolioDeviceSettings.get("value");if(n[g]=l,i.hasClass("has-order"))for(var o=i.find(".grid-item").length,p=1;p<=o;p++){var q=i.find('.grid-item[data-order="'+p+'"]').attr("data-size");m+=void 0!==q?q+",":"cube,"}else i.find(".grid-item").each(function(){var b=a(this).attr("data-size");m+=void 0!==b?b+",":"cube,"});m=m.substring(0,m.lastIndexOf(",")),h.items_size=m,h.layout=e,this.generateGeneralSettings(),a("#wpa_devices_settings").attr("value",JSON.stringify(n)),b.listOfModels[e].set("value",h),b.listOfModels.portfolioDeviceSettings.set("value",n),h=JSON.stringify(h),this.$el.find(".wo_portfolio_layout.active").siblings(".wo_portfolio_layout_settings").attr("value",h),f=h}catch(a){console.log(a)}return void 0!==c&&this.$el.find(".number_of_posts").trigger("change"),h}},backupValue:function(b){"Design Layout"!=a(b.currentTarget).text()&&a(document).data("wiloke-portfolio-allow-backup")&&this.generateGeneralSettings()},generateGeneralSettings:function(){var c={};return this.$el.find(".wo_general_settings").each(function(){var b=a(this).attr("name");void 0!==b&&(c[b]=a(this).attr("value"))}),a("#wpa_general_settings").attr("value",JSON.stringify(c)),b.Models.portfolioGeneral.set("value",c),c}}),b.Models.portfolioSettings=Backbone.Model.extend({}),b.Models.portfolioEmulate=Backbone.Model.extend({}),b.Views.renderItemSettings=Backbone.View.extend({tagName:"div",className:"form-control",render:function(){var b=a("#wilokepa-"+this.model.get("type")),c=_.template(b.html());return this.$el.html(c(this.model.toJSON())),this}}),b.Views.renderEmulate=Backbone.View.extend({tagName:"div",className:"",render:function(){var b=a("#wilokepa-emulate-with-packery"),c=_.template('<div class="wo_wpb_setting_layout">'+b.html()+"</div>");return this.$el.html(c(this.model.toJSON())),this}}),b.Collection.portfolioSettings=Backbone.Collection.extend({model:b.Models.portfolioSettings,initialize:function(){this.on("change",function(a){console.log("something got changed")})}}),b.Models.portfolioGeneralSettings=Backbone.Model.extend({}),b.Models.portfolioItemSettings=Backbone.Model.extend({}),b.Models.portfolioDeviceSettings=Backbone.Model.extend({}),a().WilokePA||(a.fn.WilokePA=function(){var c=a(this),e={},f=new b.Collection.portfolioSettings;b.Models.portfolioGeneral=new b.Models.portfolioGeneralSettings,b.listOfModels.portfolioDeviceSettings=new b.Models.portfolioDeviceSettings,c.find(".wo_portfolio_layout").each(function(){var c=a(this),g=(c.val(),c.data("settings"));e=c.siblings(".wo_portfolio_layout_settings").val(),e=a.parseJSON(e);var h=new b.Models.portfolioSettings;h.set("settings",g),h.set("value",e),f.add(h),b.listOfModels[c.val()]=h}),b.Models.portfolioGeneral.set("value",a.parseJSON(a("#wpa_general_settings").val())),b.listOfModels.portfolioDeviceSettings.set("value",a.parseJSON(a("#wpa_devices_settings").val())),new b.Views.renderSettings({collection:f})}),a(document).ready(function(){"undefined"!=typeof vc&&(vc.atts.wiloke_design_portfolio_layout={parse:function(b){var c=this.$content.find("#wiloke-js-init-wpa"),d={};d.layout=c.find(".wo_portfolio_layout.active").attr("value"),c.find(".wo_portfolio_layout").each(function(){d.layout=a(this).attr("value"),d[d.layout]=a.parseJSON(a(this).siblings(".wo_portfolio_layout_settings").attr("value"))}),d.devices_settings=a.parseJSON(a("#wpa_devices_settings").attr("value")),d.general_settings=a.parseJSON(a("#wpa_general_settings").attr("value"));var e=this.$content.find("#wiloke-print-wiloke-design-layout .item.wo_wpb_checked .wo_portfolio_layout_value");return d=JSON.stringify(d),d=base64_encode(d),e.length&&("creative"==e.val()&&e.prev().attr("value",d),"no"==e.closest(".item").data("is-customize")&&this.$content.find(".wiloke-portfolio-layout-emulate").addClass("disable")),d},render:function(){}},vc.atts.wiloke_design_portfolio_choose_layout={parse:function(a){var b={},c=this.$content.find("#wiloke-print-wiloke-design-layout .item.wo_wpb_checked .wo_portfolio_layout_value"),d=c.val();return b.layout=d,b=JSON.stringify(b),b=base64_encode(b)},render:function(){}})})}(jQuery);