"use strict";(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(g){function a(m,q,d){var f=m.getLineHandle(q.line),p=q.ch-1,n=d&&d.afterCursor;null==n&&(n=/(^| )cm-fat-cursor($| )/.test(m.getWrapperElement().className));f=!n&&0<=p&&b[f.text.charAt(p)]||b[f.text.charAt(++p)];if(!f){return null}n=">"==f.charAt(1)?1:-1;if(d&&d.strict&&0<n!=(p==q.ch)){return null}var o=m.getTokenTypeAt(c(q.line,p+1));m=k(m,c(q.line,p+(0<n?1:0)),n,o||null,d);return null==m?null:{from:c(q.line,p),to:m&&m.pos,match:m&&m.ch==f.charAt(0),forward:0<n}}function k(B,z,A,s,x){var t=x&&x.maxScanLineLength||10000,u=x&&x.maxScanLines||1000,v=[];x=x&&x.bracketRegex?x.bracketRegex:/[(){}[\]]/;for(var u=0<A?Math.min(z.line+u,B.lastLine()+1):Math.max(B.firstLine()-1,z.line-u),y=z.line;y!=u;y+=A){var o=B.getLine(y);if(o){var w=0<A?0:o.length-1,n=0<A?o.length:-1;if(!(o.length>t)){for(y==z.line&&(w=z.ch-(0>A?1:0));w!=n;w+=A){var m=o.charAt(w);if(x.test(m)&&(void 0===s||B.getTokenTypeAt(c(y,w+1))==s)){if(">"==b[m].charAt(1)==0<A){v.push(m)}else{if(v.length){v.pop()}else{return{pos:c(y,w),ch:m}}}}}}}}return y-A==(0<A?B.lastLine():B.firstLine())?!1:null}function j(u,s,t){for(var r=u.state.matchBrackets.maxHighlightLineLength||1000,q=[],p=u.listSelections(),m=0;m<p.length;m++){var o=p[m].empty()&&a(u,p[m].head,t);if(o&&u.getLine(o.from.line).length<=r){var l=o.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";q.push(u.markText(o.from,c(o.from.line,o.from.ch+1),{className:l}));o.to&&u.getLine(o.to.line).length<=r&&q.push(u.markText(o.to,c(o.to.line,o.to.ch+1),{className:l}))}}if(q.length){if(h&&u.state.focused&&u.focus(),t=function(){u.operation(function(){for(var d=0;d<q.length;d++){q[d].clear()}})},s){setTimeout(t,800)}else{return t}}}function i(d){d.operation(function(){e&&(e(),e=null);e=j(d,!1,d.state.matchBrackets)})}var h=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),c=g.Pos,b={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},e=null;g.defineOption("matchBrackets",!1,function(f,l,d){d&&d!=g.Init&&(f.off("cursorActivity",i),e&&(e(),e=null));l&&(f.state.matchBrackets="object"==typeof l?l:{},f.on("cursorActivity",i))});g.defineExtension("matchBrackets",function(){j(this,!0)});g.defineExtension("findMatchingBracket",function(f,l,d){if(d||"boolean"==typeof l){d?(d.strict=l,l=d):l=l?{strict:!0}:null}return a(this,f,l)});g.defineExtension("scanForBracket",function(l,n,f,m){return k(this,l,n,f,m)})});