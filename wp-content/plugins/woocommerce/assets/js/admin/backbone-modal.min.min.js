(function(d,f,e){d.fn.WCBackboneModal=function(a){return this.each(function(){(new d.WCBackboneModal(d(this),a))})};d.WCBackboneModal=function(b,c){var a=d.extend({},d.WCBackboneModal.defaultOptions,c);if(a.template){new d.WCBackboneModal.View({target:a.template,string:a.variable})}};d.WCBackboneModal.defaultOptions={template:"",variable:{}};d.WCBackboneModal.View=f.View.extend({tagName:"div",id:"wc-backbone-modal-dialog",_target:undefined,_string:undefined,events:{"click .modal-close":"closeButton","click #btn-ok":"addButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var a=d(".wc-backbone-modal-content").find("article");var b=d(window).height()*0.75;a.css({"max-height":b+"px"})},initialize:function(a){var b=this;this._target=a.target;this._string=a.string;e.bindAll(this,"render");this.render();d(window).resize(function(){b.resizeContent()})},render:function(){var a=wp.template(this._target);this.$el.append(a(this._string));d(document.body).css({overflow:"hidden"}).append(this.$el);this.resizeContent();this.$(".wc-backbone-modal-content").attr("tabindex","0").focus();d(document.body).trigger("init_tooltips");d(document.body).trigger("wc_backbone_modal_loaded",this._target)},closeButton:function(a){a.preventDefault();d(document.body).trigger("wc_backbone_modal_before_remove",this._target);this.undelegateEvents();d(document).off("focusin");d(document.body).css({overflow:"auto"});this.remove();d(document.body).trigger("wc_backbone_modal_removed",this._target)},addButton:function(a){d(document.body).trigger("wc_backbone_modal_response",[this._target,this.getFormData()]);this.closeButton(a)},getFormData:function(){var a={};d(document.body).trigger("wc_backbone_modal_before_update",this._target);d.each(d("form",this.$el).serializeArray(),function(c,b){if(b.name.indexOf("[]")!==-1){b.name=b.name.replace("[]","");a[b.name]=d.makeArray(a[b.name]);a[b.name].push(b.value)}else{a[b.name]=b.value}});return a},keyboardActions:function(a){var b=a.keyCode||a.which;if(13===b&&!(a.target.tagName&&(a.target.tagName.toLowerCase()==="input"||a.target.tagName.toLowerCase()==="textarea"))){this.addButton(a)}if(27===b){this.closeButton(a)}}})}(jQuery,Backbone,_));