jQuery(function(h){var j={states:null,init:function(){if(!(typeof woocommerce_admin_meta_boxes_order==="undefined"||typeof woocommerce_admin_meta_boxes_order.countries==="undefined")){this.states=h.parseJSON(woocommerce_admin_meta_boxes_order.countries.replace(/&quot;/g,'"'))}h(".js_field-country").selectWoo().change(this.change_country);h(".js_field-country").trigger("change",[true]);h(document.body).on("change","select.js_field-state",this.change_state);h("#woocommerce-order-actions input, #woocommerce-order-actions a").click(function(){window.onbeforeunload=""});h("a.edit_address").click(this.edit_address);h("a.billing-same-as-shipping").on("click",this.copy_billing_to_shipping);h("a.load_customer_billing").on("click",this.load_billing);h("a.load_customer_shipping").on("click",this.load_shipping);h("#customer_user").on("change",this.change_customer_user)},change_country:function(r,c){if(typeof c==="undefined"){c=false}if(j.states===null){return}var d=h(this),v=d.val(),x=d.parents("div.edit_address").find(":input.js_field-state"),t=x.parent(),s=x.attr("name"),e=x.attr("id"),a=d.data("woocommerce.stickState-"+v)?d.data("woocommerce.stickState-"+v):x.val(),b=x.attr("placeholder");if(c){d.data("woocommerce.stickState-"+v,a)}t.show().find(".select2-container").remove();if(!h.isEmptyObject(j.states[v])){var u=h('<select name="'+s+'" id="'+e+'" class="js_field-state select short" placeholder="'+b+'"></select>'),w=j.states[v];u.append(h('<option value="">'+woocommerce_admin_meta_boxes_order.i18n_select_state_text+"</option>"));h.each(w,function(k){u.append(h('<option value="'+k+'">'+w[k]+"</option>"))});u.val(a);x.replaceWith(u);u.show().selectWoo().hide().change()}else{x.replaceWith('<input type="text" class="js_field-state" name="'+s+'" id="'+e+'" value="'+a+'" placeholder="'+b+'" />')}h(document.body).trigger("contry-change.woocommerce",[v,h(this).closest("div")]);h(document.body).trigger("country-change.woocommerce",[v,h(this).closest("div")])},change_state:function(){var b=h(this),c=b.val(),d=b.parents("div.edit_address").find(":input.js_field-country"),a=d.val();d.data("woocommerce.stickState-"+a,c)},init_tiptip:function(){h("#tiptip_holder").removeAttr("style");h("#tiptip_arrow").removeAttr("style");h(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},edit_address:function(b){b.preventDefault();var c=h(this),e=c.closest(".order_data_column"),m=e.find("div.edit_address"),a=e.find("div.address"),d=m.find(".js_field-country"),n=m.find(".js_field-state");a.hide();c.parent().find("a").toggle();if(!d.val()){d.val(woocommerce_admin_meta_boxes_order.default_country).change()}if(!n.val()){n.val(woocommerce_admin_meta_boxes_order.default_state).change()}m.show()},change_customer_user:function(){if(!h("#_billing_country").val()){h("a.edit_address").click();j.load_billing(true);j.load_shipping(true)}},load_billing:function(a){if(true===a||window.confirm(woocommerce_admin_meta_boxes.load_billing)){var c=h("#customer_user").val();if(!c){window.alert(woocommerce_admin_meta_boxes.no_customer_selected);return false}var b={user_id:c,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};h(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,type:"POST",success:function(d){if(d&&d.billing){h.each(d.billing,function(l,e){h(":input#_billing_"+l).val(e).change()})}h("div.edit_address").unblock()}})}return false},load_shipping:function(a){if(true===a||window.confirm(woocommerce_admin_meta_boxes.load_shipping)){var c=h("#customer_user").val();if(!c){window.alert(woocommerce_admin_meta_boxes.no_customer_selected);return false}var b={user_id:c,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};h(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,type:"POST",success:function(d){if(d&&d.billing){h.each(d.shipping,function(l,e){h(":input#_shipping_"+l).val(e).change()})}h("div.edit_address").unblock()}})}return false},copy_billing_to_shipping:function(){if(window.confirm(woocommerce_admin_meta_boxes.copy_billing)){h('.order_data_column :input[name^="_billing_"]').each(function(){var a=h(this).attr("name");a=a.replace("_billing_","_shipping_");h(":input#"+a).val(h(this).val()).change()})}return false}};var g={init:function(){this.stupidtable.init();h("#woocommerce-order-items").on("click","button.add-line-item",this.add_line_item).on("click","button.add-coupon",this.add_coupon).on("click","a.remove-coupon",this.remove_coupon).on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.add-order-item",this.add_item).on("click","button.add-order-fee",this.add_fee).on("click","button.add-order-shipping",this.add_shipping).on("click","button.add-order-tax",this.add_tax).on("click","button.save-action",this.save_line_items).on("click","a.delete-order-tax",this.delete_tax).on("click","button.calculate-action",this.recalculate).on("click","a.edit-order-item",this.edit_item).on("click","a.delete-order-item",this.delete_item).on("click","tr.item, tr.fee, tr.shipping, tr.refund",this.select_row).on("click","tr.item :input, tr.fee :input, tr.shipping :input, tr.refund :input, tr.item a, tr.fee a, tr.shipping a, tr.refund a",this.select_row_child).on("click","button.bulk-delete-items",this.bulk_actions.do_delete).on("click","button.bulk-increase-stock",this.bulk_actions.do_increase_stock).on("click","button.bulk-decrease-stock",this.bulk_actions.do_reduce_stock).on("click",".delete_refund",this.refunds.delete_refund).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wc-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("keyup change",".split-input :input",function(){var a=h(this).parent().prev().find(":input");if(a&&(a.val()===""||a.is(".match-total"))){a.val(h(this).val()).addClass("match-total")}}).on("keyup",".split-input :input",function(){h(this).removeClass("match-total")}).on("click","button.add_order_item_meta",this.item_meta.add).on("click","button.remove_order_item_meta",this.item_meta.remove);h(document.body).on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){h("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})},unblock:function(){h("#woocommerce-order-items").unblock()},reload_items:function(){var a={order_id:woocommerce_admin_meta_boxes.post_id,action:"woocommerce_load_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};g.block();h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(b){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(b);j.init_tiptip();g.unblock();g.stupidtable.init()}})},quantity_changed:function(){var n=h(this).closest("tr.item");var a=h(this).val();var c=h(this).attr("data-qty");var b=h("input.line_total",n);var d=h("input.line_subtotal",n);var e=accounting.unformat(b.attr("data-total"),woocommerce_admin.mon_decimal_point)/c;b.val(parseFloat(accounting.formatNumber(e*a,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var m=accounting.unformat(d.attr("data-subtotal"),woocommerce_admin.mon_decimal_point)/c;d.val(parseFloat(accounting.formatNumber(m*a,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));h("input.line_tax",n).each(function(){var t=h(this);var k=t.data("tax_id");var s=accounting.unformat(t.attr("data-total_tax"),woocommerce_admin.mon_decimal_point)/c;var r=h('input.line_subtotal_tax[data-tax_id="'+k+'"]',n);var l=accounting.unformat(r.attr("data-subtotal_tax"),woocommerce_admin.mon_decimal_point)/c;if(0<s){t.val(parseFloat(accounting.formatNumber(s*a,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}if(0<l){r.val(parseFloat(accounting.formatNumber(l*a,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}});h(this).trigger("quantity_changed")},add_line_item:function(){h("div.wc-order-add-item").slideDown();h("div.wc-order-data-row-toggle").not("div.wc-order-add-item").slideUp();return false},add_coupon:function(){var a=window.prompt(woocommerce_admin_meta_boxes.i18n_apply_coupon);if(a!=null){g.block();var b={action:"woocommerce_add_coupon_discount",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:a};h.post(woocommerce_admin_meta_boxes.ajax_url,b,function(c){if(c.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(c.data.html);j.init_tiptip();g.unblock();g.stupidtable.init()}else{window.alert(c.data.error)}g.unblock()})}return false},remove_coupon:function(){var a=h(this);g.block();var b={action:"woocommerce_remove_order_coupon",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:a.data("code")};h.post(woocommerce_admin_meta_boxes.ajax_url,b,function(c){if(c.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(c.data.html);j.init_tiptip();g.unblock();g.stupidtable.init()}else{window.alert(c.data.error)}g.unblock()})},refund_items:function(){h("div.wc-order-refund-items").slideDown();h("div.wc-order-data-row-toggle").not("div.wc-order-refund-items").slideUp();h("div.wc-order-totals-items").slideUp();h("#woocommerce-order-items").find("div.refund").show();h(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide();return false},cancel:function(){h("div.wc-order-data-row-toggle").not("div.wc-order-bulk-actions").slideUp();h("div.wc-order-bulk-actions").slideDown();h("div.wc-order-totals-items").slideDown();h("#woocommerce-order-items").find("div.refund").hide();h(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show();if("true"===h(this).attr("data-reload")){g.reload_items()}return false},add_item:function(){h(this).WCBackboneModal({template:"wc-modal-add-products"});return false},add_fee:function(){var a=window.prompt(woocommerce_admin_meta_boxes.i18n_add_fee);if(a!=null){g.block();var b={action:"woocommerce_add_order_fee",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,amount:a};h.post(woocommerce_admin_meta_boxes.ajax_url,b,function(c){if(c.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(c.data.html);j.init_tiptip();g.unblock();g.stupidtable.init()}else{window.alert(c.data.error)}g.unblock()})}return false},add_shipping:function(){g.block();var a={action:"woocommerce_add_order_shipping",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,dataType:"json"};h.post(woocommerce_admin_meta_boxes.ajax_url,a,function(b){if(b.success){h("table.woocommerce_order_items tbody#order_shipping_line_items").append(b.data.html)}else{window.alert(b.data.error)}g.unblock()});return false},add_tax:function(){h(this).WCBackboneModal({template:"wc-modal-add-tax"});return false},edit_item:function(){h(this).closest("tr").find(".view").hide();h(this).closest("tr").find(".edit").show();h(this).hide();h("button.add-line-item").click();h("button.cancel-action").attr("data-reload",true);return false},delete_item:function(){var a=window.confirm(woocommerce_admin_meta_boxes.remove_item_notice);if(a){var d=h(this).closest("tr.item, tr.fee, tr.shipping");var c=d.attr("data-order_item_id");g.block();var b={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:c,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce};if("true"===h("button.cancel-action").attr("data-reload")){b.items=h("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()}h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,type:"POST",success:function(e){if(e.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(e.data.html);j.init_tiptip();g.unblock();g.stupidtable.init()}else{window.alert(e.data.error)}g.unblock()}})}return false},delete_tax:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_tax)){g.block();var a={action:"woocommerce_remove_order_tax",rate_id:h(this).attr("data-rate_id"),order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(b){if(b.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(b.data.html);j.init_tiptip();g.unblock();g.stupidtable.init()}else{window.alert(b.data.error)}g.unblock()}})}return false},recalculate:function(){if(window.confirm(woocommerce_admin_meta_boxes.calc_totals)){g.block();var a="";var c="";var e="";var b="";if("shipping"===woocommerce_admin_meta_boxes.tax_based_on){a=h("#_shipping_country").val();c=h("#_shipping_state").val();e=h("#_shipping_postcode").val();b=h("#_shipping_city").val()}if("billing"===woocommerce_admin_meta_boxes.tax_based_on||!a){a=h("#_billing_country").val();c=h("#_billing_state").val();e=h("#_billing_postcode").val();b=h("#_billing_city").val()}var d={action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:h("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),country:a,state:c,postcode:e,city:b,security:woocommerce_admin_meta_boxes.calc_totals_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:d,type:"POST",success:function(l){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(l);j.init_tiptip();g.unblock();g.stupidtable.init()}})}return false},save_line_items:function(){var a={order_id:woocommerce_admin_meta_boxes.post_id,items:h("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"woocommerce_save_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};g.block();h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:a,type:"POST",success:function(b){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(b);j.init_tiptip();g.unblock();g.stupidtable.init()}});h(this).trigger("items_saved");return false},refunds:{do_refund:function(){g.block();if(window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)){var d=h("input#refund_amount").val();var a=h("input#refund_reason").val();var e={};var b={};var l={};h(".refund input.refund_order_item_qty").each(function(n,k){if(h(k).closest("tr").data("order_item_id")){if(k.value){e[h(k).closest("tr").data("order_item_id")]=k.value}}});h(".refund input.refund_line_total").each(function(n,k){if(h(k).closest("tr").data("order_item_id")){b[h(k).closest("tr").data("order_item_id")]=accounting.unformat(k.value,woocommerce_admin.mon_decimal_point)}});h(".refund input.refund_line_tax").each(function(k,p){if(h(p).closest("tr").data("order_item_id")){var o=h(p).data("tax_id");if(!l[h(p).closest("tr").data("order_item_id")]){l[h(p).closest("tr").data("order_item_id")]={}}l[h(p).closest("tr").data("order_item_id")][o]=accounting.unformat(p.value,woocommerce_admin.mon_decimal_point)}});var c={action:"woocommerce_refund_line_items",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:d,refund_reason:a,line_item_qtys:JSON.stringify(e,null,""),line_item_totals:JSON.stringify(b,null,""),line_item_tax_totals:JSON.stringify(l,null,""),api_refund:h(this).is(".do-api-refund"),restock_refunded_items:h("#restock_refunded_items:checked").length?"true":"false",security:woocommerce_admin_meta_boxes.order_item_nonce};h.post(woocommerce_admin_meta_boxes.ajax_url,c,function(k){if(true===k.success){g.reload_items();if("fully_refunded"===k.data.status){window.location.href=window.location.href}}else{window.alert(k.data.error);g.unblock()}})}else{g.unblock()}},delete_refund:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_refund)){var a=h(this).closest("tr.refund");var c=a.attr("data-order_refund_id");g.block();var b={action:"woocommerce_delete_refund",refund_id:c,security:woocommerce_admin_meta_boxes.order_item_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,type:"POST",success:function(){g.reload_items()}})}return false},input_changed:function(){var b=0;var a=h(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping");a.each(function(){var d=h(this);var c=d.find(".refund input:not(.refund_order_item_qty)");c.each(function(l,e){b+=parseFloat(accounting.unformat(h(e).val()||0,woocommerce_admin.mon_decimal_point))})});h("#refund_amount").val(accounting.formatNumber(b,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).change()},amount_changed:function(){var a=accounting.unformat(h(this).val(),woocommerce_admin.mon_decimal_point);h("button .wc-order-refund-amount .amount").text(accounting.formatMoney(a,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},refund_quantity_changed:function(){var l=h(this).closest("tr.item");var a=l.find("input.quantity").val();var c=h(this).val();var b=h("input.line_total",l);var d=h("input.refund_line_total",l);var e=accounting.unformat(b.attr("data-total"),woocommerce_admin.mon_decimal_point)/a;d.val(parseFloat(accounting.formatNumber(e*c,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change();h(".refund_line_tax",l).each(function(){var q=h(this);var k=q.data("tax_id");var p=h('input.line_tax[data-tax_id="'+k+'"]',l);var r=accounting.unformat(p.data("total_tax"),woocommerce_admin.mon_decimal_point)/a;if(0<r){q.val(parseFloat(accounting.formatNumber(r*c,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change()}else{q.val(0).change()}});if(c>0){h("#restock_refunded_items").closest("tr").show()}else{h("#restock_refunded_items").closest("tr").hide();h(".woocommerce_order_items input.refund_order_item_qty").each(function(){if(h(this).val()>0){h("#restock_refunded_items").closest("tr").show()}})}h(this).trigger("refund_quantity_changed")}},item_meta:{add:function(){var b=h(this);var d=b.closest("tr.item, tr.shipping");var a=d.find("tbody.meta_items");var c=a.find("tr").length+1;var e='<tr data-meta_id="0"><td><input type="text" placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_name+'" name="meta_key['+d.attr("data-order_item_id")+"][new-"+c+']" /><textarea placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_value+'" name="meta_value['+d.attr("data-order_item_id")+"][new-"+c+']"></textarea></td><td width="1%"><button class="remove_order_item_meta button">&times;</button></td></tr>';a.append(e);return false},remove:function(){if(window.confirm(woocommerce_admin_meta_boxes.remove_item_meta)){var a=h(this).closest("tr");a.find(":input").val("");a.hide()}return false}},select_row:function(){var d=false;if(h(this).is("tr")){d=h(this)}else{d=h(this).closest("tr")}var b=h(this).closest("table");if(d.is(".selected")){d.removeClass("selected")}else{d.addClass("selected")}var c=b.find("tr.selected");if(c.length){h("div.wc-order-item-bulk-edit").slideDown();var a=false;c.each(function(){if(h(this).is("tr.item")){a=true}});if(a){h(".bulk-increase-stock, .bulk-decrease-stock").show()}else{h(".bulk-increase-stock, .bulk-decrease-stock").hide()}}else{h("div.wc-order-item-bulk-edit").slideUp()}},select_row_child:function(a){a.stopPropagation()},bulk_actions:{do_delete:function(a){a.preventDefault();var c=h("table.woocommerce_order_items");var d=c.find("tr.selected");if(d.length&&window.confirm(woocommerce_admin_meta_boxes.remove_item_notice)){g.block();var b=[];var e=[];var l=[];h.map(d,function(k){var n=h(k);if(n.is(".refund")){e.push(parseInt(h(n).data("order_refund_id"),10))}else{b.push(parseInt(h(n).data("order_item_id"),10))}return});if(b.length){l.push(h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:{order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:b,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce},type:"POST"}))}if(e.length){l.push(h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:{action:"woocommerce_delete_refund",refund_id:e,security:woocommerce_admin_meta_boxes.order_item_nonce},type:"POST"}))}if(l){h.when.apply(h,l).done(function(){g.reload_items();g.unblock()})}else{g.unblock()}}},do_increase_stock:function(b){b.preventDefault();g.block();var d=h("table.woocommerce_order_items");var e=d.find("tr.selected");var a={};var l=h.map(e,function(k){return parseInt(h(k).data("order_item_id"),10)});e.each(function(){if(h(this).find("input.quantity").length){a[h(this).attr("data-order_item_id")]=h(this).find("input.quantity").val()}});var c={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:l,order_item_qty:a,action:"woocommerce_increase_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:c,type:"POST",success:function(k){window.alert(k);g.unblock()}})},do_reduce_stock:function(b){b.preventDefault();g.block();var d=h("table.woocommerce_order_items");var e=d.find("tr.selected");var a={};var l=h.map(e,function(k){return parseInt(h(k).data("order_item_id"),10)});e.each(function(){if(h(this).find("input.quantity").length){a[h(this).attr("data-order_item_id")]=h(this).find("input.quantity").val()}});var c={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:l,order_item_qty:a,action:"woocommerce_reduce_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:c,type:"POST",success:function(k){window.alert(k);g.unblock()}})}},backbone:{init:function(a,b){if("wc-modal-add-products"===b){h(document.body).trigger("wc-enhanced-select-init")}},response:function(a,b,d){if("wc-modal-add-tax"===b){var c=d.add_order_tax;var e="";if(d.manual_tax_rate_id){e=d.manual_tax_rate_id}g.backbone.add_tax(c,e)}if("wc-modal-add-products"===b){g.backbone.add_item(d.add_order_items)}},add_item:function(b){if(b){g.block();var a={action:"woocommerce_add_order_item",item_to_add:b,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,data:h("#wc-backbone-modal-dialog form").serialize()};if("true"===h("button.cancel-action").attr("data-reload")){a.items=h("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()}h.post(woocommerce_admin_meta_boxes.ajax_url,a,function(c){if(c.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(c.data.html);j.init_tiptip();g.stupidtable.init()}else{window.alert(c.data.error)}g.unblock()})}},add_tax:function(a,d){if(d){a=d}if(!a){return false}var c=h(".order-tax-id").map(function(){return h(this).val()}).get();if(-1===h.inArray(a,c)){g.block();var b={action:"woocommerce_add_order_tax",rate_id:a,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};h.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,dataType:"json",type:"POST",success:function(e){if(e.success){h("#woocommerce-order-items").find(".inside").empty();h("#woocommerce-order-items").find(".inside").append(e.data.html);j.init_tiptip();g.stupidtable.init()}else{window.alert(e.data.error)}g.unblock()}})}else{window.alert(woocommerce_admin_meta_boxes.i18n_tax_rate_already_exists)}}},stupidtable:{init:function(){h(".woocommerce_order_items").stupidtable();h(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(c,a){var d=h(this).find("th");var b=a.direction==="asc"?"&uarr;":"&darr;";var e=a.column;d.find(".wc-arrow").remove();d.eq(e).append('<span class="wc-arrow">'+b+"</span>")}}};var f={init:function(){h("#woocommerce-order-notes").on("click","button.add_note",this.add_order_note).on("click","a.delete_note",this.delete_order_note)},add_order_note:function(){if(!h("textarea#add_order_note").val()){return}h("#woocommerce-order-notes").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var a={action:"woocommerce_add_order_note",post_id:woocommerce_admin_meta_boxes.post_id,note:h("textarea#add_order_note").val(),note_type:h("select#order_note_type").val(),security:woocommerce_admin_meta_boxes.add_order_note_nonce};h.post(woocommerce_admin_meta_boxes.ajax_url,a,function(b){h("ul.order_notes").prepend(b);h("#woocommerce-order-notes").unblock();h("#add_order_note").val("")});return false},delete_order_note:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_note)){var b=h(this).closest("li.note");h(b).block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var a={action:"woocommerce_delete_order_note",note_id:h(b).attr("rel"),security:woocommerce_admin_meta_boxes.delete_order_note_nonce};h.post(woocommerce_admin_meta_boxes.ajax_url,a,function(){h(b).remove()})}return false}};var i={init:function(){h(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access)},grant_access:function(){var a=h("#grant_access_id").val();if(!a){return}h(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var b={action:"woocommerce_grant_access_to_download",product_ids:a,loop:h(".order_download_permissions .wc-metabox").length,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.grant_access_nonce};h.post(woocommerce_admin_meta_boxes.ajax_url,b,function(c){if(c){h(".order_download_permissions .wc-metaboxes").append(c)}else{window.alert(woocommerce_admin_meta_boxes.i18n_download_permission_fail)}h(document.body).trigger("wc-init-datepickers");h("#grant_access_id").val("").change();h(".order_download_permissions").unblock()});return false},revoke_access:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_permission_revoke)){var d=h(this).parent().parent();var a=h(this).attr("rel").split(",")[0];var e=h(this).attr("rel").split(",")[1];var c=h(this).data("permission_id");if(a>0){h(d).block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var b={action:"woocommerce_revoke_access_to_download",product_id:a,download_id:e,permission_id:c,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.revoke_access_nonce};h.post(woocommerce_admin_meta_boxes.ajax_url,b,function(){h(d).fadeOut("300",function(){h(d).remove()})})}else{h(d).fadeOut("300",function(){h(d).remove()})}}return false}};j.init();g.init();f.init();i.init()});