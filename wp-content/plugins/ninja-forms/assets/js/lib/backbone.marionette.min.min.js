/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */
(function(b,c){if("function"==typeof define&&define.amd){define(["backbone","underscore"],function(e,f){return b.Marionette=b.Mn=c(b,e,f)})}else{if("undefined"!=typeof exports){var a=require("backbone"),d=require("underscore");module.exports=c(b,a,d)}else{b.Marionette=b.Mn=c(b,b.Backbone,b._)}}})(this,function(b,g,a){(function(l,m){var h=l.ChildViewContainer;return l.ChildViewContainer=function(p,q){var o=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),q.each(e,this.add,this)};q.extend(o.prototype,{add:function(s,u){var n=s.cid;return this._views[n]=s,s.model&&(this._indexByModel[s.model.cid]=n),u&&(this._indexByCustom[u]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(i){var n=this._indexByModel[i];return this.findByCid(n)},findByCustom:function(i){var n=this._indexByCustom[i];return this.findByCid(n)},findByIndex:function(e){return q.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(n){var e=n.cid;return n.model&&delete this._indexByModel[n.model.cid],q.any(this._indexByCustom,function(i,s){return i===e?(delete this._indexByCustom[s],!0):void 0},this),delete this._views[e],this._updateLength(),this},call:function(e){this.apply(e,q.tail(arguments))},apply:function(n,e){q.each(this._views,function(i){q.isFunction(i[n])&&i[n].apply(i,e||[])})},_updateLength:function(){this.length=q.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return q.each(r,function(e){o.prototype[e]=function(){var s=q.values(this._views),t=[s].concat(q.toArray(arguments));return q[e].apply(q,t)}}),o}(l,m),l.ChildViewContainer.VERSION="0.1.7",l.ChildViewContainer.noConflict=function(){return l.ChildViewContainer=h,this},l.ChildViewContainer})(g,a),function(l,m){var h=l.Wreqr,o=l.Wreqr={};return l.Wreqr.VERSION="1.3.3",l.Wreqr.noConflict=function(){return l.Wreqr=h,this},o.Handlers=function(p,q){var n=function(e){this.options=e,this._wreqrHandlers={},q.isFunction(this.initialize)&&this.initialize(e)};return n.extend=p.Model.extend,q.extend(n.prototype,p.Events,{setHandlers:function(e){q.each(e,function(s,r){var u=null;q.isObject(s)&&!q.isFunction(s)&&(u=s.context,s=s.callback),this.setHandler(r,s,u)},this)},setHandler:function(s,u,r){var v={callback:u,context:r};this._wreqrHandlers[s]=v,this.trigger("handler:add",s,u,r)},hasHandler:function(e){return !!this._wreqrHandlers[e]},getHandler:function(i){var r=this._wreqrHandlers[i];if(r){return function(){return r.callback.apply(r.context,arguments)}}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(l,m),o.CommandStorage=function(){var e=function(i){this.options=i,this._commands={},m.isFunction(this.initialize)&&this.initialize(i)};return m.extend(e.prototype,l.Events,{getCommands:function(i){var n=this._commands[i];return n||(n={command:i,instances:[]},this._commands[i]=n),n},addCommand:function(p,q){var n=this.getCommands(p);n.instances.push(q)},clearCommands:function(i){var n=this.getCommands(i);n.instances=[]}}),e}(),o.Commands=function(i,n){return i.Handlers.extend({storageType:i.CommandStorage,constructor:function(p){this.options=p||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),i.Handlers.prototype.constructor.apply(this,arguments)},execute:function(p){p=arguments[0];var e=n.rest(arguments);this.hasHandler(p)?this.getHandler(p).apply(this,e):this.storage.addCommand(p,e)},_executeCommands:function(p,e,s){var q=this.storage.getCommands(p);n.each(q.instances,function(r){e.apply(s,r)}),this.storage.clearCommands(p)},_initializeStorage:function(p){var e,q=p.storageType||this.storageType;e=n.isFunction(q)?new q:q,this.storage=e}})}(o,m),o.RequestResponse=function(i,n){return i.Handlers.extend({request:function(e){return this.hasHandler(e)?this.getHandler(e).apply(this,n.rest(arguments)):void 0}})}(o,m),o.EventAggregator=function(p,q){var n=function(){};return n.extend=p.Model.extend,q.extend(n.prototype,p.Events),n}(l,m),o.Channel=function(){var e=function(i){this.vent=new l.Wreqr.EventAggregator,this.reqres=new l.Wreqr.RequestResponse,this.commands=new l.Wreqr.Commands,this.channelName=i};return m.extend(e.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(i,n){return this._connect("vent",i,n),this},connectCommands:function(i,n){return this._connect("commands",i,n),this},connectRequests:function(i,n){return this._connect("reqres",i,n),this},_connect:function(q,p,u){if(p){u=u||this;var s="vent"===q?"on":"setHandler";m.each(p,function(n,r){this[q][s](r,m.bind(n,u))},this)}}}),e}(o),o.radio=function(q,u){var p=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};u.extend(p.prototype,{channel:function(e){if(!e){throw Error("Channel must receive a name")}return this._getChannel(e)},_getChannel:function(r){var n=this._channels[r];return n||(n=new q.Channel(r),this._channels[r]=n),n},_proxyMethods:function(){u.each(["vent","commands","reqres"],function(e){u.each(v[e],function(i){this[e][i]=s(this,e,i)},this)},this)}});var v={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},s=function(r,e,w){return function(n){var i=r._getChannel(n)[e];return i[w].apply(i,u.rest(arguments))}};return new p}(o,m),l.Wreqr}(g,a);var k=b.Marionette,f=b.Mn,d=g.Marionette={};d.VERSION="2.4.2",d.noConflict=function(){return b.Marionette=k,b.Mn=f,this},g.Marionette=d,d.Deferred=g.$.Deferred,d.extend=g.Model.extend,d.isNodeAttached=function(e){return g.$.contains(document.documentElement,e)},d.mergeOptions=function(h,i){h&&a.extend(this,a.pick(h,i))},d.getOption=function(h,i){return h&&i?h.options&&void 0!==h.options[i]?h.options[i]:h[i]:void 0},d.proxyGetOption=function(e){return d.getOption(this,e)},d._getValue=function(h,i,l){return a.isFunction(h)&&(h=l?h.apply(i,l):h.call(i)),h},d.normalizeMethods=function(e){return a.reduce(e,function(h,i,l){return a.isFunction(i)||(i=this[i]),i&&(h[l]=i),h},{},this)},d.normalizeUIString=function(h,i){return h.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return i[e.slice(4)]})},d.normalizeUIKeys=function(h,i){return a.reduce(h,function(l,e,o){var m=d.normalizeUIString(o,i);return l[m]=e,l},{})},d.normalizeUIValues=function(h,i,l){return a.each(h,function(e,m){a.isString(e)?h[m]=d.normalizeUIString(e,i):a.isObject(e)&&a.isArray(l)&&(a.extend(e,d.normalizeUIValues(a.pick(e,l),i)),a.each(l,function(o){var p=e[o];a.isString(p)&&(e[o]=d.normalizeUIString(p,i))}))}),h},d.actAsCollection=function(h,i){var l=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];a.each(l,function(e){h[e]=function(){var m=a.values(a.result(this,i)),n=[m].concat(a.toArray(arguments));return a[e].apply(a,n)}})};var j=d.deprecate=function(h,i){a.isObject(h)&&(h=h.prev+" is going to be removed in the future. Please use "+h.next+" instead."+(h.url?" See: "+h.url:"")),void 0!==i&&i||j._cache[h]||(j._warn("Deprecation warning: "+h),j._cache[h]=!0)};j._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},j._cache={},d._triggerMethod=function(){function h(m,n,l){return l.toUpperCase()}var i=/(^|:)(\w)/gi;return function(u,p,m){var t=3>arguments.length;t&&(m=p,p=m[0]);var l,e="on"+p.replace(i,h),q=u[e];return a.isFunction(q)&&(l=q.apply(u,t?a.rest(m):m)),a.isFunction(u.trigger)&&(t+m.length>1?u.trigger.apply(u,t?m:[p].concat(a.drop(m,0))):u.trigger(p)),l}}(),d.triggerMethod=function(){return d._triggerMethod(this,arguments)},d.triggerMethodOn=function(h){var i=a.isFunction(h.triggerMethod)?h.triggerMethod:d.triggerMethod;return i.apply(h,a.rest(arguments))},d.MonitorDOMRefresh=function(h){function l(){h._isShown=!0,i()}function m(){h._isRendered=!0,i()}function i(){h._isShown&&h._isRendered&&d.isNodeAttached(h.el)&&a.isFunction(h.triggerMethod)&&h.triggerMethod("dom:refresh")}h.on({show:l,render:m})},function(h){function m(v,x,u,t){var w=t.split(/\s+/);a.each(w,function(e){var n=v[e];if(!n){throw new h.Error('Method "'+e+'" was configured as an event handler, but does not exist.')}v.listenTo(x,u,n)})}function q(r,s,o,u){r.listenTo(s,o,u)}function l(o,w,x,v){var u=v.split(/\s+/);a.each(u,function(e){var n=o[e];o.stopListening(w,x,n)})}function i(r,s,o,u){r.stopListening(s,o,u)}function p(v,x,u,t,w){if(x&&u){if(!a.isObject(u)){throw new h.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"})}u=h._getValue(u,v),a.each(u,function(e,n){a.isFunction(e)?t(v,x,n,e):w(v,x,n,e)})}}h.bindEntityEvents=function(n,e,o){p(n,e,o,q,m)},h.unbindEntityEvents=function(o,r,n){p(o,r,n,i,l)},h.proxyBindEntityEvents=function(o,n){return h.bindEntityEvents(this,o,n)},h.proxyUnbindEntityEvents=function(o,n){return h.unbindEntityEvents(this,o,n)}}(d);var c=["description","fileName","lineNumber","name","message","number"];return d.Error=d.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+d.VERSION+"/",constructor:function(h,i){a.isObject(h)?(i=h,h=i.message):i||(i={});var l=Error.call(this,h);a.extend(this,a.pick(l,c),a.pick(i,c)),this.captureStackTrace(),i.url&&(this.url=this.urlRoot+i.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,d.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),d.Error.extend=d.extend,d.Callbacks=function(){this._deferred=d.Deferred(),this._callbacks=[]},a.extend(d.Callbacks.prototype,{add:function(h,i){var l=a.result(this._deferred,"promise");this._callbacks.push({cb:h,ctx:i}),l.then(function(e){i&&(e.context=i),h.call(e.context,e.options)})},run:function(h,i){this._deferred.resolve({options:h,context:i})},reset:function(){var e=this._callbacks;this._deferred=d.Deferred(),this._callbacks=[],a.each(e,function(h){this.add(h.cb,h.ctx)},this)}}),d.Controller=function(e){this.options=e||{},a.isFunction(this.initialize)&&this.initialize(this.options)},d.Controller.extend=d.extend,a.extend(d.Controller.prototype,g.Events,{destroy:function(){return d._triggerMethod(this,"before:destroy",arguments),d._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:d.triggerMethod,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption}),d.Object=function(e){this.options=a.extend({},a.result(this,"options"),e),this.initialize.apply(this,arguments)},d.Object.extend=d.extend,a.extend(d.Object.prototype,g.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:d.triggerMethod,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.Region=d.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof g.$?this.el[0]:this.el,!this.el){throw new d.Error({name:"NoElError",message:'An "el" must be specified for a region.'})}this.$el=this.getEl(this.el),d.Object.call(this,e)},show:function(B,w){if(this._ensureElement()){this._ensureViewIsIntact(B);var p=w||{},i=B!==this.currentView,m=!!p.preventDestroy,s=!!p.forceShow,z=!!this.currentView,x=i&&!m,q=i||s;if(z&&this.triggerMethod("before:swapOut",this.currentView,this,w),this.currentView&&delete this.currentView._parent,x?this.empty():z&&q&&this.currentView.off("destroy",this.empty,this),q){B.once("destroy",this.empty,this),B.render(),B._parent=this,z&&this.triggerMethod("before:swap",B,this,w),this.triggerMethod("before:show",B,this,w),d.triggerMethodOn(B,"before:show",B,this,w),z&&this.triggerMethod("swapOut",this.currentView,this,w);var y=d.isNodeAttached(this.el),A=[],v=a.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},p);return y&&v.triggerBeforeAttach&&(A=this._displayedViews(B),this._triggerAttach(A,"before:")),this.attachHtml(B),this.currentView=B,y&&v.triggerAttach&&(A=this._displayedViews(B),this._triggerAttach(A)),z&&this.triggerMethod("swap",B,this,w),this.triggerMethod("show",B,this,w),d.triggerMethodOn(B,"show",B,this,w),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(h,i){var l=(i||"")+"attach";a.each(h,function(e){d.triggerMethodOn(e,l,e,this)},this)},_displayedViews:function(e){return a.union([e],a.result(e,"_getNestedViews")||[])},_ensureElement:function(){if(a.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl")){return !1}throw new d.Error('An "el" '+this.$el.selector+" must exist in DOM")}return !0},_ensureViewIsIntact:function(e){if(!e){throw new d.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."})}if(e.isDestroyed){throw new d.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})}},getEl:function(e){return g.$(e,d._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(l){var m=this.currentView,h=d._getValue(l,"preventDestroy",this);return m?(m.off("destroy",this.empty,this),this.triggerMethod("before:empty",m),h||this._destroyView(),this.triggerMethod("empty",m),delete this.currentView,h&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&(e.remove(),e.isDestroyed=!0)},attachView:function(e){return this.currentView=e,this},hasView:function(){return !!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(h,i){if(a.isString(h)){return this._buildRegionFromSelector(h,i)}if(h.selector||h.el||h.regionClass){return this._buildRegionFromObject(h,i)}if(a.isFunction(h)){return this._buildRegionFromRegionClass(h)}throw new d.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(h,i){return new i({el:h})},_buildRegionFromObject:function(h,l){var m=h.regionClass||l,i=a.omit(h,"selector","regionClass");return h.selector&&!i.el&&(i.el=h.selector),new m(i)},_buildRegionFromRegionClass:function(e){return new e}}),d.RegionManager=d.Controller.extend({constructor:function(e){this._regions={},this.length=0,d.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(h,i){return h=d._getValue(h,this,arguments),a.reduce(h,function(e,m,l){return a.isString(m)&&(m={selector:m}),m.selector&&(m=a.defaults({},m,i)),e[l]=this.addRegion(l,m),e},{},this)},addRegion:function(l,m){var h;return h=m instanceof d.Region?m:d.Region.buildRegion(m,d.Region),this.triggerMethod("before:add:region",l,h),h._parent=this,this._store(l,h),this.triggerMethod("add:region",l,h),h},get:function(e){return this._regions[e]},getRegions:function(){return a.clone(this._regions)},removeRegion:function(h){var i=this._regions[h];return this._remove(h,i),i},removeRegions:function(){var e=this.getRegions();return a.each(this._regions,function(h,i){this._remove(i,h)},this),e},emptyRegions:function(){var e=this.getRegions();return a.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),d.Controller.prototype.destroy.apply(this,arguments)},_store:function(h,i){this._regions[h]||this.length++,this._regions[h]=i},_remove:function(h,i){this.triggerMethod("before:remove:region",h,i),i.empty(),i.stopListening(),delete i._parent,delete this._regions[h],this.length--,this.triggerMethod("remove:region",h,i)}}),d.actAsCollection(d.RegionManager.prototype,"_regions"),d.TemplateCache=function(e){this.templateId=e},a.extend(d.TemplateCache,{templateCaches:{},get:function(l,m){var h=this.templateCaches[l];return h||(h=new d.TemplateCache(l),this.templateCaches[l]=h),h.load(m)},clear:function(){var h,i=a.toArray(arguments),l=i.length;if(l>0){for(h=0;l>h;h++){delete this.templateCaches[i[h]]}}else{this.templateCaches={}}}}),a.extend(d.TemplateCache.prototype,{load:function(h){if(this.compiledTemplate){return this.compiledTemplate}var i=this.loadTemplate(this.templateId,h);return this.compiledTemplate=this.compileTemplate(i,h),this.compiledTemplate},loadTemplate:function(h){var e=g.$(h).html();if(!e||0===e.length){throw new d.Error({name:"NoTemplateError",message:'Could not find template: "'+h+'"'})}return e},compileTemplate:function(h,i){return a.template(h,i)}}),d.Renderer={render:function(h,i){if(!h){throw new d.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."})}var l=a.isFunction(h)?h:d.TemplateCache.get(h);return l(i)}},d.View=g.View.extend({isDestroyed:!1,constructor:function(e){a.bindAll(this,"render"),e=d._getValue(e,this),this.options=a.extend({},a.result(this,"options"),e),this._behaviors=d.Behaviors(this),g.View.call(this,this.options),d.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,a.rest(arguments))},mixinTemplateHelpers:function(h){h=h||{};var i=this.getOption("templateHelpers");return i=d._getValue(i,this),a.extend(h,i)},normalizeUIKeys:function(h){var i=a.result(this,"_uiBindings");return d.normalizeUIKeys(h,i||a.result(this,"ui"))},normalizeUIValues:function(h,l){var m=a.result(this,"ui"),i=a.result(this,"_uiBindings");return d.normalizeUIValues(h,i||m,l)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(a.result(this,"triggers"));return a.reduce(e,function(l,m,h){return l[h]=this._buildViewTrigger(m),l},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),a.each(this._behaviors,function(h){h.bindEntityEvents(this.model,h.getOption("modelEvents")),h.bindEntityEvents(this.collection,h.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(i){var q=d._getValue(i||this.events,this);q=this.normalizeUIKeys(q),a.isUndefined(i)&&(this.events=q);var m={},p=a.result(this,"behaviorEvents")||{},l=this.configureTriggers(),e=a.result(this,"behaviorTriggers")||{};a.extend(m,p,q,l,e),g.View.prototype.delegateEvents.call(this,m)},undelegateEvents:function(){return g.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),a.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed){throw new d.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})}},destroy:function(){if(this.isDestroyed){return this}var e=a.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),a.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),a.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=a.result(this,"_uiBindings");this.ui={},a.each(e,function(h,i){this.ui[i]=this.$(h)},this)}},unbindUIElements:function(){this._unbindUIElements(),a.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(a.each(this.ui,function(h,i){delete this.ui[i]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(h){var l=a.isObject(h),m=a.defaults({},l?h:{},{preventDefault:!0,stopPropagation:!0}),i=l?m.event:h;return function(n){n&&(n.preventDefault&&m.preventDefault&&n.preventDefault(),n.stopPropagation&&m.stopPropagation&&n.stopPropagation());var o={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,o)}},setElement:function(){var e=g.View.prototype.setElement.apply(this,arguments);return a.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=d._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],a.rest(arguments)),e},_triggerEventOnBehaviors:function(l){for(var o=d._triggerMethod,h=this._behaviors,p=0,m=h&&h.length;m>p;p++){o(h[p],l)}},_triggerEventOnParentLayout:function(l,q){var u=this._parentLayoutView();if(u){var p=d.getOption(u,"childViewEventPrefix"),s=p+":"+l;d._triggerMethod(u,[s,this].concat(q));var m=d.getOption(u,"childEvents"),i=u.normalizeMethods(m);i&&a.isFunction(i[l])&&i[l].apply(u,[this].concat(q))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?a.reduce(e,function(h,i){return i._getNestedViews?h.concat(i._getNestedViews()):h},e):e},_getAncestors:function(){for(var h=[],i=this._parent;i;){h.push(i),i=i._parent}return h},_parentLayoutView:function(){var e=this._getAncestors();return a.find(e,function(h){return h instanceof d.LayoutView})},normalizeMethods:d.normalizeMethods,mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.ItemView=d.View.extend({constructor:function(){d.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection){return{}}var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,a.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var l=this.getTemplate();if(l!==!1){if(!l){throw new d.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."})}var m=this.mixinTemplateHelpers(this.serializeData()),h=d.Renderer.render(l,m,this);return this.attachElContent(h),this}},attachElContent:function(e){return this.$el.html(e),this}}),d.CollectionView=d.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(){this.once("render",this._initialEvents),this._initChildViewStorage(),d.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var h,i=this._isShown&&d.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),i&&this._triggerBeforeAttach&&(h=this._getNestedViews(),this._triggerMethodMany(h,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),i&&this._triggerAttach&&(h=this._getNestedViews(),this._triggerMethodMany(h,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(h,l,m){var i=a.drop(arguments,3);a.each(h,function(e){d.triggerMethodOn.apply(e,[e,m,e,l].concat(i))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(h,m,o){var l;if(l=void 0!==o.at?o.at:a.indexOf(this._filteredSortedModels(),h),this._shouldAddChild(h,l)){this.destroyEmptyView();var i=this.getChildView(h);this.addChild(h,i,l)}},_onCollectionRemove:function(h){var i=this.children.findByModel(h);this.removeChildView(i),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){d.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){d.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var h=this.children,l=this._filteredSortedModels(),m=a.find(l,function(n){return !h.findByModel(n)});if(m){this.render()}else{var i=a.map(l,function(p,o){var q=h.findByModel(p);return q._index=o,q.el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(i),this.triggerMethod("reorder")}},resortView:function(){d.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var h=this._filteredSortedModels(),i=a.find(h,function(m,n){var l=this.children.findByModel(m);return !l||l._index!==n},this);i&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var h,i=this._filteredSortedModels();a.each(i,function(m,l){h=this.getChildView(m),this.addChild(m,h,l)},this)},_filteredSortedModels:function(){var h,i=this.getViewComparator();return h=i?a.isString(i)||1===i.length?this.collection.sortBy(i,this):a.clone(this.collection.models).sort(a.bind(i,this)):this.collection.models,this.getOption("filter")&&(h=a.filter(h,function(l,m){return this._shouldAddChild(l,m)},this)),h},showEmptyView:function(){var h=this.getEmptyView();if(h&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var e=new g.Model;this.addEmptyView(e,h),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(i,p){var s,m=this._isShown&&!this.isBuffering&&d.isNodeAttached(this.el),q=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");a.isFunction(q)&&(q=q.call(this,i,this._emptyViewIndex));var l=this.buildChildView(i,p,q);l._parent=this,this.proxyChildEvents(l),this._isShown&&d.triggerMethodOn(l,"before:show",l),this.children.add(l),m&&this._triggerBeforeAttach&&(s=[l].concat(l._getNestedViews()),l.once("render",function(){this._triggerMethodMany(s,this,"before:attach")},this)),this.renderChildView(l,this._emptyViewIndex),m&&this._triggerAttach&&(s=[l].concat(l._getNestedViews()),this._triggerMethodMany(s,this,"attach")),this._isShown&&d.triggerMethodOn(l,"show",l)},getChildView:function(){var e=this.getOption("childView");if(!e){throw new d.Error({name:"NoChildViewError",message:'A "childView" must be specified'})}return e},addChild:function(l,o,h){var p=this.getOption("childViewOptions");p=d._getValue(p,this,[l,h]);var m=this.buildChildView(l,o,p);return this._updateIndices(m,!0,h),this.triggerMethod("before:add:child",m),this._addChildView(m,h),this.triggerMethod("add:child",m),m._parent=this,m},_updateIndices:function(l,m,h){this.getOption("sort")&&(m&&(l._index=h),this.children.each(function(e){e._index>=l._index&&(e._index+=m?1:-1)}))},_addChildView:function(l,m){var h,o=this._isShown&&!this.isBuffering&&d.isNodeAttached(this.el);this.proxyChildEvents(l),this._isShown&&!this.isBuffering&&d.triggerMethodOn(l,"before:show",l),this.children.add(l),o&&this._triggerBeforeAttach&&(h=[l].concat(l._getNestedViews()),l.once("render",function(){this._triggerMethodMany(h,this,"before:attach")},this)),this.renderChildView(l,m),o&&this._triggerAttach&&(h=[l].concat(l._getNestedViews()),this._triggerMethodMany(h,this,"attach")),this._isShown&&!this.isBuffering&&d.triggerMethodOn(l,"show",l)},renderChildView:function(h,i){return h.render(),this.attachHtml(this,h,i),h},buildChildView:function(h,l,m){var i=a.extend({model:h},m);return new l(i)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return !this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(h,i){h.$el.append(i)},_createBuffer:function(){var e=document.createDocumentFragment();return a.each(this._bufferedChildren,function(h){e.appendChild(h.el)}),e},attachHtml:function(l,m,h){l.isBuffering?l._bufferedChildren.splice(h,0,m):l._insertBefore(m,h)||l._insertAfter(m)},_insertBefore:function(l,m){var h,o=this.getOption("sort")&&this.children.length-1>m;return o&&(h=this.children.find(function(e){return e._index===m+1})),h?(h.$el.before(l.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new g.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),d.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(h){var l=h||{},m=!0,i=this.children.map(a.identity);return a.isUndefined(l.checkEmpty)||(m=l.checkEmpty),this.children.each(this.removeChildView,this),m&&this.checkEmpty(),i},_shouldAddChild:function(h,i){var l=this.getOption("filter");return !a.isFunction(l)||l.call(this,h,i,this.collection)},proxyChildEvents:function(h){var i=this.getOption("childViewEventPrefix");this.listenTo(h,"all",function(){var m=a.toArray(arguments),l=m[0],e=this.normalizeMethods(a.result(this,"childEvents"));m[0]=i+":"+l,m.splice(1,0,h),e!==void 0&&a.isFunction(e[l])&&e[l].apply(this,m.slice(1)),this.triggerMethod.apply(this,m)})},_getImmediateChildren:function(){return a.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),d.CompositeView=d.CollectionView.extend({constructor:function(){d.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(){var e=this.getOption("childView")||this.constructor;return e},serializeData:function(){var e={};return this.model&&(e=a.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&d.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var l={};l=this.serializeData(),l=this.mixinTemplateHelpers(l),this.triggerMethod("before:render:template");var m=this.getTemplate(),h=d.Renderer.render(m,l,this);this.attachElContent(h),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(l,m){var h=this.getChildViewContainer(l);h.append(m)},_insertAfter:function(h){var i=this.getChildViewContainer(this,h);i.append(h.el)},_appendReorderedChildren:function(h){var i=this.getChildViewContainer(this);i.append(h)},getChildViewContainer:function(l){if(l.$childViewContainer){return l.$childViewContainer}var m,h=d.getOption(l,"childViewContainer");if(h){var o=d._getValue(h,l);if(m="@"===o.charAt(0)&&l.ui?l.ui[o.substr(4)]:l.$(o),0>=m.length){throw new d.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+l.childViewContainer})}}else{m=l.$el}return l.$childViewContainer=m,m},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),d.LayoutView=d.ItemView.extend({regionClass:d.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),d.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),d.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),d.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(h,i){return this.getRegion(h).show(i)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(l,m){var h={};return h[l]=m,this._buildRegions(h)[l]},addRegions:function(e){return this.regions=a.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(h){var i={regionClass:this.getOption("regionClass"),parentEl:a.partial(a.result,this,"el")};return this.regionManager.addRegions(h,i)},_initializeRegions:function(h){var i;this._initRegionManager(),i=d._getValue(this.regions,this,[h])||{};var l=this.getOption.call(h,"regions");l=d._getValue(l,this,[h]),a.extend(i,l),i=this.normalizeUIValues(i,["selector","el"]),this.addRegions(i)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new d.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(h,i){this[h]=i,this.triggerMethod("add:region",h,i)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(h,i){delete this[h],this.triggerMethod("remove:region",h,i)})},_getImmediateChildren:function(){return a.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),d.Behavior=d.Object.extend({constructor:function(h,i){this.view=i,this.defaults=a.result(this,"defaults")||{},this.options=a.extend({},this.defaults,h),this.ui=a.extend({},a.result(i,"ui"),a.result(this,"ui")),d.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),d.Behaviors=function(l,q){function h(e,i){return q.isObject(e.behaviors)?(i=h.parseBehaviors(e,i||q.result(e,"behaviors")),h.wrap(e,i,q.keys(u)),i):{}}function v(i,n){this._view=i,this._behaviors=n,this._triggers={}}function p(e){return e._uiBindings||e.ui}var m=/^(\S+)\s*(.*)$/,u={behaviorTriggers:function(o,r){var n=new v(this,r);return n.buildBehaviorTriggers()},behaviorEvents:function(e,s){var r={};return q.each(s,function(t,y){var w={},o=q.clone(q.result(t,"events"))||{};o=l.normalizeUIKeys(o,p(t));var x=0;q.each(o,function(A,B){var C=B.match(m),n=C[1]+"."+[this.cid,y,x++," "].join(""),i=C[2],D=n+i,z=q.isFunction(A)?A:t[A];w[D]=q.bind(z,t)},this),r=q.extend(r,w)},this),r}};return q.extend(h,{behaviorsLookup:function(){throw new l.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(i,o){return i.behaviorClass?i.behaviorClass:l._getValue(h.behaviorsLookup,this,[i,o])[o]},parseBehaviors:function(e,i){return q.chain(i).map(function(z,x){var w=h.getBehaviorClass(z,x),y=new w(z,e),t=h.parseBehaviors(e,q.result(y,"behaviors"));return[y].concat(t)}).flatten().value()},wrap:function(o,e,r){q.each(r,function(i){o[i]=q.partial(u[i],o[i],e)})}}),q.extend(v.prototype,{buildBehaviorTriggers:function(){return q.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(e,r){var o=q.clone(q.result(e,"triggers"))||{};o=l.normalizeUIKeys(o,p(e)),q.each(o,q.bind(this._setHandlerForBehavior,this,e,r))},_setHandlerForBehavior:function(s,x,o,y){var w=y.replace(/^\S+/,function(e){return e+".behaviortriggers"+x});this._triggers[w]=this._view._buildViewTrigger(o)}}),h}(d,a),d.AppRouter=g.Router.extend({constructor:function(h){this.options=h||{},g.Router.apply(this,arguments);var e=this.getOption("appRoutes"),l=this._getController();this.processAppRoutes(l,e),this.on("route",this._processOnRoute,this)},appRoute:function(l,m){var h=this._getController();this._addAppRoute(h,l,m)},_processOnRoute:function(h,i){if(a.isFunction(this.onRoute)){var l=a.invert(this.getOption("appRoutes"))[h];this.onRoute(h,l,i)}},processAppRoutes:function(h,i){if(i){var l=a.keys(i).reverse();a.each(l,function(e){this._addAppRoute(h,e,i[e])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(h,l,m){var i=h[m];if(!i){throw new d.Error('Method "'+m+'" was not found on the controller')}this.route(l,m,a.bind(i,h))},mergeOptions:d.mergeOptions,getOption:d.proxyGetOption,triggerMethod:d.triggerMethod,bindEntityEvents:d.proxyBindEntityEvents,unbindEntityEvents:d.proxyUnbindEntityEvents}),d.Application=d.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new d.Callbacks,this.submodules={},a.extend(this,e),this._initChannel(),d.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(h,l){var m=d.Module.getClass(l),i=a.toArray(arguments);return i.unshift(this),m.create.apply(m,i)},getRegionManager:function(){return new d.RegionManager},_initializeRegions:function(h){var i=a.isFunction(this.regions)?this.regions(h):this.regions||{};this._initRegionManager();var l=d.getOption(h,"regions");return a.isFunction(l)&&(l=l.call(this,h)),a.extend(i,l),this.addRegions(i),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){d._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(h,i){this[h]=i,d._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){d._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],d._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=a.result(this,"channelName")||"global",this.channel=a.result(this,"channel")||g.Wreqr.radio.channel(this.channelName),this.vent=a.result(this,"vent")||this.channel.vent,this.commands=a.result(this,"commands")||this.channel.commands,this.reqres=a.result(this,"reqres")||this.channel.reqres}}),d.Module=function(h,i,l){this.moduleName=h,this.options=a.extend({},this.options,l),this.initialize=l.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=i,a.isFunction(this.initialize)&&this.initialize(h,i,this.options)},d.Module.extend=d.extend,a.extend(d.Module.prototype,g.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(a.each(this.submodules,function(h){h.startWithParent&&h.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),a.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(h,i){this._runModuleDefinition(h,i)},_runModuleDefinition:function(e,i){if(e){var h=a.flatten([this,this.app,g,d,g.$,a,i]);e.apply(this,h)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new d.Callbacks,this._finalizerCallbacks=new d.Callbacks},triggerMethod:d.triggerMethod}),a.extend(d.Module,{create:function(i,q,v){var p=i,m=a.drop(arguments,3);q=q.split(".");var u=q.length,l=[];return l[u-1]=v,a.each(q,function(n,h){var r=p;p=this._getModule(r,n,i,v),this._addModuleDefinition(r,p,l[h],m)},this),p},_getModule:function(i,q,v,p){var m=a.extend({},p),u=this.getClass(p),l=i[q];return l||(l=new u(q,v,m),i[q]=l,i.submodules[q]=l),l},getClass:function(h){var i=d.Module;return h?h.prototype instanceof i?h:h.moduleClass||i:i},_addModuleDefinition:function(l,p,h,q){var o=this._getDefine(h),m=this._getStartWithParent(h,p);o&&p.addDefinition(o,q),this._addStartWithParent(l,p,m)},_getStartWithParent:function(h,i){var l;return a.isFunction(h)&&h.prototype instanceof d.Module?(l=i.constructor.prototype.startWithParent,a.isUndefined(l)?!0:l):a.isObject(h)?(l=h.startWithParent,a.isUndefined(l)?!0:l):!0},_getDefine:function(e){return !a.isFunction(e)||e.prototype instanceof d.Module?a.isObject(e)?e.define:null:e},_addStartWithParent:function(l,m,h){m.startWithParent=m.startWithParent&&h,m.startWithParent&&!m.startWithParentIsConfigured&&(m.startWithParentIsConfigured=!0,l.addInitializer(function(e){m.startWithParent&&m.start(e)}))}}),d});