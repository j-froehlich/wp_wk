!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],b):a.Backbone.Radio=b(a._,a.Backbone)}(this,function(w,j){function A(h,i,a,f){var c=h[i];return a&&a!==c.callback&&a!==c.callback._callback||f&&f!==c.context?void 0:(delete h[i],!0)}function b(D,p,l,h){D||(D={});for(var e=p?[p]:w.keys(D),f=!1,t=0,C=e.length;C>t;t++){p=e[t],D[p]&&A(D,p,l,h)&&(f=!0)}return f}function B(a){return x[a]||(x[a]=w.partial(z.log,a))}function m(a){return w.isFunction(a)?a:function(){return a}}var y=j.Radio,z=j.Radio={};z.VERSION="1.0.1",z.noConflict=function(){return j.Radio=y,this},z.DEBUG=!1,z._debugText=function(c,f,a){return c+(a?" on the "+a+" channel":"")+': "'+f+'"'},z.debugLog=function(c,f,a){z.DEBUG&&console&&console.warn&&console.warn(z._debugText(c,f,a))};var g=/\s+/;z._eventsApi=function(f,G,e,H){if(!e){return !1}var p={};if("object"==typeof e){for(var E in e){var F=f[G].apply(f,[E,e[E]].concat(H));g.test(E)?w.extend(p,F):p[E]=F}return p}if(g.test(e)){for(var D=e.split(g),o=0,C=D.length;C>o;o++){p[D[o]]=f[G].apply(f,[D[o]].concat(H))}return p}return !1},z._callHandler=function(l,o,c){var h=c[0],f=c[1],a=c[2];switch(c.length){case 0:return l.call(o);case 1:return l.call(o,h);case 2:return l.call(o,h,f);case 3:return l.call(o,h,f,a);default:return l.apply(o,c)}};var x={};w.extend(z,{log:function(e,a){var c=w.rest(arguments,2);console.log("["+e+'] "'+a+'"',c)},tuneIn:function(a){var c=z.channel(a);return c._tunedIn=!0,c.on("all",B(a)),this},tuneOut:function(a){var c=z.channel(a);return c._tunedIn=!1,c.off("all",B(a)),delete x[a],this}}),z.Requests={request:function(o){var f=w.rest(arguments),l=z._eventsApi(this,"request",o,f);if(l){return l}var h=this.channelName,e=this._requests;if(h&&this._tunedIn&&z.log.apply(this,[h,o].concat(f)),e&&(e[o]||e["default"])){var c=e[o]||e["default"];return f=e[o]?f:arguments,z._callHandler(c.callback,c.context,f)}z.debugLog("An unhandled request was fired",o,h)},reply:function(c,f,a){return z._eventsApi(this,"reply",c,[f,a])?this:(this._requests||(this._requests={}),this._requests[c]&&z.debugLog("A request was overwritten",c,this.channelName),this._requests[c]={callback:m(f),context:a||this},this)},replyOnce:function(i,e,h){if(z._eventsApi(this,"replyOnce",i,[e,h])){return this}var f=this,c=w.once(function(){return f.stopReplying(i),m(e).apply(this,arguments)});return this.reply(i,c,h)},stopReplying:function(c,f,a){return z._eventsApi(this,"stopReplying",c)?this:(c||f||a?b(this._requests,c,f,a)||z.debugLog("Attempted to remove the unregistered request",c,this.channelName):delete this._requests,this)}},z._channels={},z.channel=function(a){if(!a){throw new Error("You must provide a name for the channel.")}return z._channels[a]?z._channels[a]:z._channels[a]=new z.Channel(a)},z.Channel=function(a){this.channelName=a},w.extend(z.Channel.prototype,j.Events,z.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var k,q,v=[j.Events,z.Commands,z.Requests];w.each(v,function(a){w.each(a,function(e,c){z[c]=function(f){return q=w.rest(arguments),k=this.channel(f),k[c].apply(k,q)}})}),z.reset=function(c){var a=c?[this._channels[c]]:this._channels;w.invoke(a,"reset")};var d=z;return d});