jQuery(function(e){var c={states:null,init:function(){if(!(typeof woocommerce_admin_meta_boxes_order==="undefined"||typeof woocommerce_admin_meta_boxes_order.countries==="undefined")){this.states=e.parseJSON(woocommerce_admin_meta_boxes_order.countries.replace(/&quot;/g,'"'))}e(".js_field-country").selectWoo().change(this.change_country);e(".js_field-country").trigger("change",[true]);e(document.body).on("change","select.js_field-state",this.change_state);e("#woocommerce-order-actions input, #woocommerce-order-actions a").click(function(){window.onbeforeunload=""});e("a.edit_address").click(this.edit_address);e("a.billing-same-as-shipping").on("click",this.copy_billing_to_shipping);e("a.load_customer_billing").on("click",this.load_billing);e("a.load_customer_shipping").on("click",this.load_shipping);e("#customer_user").on("change",this.change_customer_user)},change_country:function(l,o){if(typeof o==="undefined"){o=false}if(c.states===null){return}var n=e(this),h=n.val(),f=n.parents("div.edit_address").find(":input.js_field-state"),j=f.parent(),k=f.attr("name"),m=f.attr("id"),q=n.data("woocommerce.stickState-"+h)?n.data("woocommerce.stickState-"+h):f.val(),p=f.attr("placeholder");if(o){n.data("woocommerce.stickState-"+h,q)}j.show().find(".select2-container").remove();if(!e.isEmptyObject(c.states[h])){var i=e('<select name="'+k+'" id="'+m+'" class="js_field-state select short" placeholder="'+p+'"></select>'),g=c.states[h];i.append(e('<option value="">'+woocommerce_admin_meta_boxes_order.i18n_select_state_text+"</option>"));e.each(g,function(r){i.append(e('<option value="'+r+'">'+g[r]+"</option>"))});i.val(q);f.replaceWith(i);i.show().selectWoo().hide().change()}else{f.replaceWith('<input type="text" class="js_field-state" name="'+k+'" id="'+m+'" value="'+q+'" placeholder="'+p+'" />')}e(document.body).trigger("contry-change.woocommerce",[h,e(this).closest("div")]);e(document.body).trigger("country-change.woocommerce",[h,e(this).closest("div")])},change_state:function(){var h=e(this),g=h.val(),f=h.parents("div.edit_address").find(":input.js_field-country"),i=f.val();f.data("woocommerce.stickState-"+i,g)},init_tiptip:function(){e("#tiptip_holder").removeAttr("style");e("#tiptip_arrow").removeAttr("style");e(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},edit_address:function(k){k.preventDefault();var j=e(this),h=j.closest(".order_data_column"),g=h.find("div.edit_address"),l=h.find("div.address"),i=g.find(".js_field-country"),f=g.find(".js_field-state");l.hide();j.parent().find("a").toggle();if(!i.val()){i.val(woocommerce_admin_meta_boxes_order.default_country).change()}if(!f.val()){f.val(woocommerce_admin_meta_boxes_order.default_state).change()}g.show()},change_customer_user:function(){if(!e("#_billing_country").val()){e("a.edit_address").click();c.load_billing(true);c.load_shipping(true)}},load_billing:function(h){if(true===h||window.confirm(woocommerce_admin_meta_boxes.load_billing)){var f=e("#customer_user").val();if(!f){window.alert(woocommerce_admin_meta_boxes.no_customer_selected);return false}var g={user_id:f,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};e(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:g,type:"POST",success:function(i){if(i&&i.billing){e.each(i.billing,function(j,k){e(":input#_billing_"+j).val(k).change()})}e("div.edit_address").unblock()}})}return false},load_shipping:function(h){if(true===h||window.confirm(woocommerce_admin_meta_boxes.load_shipping)){var f=e("#customer_user").val();if(!f){window.alert(woocommerce_admin_meta_boxes.no_customer_selected);return false}var g={user_id:f,action:"woocommerce_get_customer_details",security:woocommerce_admin_meta_boxes.get_customer_details_nonce};e(this).closest("div.edit_address").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:g,type:"POST",success:function(i){if(i&&i.billing){e.each(i.shipping,function(j,k){e(":input#_shipping_"+j).val(k).change()})}e("div.edit_address").unblock()}})}return false},copy_billing_to_shipping:function(){if(window.confirm(woocommerce_admin_meta_boxes.copy_billing)){e('.order_data_column :input[name^="_billing_"]').each(function(){var f=e(this).attr("name");f=f.replace("_billing_","_shipping_");e(":input#"+f).val(e(this).val()).change()})}return false}};var a={init:function(){this.stupidtable.init();e("#woocommerce-order-items").on("click","button.add-line-item",this.add_line_item).on("click","button.add-coupon",this.add_coupon).on("click","a.remove-coupon",this.remove_coupon).on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.add-order-item",this.add_item).on("click","button.add-order-fee",this.add_fee).on("click","button.add-order-shipping",this.add_shipping).on("click","button.add-order-tax",this.add_tax).on("click","button.save-action",this.save_line_items).on("click","a.delete-order-tax",this.delete_tax).on("click","button.calculate-action",this.recalculate).on("click","a.edit-order-item",this.edit_item).on("click","a.delete-order-item",this.delete_item).on("click","tr.item, tr.fee, tr.shipping, tr.refund",this.select_row).on("click","tr.item :input, tr.fee :input, tr.shipping :input, tr.refund :input, tr.item a, tr.fee a, tr.shipping a, tr.refund a",this.select_row_child).on("click","button.bulk-delete-items",this.bulk_actions.do_delete).on("click","button.bulk-increase-stock",this.bulk_actions.do_increase_stock).on("click","button.bulk-decrease-stock",this.bulk_actions.do_reduce_stock).on("click",".delete_refund",this.refunds.delete_refund).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wc-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("keyup change",".split-input :input",function(){var f=e(this).parent().prev().find(":input");if(f&&(f.val()===""||f.is(".match-total"))){f.val(e(this).val()).addClass("match-total")}}).on("keyup",".split-input :input",function(){e(this).removeClass("match-total")}).on("click","button.add_order_item_meta",this.item_meta.add).on("click","button.remove_order_item_meta",this.item_meta.remove);e(document.body).on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){e("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})},unblock:function(){e("#woocommerce-order-items").unblock()},reload_items:function(){var f={order_id:woocommerce_admin_meta_boxes.post_id,action:"woocommerce_load_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};a.block();e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:f,type:"POST",success:function(g){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(g);c.init_tiptip();a.unblock();a.stupidtable.init()}})},quantity_changed:function(){var f=e(this).closest("tr.item");var l=e(this).val();var j=e(this).attr("data-qty");var k=e("input.line_total",f);var i=e("input.line_subtotal",f);var h=accounting.unformat(k.attr("data-total"),woocommerce_admin.mon_decimal_point)/j;k.val(parseFloat(accounting.formatNumber(h*l,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));var g=accounting.unformat(i.attr("data-subtotal"),woocommerce_admin.mon_decimal_point)/j;i.val(parseFloat(accounting.formatNumber(g*l,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point));e("input.line_tax",f).each(function(){var n=e(this);var m=n.data("tax_id");var o=accounting.unformat(n.attr("data-total_tax"),woocommerce_admin.mon_decimal_point)/j;var p=e('input.line_subtotal_tax[data-tax_id="'+m+'"]',f);var q=accounting.unformat(p.attr("data-subtotal_tax"),woocommerce_admin.mon_decimal_point)/j;if(0<o){n.val(parseFloat(accounting.formatNumber(o*l,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}if(0<q){p.val(parseFloat(accounting.formatNumber(q*l,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point))}});e(this).trigger("quantity_changed")},add_line_item:function(){e("div.wc-order-add-item").slideDown();e("div.wc-order-data-row-toggle").not("div.wc-order-add-item").slideUp();return false},add_coupon:function(){var g=window.prompt(woocommerce_admin_meta_boxes.i18n_apply_coupon);if(g!=null){a.block();var f={action:"woocommerce_add_coupon_discount",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:g};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(h){if(h.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(h.data.html);c.init_tiptip();a.unblock();a.stupidtable.init()}else{window.alert(h.data.error)}a.unblock()})}return false},remove_coupon:function(){var g=e(this);a.block();var f={action:"woocommerce_remove_order_coupon",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:g.data("code")};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(h){if(h.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(h.data.html);c.init_tiptip();a.unblock();a.stupidtable.init()}else{window.alert(h.data.error)}a.unblock()})},refund_items:function(){e("div.wc-order-refund-items").slideDown();e("div.wc-order-data-row-toggle").not("div.wc-order-refund-items").slideUp();e("div.wc-order-totals-items").slideUp();e("#woocommerce-order-items").find("div.refund").show();e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide();return false},cancel:function(){e("div.wc-order-data-row-toggle").not("div.wc-order-bulk-actions").slideUp();e("div.wc-order-bulk-actions").slideDown();e("div.wc-order-totals-items").slideDown();e("#woocommerce-order-items").find("div.refund").hide();e(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show();if("true"===e(this).attr("data-reload")){a.reload_items()}return false},add_item:function(){e(this).WCBackboneModal({template:"wc-modal-add-products"});return false},add_fee:function(){var g=window.prompt(woocommerce_admin_meta_boxes.i18n_add_fee);if(g!=null){a.block();var f={action:"woocommerce_add_order_fee",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,amount:g};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(h){if(h.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(h.data.html);c.init_tiptip();a.unblock();a.stupidtable.init()}else{window.alert(h.data.error)}a.unblock()})}return false},add_shipping:function(){a.block();var f={action:"woocommerce_add_order_shipping",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,dataType:"json"};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(g){if(g.success){e("table.woocommerce_order_items tbody#order_shipping_line_items").append(g.data.html)}else{window.alert(g.data.error)}a.unblock()});return false},add_tax:function(){e(this).WCBackboneModal({template:"wc-modal-add-tax"});return false},edit_item:function(){e(this).closest("tr").find(".view").hide();e(this).closest("tr").find(".edit").show();e(this).hide();e("button.add-line-item").click();e("button.cancel-action").attr("data-reload",true);return false},delete_item:function(){var i=window.confirm(woocommerce_admin_meta_boxes.remove_item_notice);if(i){var f=e(this).closest("tr.item, tr.fee, tr.shipping");var g=f.attr("data-order_item_id");a.block();var h={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:g,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce};if("true"===e("button.cancel-action").attr("data-reload")){h.items=e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()}e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:h,type:"POST",success:function(j){if(j.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(j.data.html);c.init_tiptip();a.unblock();a.stupidtable.init()}else{window.alert(j.data.error)}a.unblock()}})}return false},delete_tax:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_tax)){a.block();var f={action:"woocommerce_remove_order_tax",rate_id:e(this).attr("data-rate_id"),order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:f,type:"POST",success:function(g){if(g.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(g.data.html);c.init_tiptip();a.unblock();a.stupidtable.init()}else{window.alert(g.data.error)}a.unblock()}})}return false},recalculate:function(){if(window.confirm(woocommerce_admin_meta_boxes.calc_totals)){a.block();var j="";var h="";var f="";var i="";if("shipping"===woocommerce_admin_meta_boxes.tax_based_on){j=e("#_shipping_country").val();h=e("#_shipping_state").val();f=e("#_shipping_postcode").val();i=e("#_shipping_city").val()}if("billing"===woocommerce_admin_meta_boxes.tax_based_on||!j){j=e("#_billing_country").val();h=e("#_billing_state").val();f=e("#_billing_postcode").val();i=e("#_billing_city").val()}var g={action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),country:j,state:h,postcode:f,city:i,security:woocommerce_admin_meta_boxes.calc_totals_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:g,type:"POST",success:function(k){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(k);c.init_tiptip();a.unblock();a.stupidtable.init()}})}return false},save_line_items:function(){var f={order_id:woocommerce_admin_meta_boxes.post_id,items:e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),action:"woocommerce_save_order_items",security:woocommerce_admin_meta_boxes.order_item_nonce};a.block();e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:f,type:"POST",success:function(g){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(g);c.init_tiptip();a.unblock();a.stupidtable.init()}});e(this).trigger("items_saved");return false},refunds:{do_refund:function(){a.block();if(window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)){var h=e("input#refund_amount").val();var k=e("input#refund_reason").val();var g={};var j={};var f={};e(".refund input.refund_order_item_qty").each(function(l,m){if(e(m).closest("tr").data("order_item_id")){if(m.value){g[e(m).closest("tr").data("order_item_id")]=m.value}}});e(".refund input.refund_line_total").each(function(l,m){if(e(m).closest("tr").data("order_item_id")){j[e(m).closest("tr").data("order_item_id")]=accounting.unformat(m.value,woocommerce_admin.mon_decimal_point)}});e(".refund input.refund_line_tax").each(function(m,n){if(e(n).closest("tr").data("order_item_id")){var l=e(n).data("tax_id");if(!f[e(n).closest("tr").data("order_item_id")]){f[e(n).closest("tr").data("order_item_id")]={}}f[e(n).closest("tr").data("order_item_id")][l]=accounting.unformat(n.value,woocommerce_admin.mon_decimal_point)}});var i={action:"woocommerce_refund_line_items",order_id:woocommerce_admin_meta_boxes.post_id,refund_amount:h,refund_reason:k,line_item_qtys:JSON.stringify(g,null,""),line_item_totals:JSON.stringify(j,null,""),line_item_tax_totals:JSON.stringify(f,null,""),api_refund:e(this).is(".do-api-refund"),restock_refunded_items:e("#restock_refunded_items:checked").length?"true":"false",security:woocommerce_admin_meta_boxes.order_item_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,i,function(l){if(true===l.success){a.reload_items();if("fully_refunded"===l.data.status){window.location.href=window.location.href}}else{window.alert(l.data.error);a.unblock()}})}else{a.unblock()}},delete_refund:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_refund)){var h=e(this).closest("tr.refund");var f=h.attr("data-order_refund_id");a.block();var g={action:"woocommerce_delete_refund",refund_id:f,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:g,type:"POST",success:function(){a.reload_items()}})}return false},input_changed:function(){var f=0;var g=e(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping");g.each(function(){var h=e(this);var i=h.find(".refund input:not(.refund_order_item_qty)");i.each(function(j,k){f+=parseFloat(accounting.unformat(e(k).val()||0,woocommerce_admin.mon_decimal_point))})});e("#refund_amount").val(accounting.formatNumber(f,woocommerce_admin_meta_boxes.currency_format_num_decimals,"",woocommerce_admin.mon_decimal_point)).change()},amount_changed:function(){var f=accounting.unformat(e(this).val(),woocommerce_admin.mon_decimal_point);e("button .wc-order-refund-amount .amount").text(accounting.formatMoney(f,{symbol:woocommerce_admin_meta_boxes.currency_format_symbol,decimal:woocommerce_admin_meta_boxes.currency_format_decimal_sep,thousand:woocommerce_admin_meta_boxes.currency_format_thousand_sep,precision:woocommerce_admin_meta_boxes.currency_format_num_decimals,format:woocommerce_admin_meta_boxes.currency_format}))},refund_quantity_changed:function(){var f=e(this).closest("tr.item");var k=f.find("input.quantity").val();var i=e(this).val();var j=e("input.line_total",f);var h=e("input.refund_line_total",f);var g=accounting.unformat(j.attr("data-total"),woocommerce_admin.mon_decimal_point)/k;h.val(parseFloat(accounting.formatNumber(g*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change();e(".refund_line_tax",f).each(function(){var o=e(this);var m=o.data("tax_id");var l=e('input.line_tax[data-tax_id="'+m+'"]',f);var n=accounting.unformat(l.data("total_tax"),woocommerce_admin.mon_decimal_point)/k;if(0<n){o.val(parseFloat(accounting.formatNumber(n*i,woocommerce_admin_meta_boxes.rounding_precision,"")).toString().replace(".",woocommerce_admin.mon_decimal_point)).change()}else{o.val(0).change()}});if(i>0){e("#restock_refunded_items").closest("tr").show()}else{e("#restock_refunded_items").closest("tr").hide();e(".woocommerce_order_items input.refund_order_item_qty").each(function(){if(e(this).val()>0){e("#restock_refunded_items").closest("tr").show()}})}e(this).trigger("refund_quantity_changed")}},item_meta:{add:function(){var i=e(this);var g=i.closest("tr.item, tr.shipping");var j=g.find("tbody.meta_items");var h=j.find("tr").length+1;var f='<tr data-meta_id="0"><td><input type="text" placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_name+'" name="meta_key['+g.attr("data-order_item_id")+"][new-"+h+']" /><textarea placeholder="'+woocommerce_admin_meta_boxes_order.placeholder_value+'" name="meta_value['+g.attr("data-order_item_id")+"][new-"+h+']"></textarea></td><td width="1%"><button class="remove_order_item_meta button">&times;</button></td></tr>';j.append(f);return false},remove:function(){if(window.confirm(woocommerce_admin_meta_boxes.remove_item_meta)){var f=e(this).closest("tr");f.find(":input").val("");f.hide()}return false}},select_row:function(){var f=false;if(e(this).is("tr")){f=e(this)}else{f=e(this).closest("tr")}var h=e(this).closest("table");if(f.is(".selected")){f.removeClass("selected")}else{f.addClass("selected")}var g=h.find("tr.selected");if(g.length){e("div.wc-order-item-bulk-edit").slideDown();var i=false;g.each(function(){if(e(this).is("tr.item")){i=true}});if(i){e(".bulk-increase-stock, .bulk-decrease-stock").show()}else{e(".bulk-increase-stock, .bulk-decrease-stock").hide()}}else{e("div.wc-order-item-bulk-edit").slideUp()}},select_row_child:function(f){f.stopPropagation()},bulk_actions:{do_delete:function(k){k.preventDefault();var i=e("table.woocommerce_order_items");var h=i.find("tr.selected");if(h.length&&window.confirm(woocommerce_admin_meta_boxes.remove_item_notice)){a.block();var j=[];var g=[];var f=[];e.map(h,function(m){var l=e(m);if(l.is(".refund")){g.push(parseInt(e(l).data("order_refund_id"),10))}else{j.push(parseInt(e(l).data("order_item_id"),10))}return});if(j.length){f.push(e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:{order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:j,action:"woocommerce_remove_order_item",security:woocommerce_admin_meta_boxes.order_item_nonce},type:"POST"}))}if(g.length){f.push(e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:{action:"woocommerce_delete_refund",refund_id:g,security:woocommerce_admin_meta_boxes.order_item_nonce},type:"POST"}))}if(f){e.when.apply(e,f).done(function(){a.reload_items();a.unblock()})}else{a.unblock()}}},do_increase_stock:function(j){j.preventDefault();a.block();var h=e("table.woocommerce_order_items");var g=h.find("tr.selected");var k={};var f=e.map(g,function(l){return parseInt(e(l).data("order_item_id"),10)});g.each(function(){if(e(this).find("input.quantity").length){k[e(this).attr("data-order_item_id")]=e(this).find("input.quantity").val()}});var i={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:f,order_item_qty:k,action:"woocommerce_increase_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(l){window.alert(l);a.unblock()}})},do_reduce_stock:function(j){j.preventDefault();a.block();var h=e("table.woocommerce_order_items");var g=h.find("tr.selected");var k={};var f=e.map(g,function(l){return parseInt(e(l).data("order_item_id"),10)});g.each(function(){if(e(this).find("input.quantity").length){k[e(this).attr("data-order_item_id")]=e(this).find("input.quantity").val()}});var i={order_id:woocommerce_admin_meta_boxes.post_id,order_item_ids:f,order_item_qty:k,action:"woocommerce_reduce_order_item_stock",security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:i,type:"POST",success:function(l){window.alert(l);a.unblock()}})}},backbone:{init:function(g,f){if("wc-modal-add-products"===f){e(document.body).trigger("wc-enhanced-select-init")}},response:function(j,i,g){if("wc-modal-add-tax"===i){var h=g.add_order_tax;var f="";if(g.manual_tax_rate_id){f=g.manual_tax_rate_id}a.backbone.add_tax(h,f)}if("wc-modal-add-products"===i){a.backbone.add_item(g.add_order_items)}},add_item:function(f){if(f){a.block();var g={action:"woocommerce_add_order_item",item_to_add:f,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,data:e("#wc-backbone-modal-dialog form").serialize()};if("true"===e("button.cancel-action").attr("data-reload")){g.items=e("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()}e.post(woocommerce_admin_meta_boxes.ajax_url,g,function(h){if(h.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(h.data.html);c.init_tiptip();a.stupidtable.init()}else{window.alert(h.data.error)}a.unblock()})}},add_tax:function(i,f){if(f){i=f}if(!i){return false}var g=e(".order-tax-id").map(function(){return e(this).val()}).get();if(-1===e.inArray(i,g)){a.block();var h={action:"woocommerce_add_order_tax",rate_id:i,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};e.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:h,dataType:"json",type:"POST",success:function(j){if(j.success){e("#woocommerce-order-items").find(".inside").empty();e("#woocommerce-order-items").find(".inside").append(j.data.html);c.init_tiptip();a.stupidtable.init()}else{window.alert(j.data.error)}a.unblock()}})}else{window.alert(woocommerce_admin_meta_boxes.i18n_tax_rate_already_exists)}}},stupidtable:{init:function(){e(".woocommerce_order_items").stupidtable();e(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(h,j){var g=e(this).find("th");var i=j.direction==="asc"?"&uarr;":"&darr;";var f=j.column;g.find(".wc-arrow").remove();g.eq(f).append('<span class="wc-arrow">'+i+"</span>")}}};var b={init:function(){e("#woocommerce-order-notes").on("click","button.add_note",this.add_order_note).on("click","a.delete_note",this.delete_order_note)},add_order_note:function(){if(!e("textarea#add_order_note").val()){return}e("#woocommerce-order-notes").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var f={action:"woocommerce_add_order_note",post_id:woocommerce_admin_meta_boxes.post_id,note:e("textarea#add_order_note").val(),note_type:e("select#order_note_type").val(),security:woocommerce_admin_meta_boxes.add_order_note_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(g){e("ul.order_notes").prepend(g);e("#woocommerce-order-notes").unblock();e("#add_order_note").val("")});return false},delete_order_note:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_delete_note)){var f=e(this).closest("li.note");e(f).block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var g={action:"woocommerce_delete_order_note",note_id:e(f).attr("rel"),security:woocommerce_admin_meta_boxes.delete_order_note_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,g,function(){e(f).remove()})}return false}};var d={init:function(){e(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access)},grant_access:function(){var g=e("#grant_access_id").val();if(!g){return}e(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var f={action:"woocommerce_grant_access_to_download",product_ids:g,loop:e(".order_download_permissions .wc-metabox").length,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.grant_access_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,f,function(h){if(h){e(".order_download_permissions .wc-metaboxes").append(h)}else{window.alert(woocommerce_admin_meta_boxes.i18n_download_permission_fail)}e(document.body).trigger("wc-init-datepickers");e("#grant_access_id").val("").change();e(".order_download_permissions").unblock()});return false},revoke_access:function(){if(window.confirm(woocommerce_admin_meta_boxes.i18n_permission_revoke)){var g=e(this).parent().parent();var j=e(this).attr("rel").split(",")[0];var f=e(this).attr("rel").split(",")[1];var h=e(this).data("permission_id");if(j>0){e(g).block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var i={action:"woocommerce_revoke_access_to_download",product_id:j,download_id:f,permission_id:h,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.revoke_access_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,i,function(){e(g).fadeOut("300",function(){e(g).remove()})})}else{e(g).fadeOut("300",function(){e(g).remove()})}}return false}};c.init();a.init();b.init();d.init()});